<Page
    x:Class="Moba.WinUI.View.TrainControlPage3"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Moba.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    DataContext="{x:Bind ViewModel}"
    mc:Ignorable="d">

    <!--
        TrainControlPage3 - ESU CabControl Style
        Layout inspired by ESU Mobile Control Pro app:
        - Blue header with loco tabs
        - Locomotive image with navigation arrows
        - Round throttle control (0-28 DCC steps)
        - Function button grid (F0-F7)
        - DCC address and protocol info
    -->

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Row 0: Header Bar (ESU blue style)  -->
        <Border
            x:Name="HeaderBorder"
            Grid.Row="0"
            Padding="16,12"
            Background="#0078D4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Hamburger Menu  -->
                <Button
                    Grid.Column="0"
                    Width="40"
                    Height="40"
                    Padding="0"
                    Background="Transparent"
                    BorderThickness="0">
                    <FontIcon
                        FontSize="20"
                        Foreground="White"
                        Glyph="&#xE700;" />
                </Button>

                <!--  Title / Logo area  -->
                <TextBlock
                    Grid.Column="1"
                    Margin="12,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontWeight="SemiBold"
                    Foreground="White"
                    Text="Train Control 3" />

                <!--  Add Loco Button  -->
                <Button
                    Grid.Column="2"
                    Width="40"
                    Height="40"
                    Margin="8,0"
                    Padding="0"
                    Background="Transparent"
                    BorderThickness="0">
                    <FontIcon
                        FontSize="18"
                        Foreground="White"
                        Glyph="&#xE710;" />
                </Button>

                <!--  Remove Loco Button  -->
                <Button
                    Grid.Column="3"
                    Width="40"
                    Height="40"
                    Padding="0"
                    Background="Transparent"
                    BorderThickness="0">
                    <FontIcon
                        FontSize="18"
                        Foreground="White"
                        Glyph="&#xE738;" />
                </Button>

                <!--  Emergency Stop  -->
                <Button
                    Grid.Column="4"
                    Width="48"
                    Height="40"
                    Margin="8,0,0,0"
                    Background="#E81123"
                    Command="{x:Bind ViewModel.EmergencyStopCommand}"
                    CornerRadius="4">
                    <FontIcon
                        FontSize="18"
                        Foreground="White"
                        Glyph="&#xE711;" />
                </Button>
            </Grid>
        </Border>

        <!--  Row 1: Locomotive Tabs  -->
        <Border
            Grid.Row="1"
            Padding="8,4"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,0,0,1">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel
                    x:Name="LocoTabsPanel"
                    Orientation="Horizontal"
                    Spacing="4">
                    <!--  Loco tabs will be generated in code-behind  -->
                    <Button
                        x:Name="LocoTab1"
                        Padding="12,6"
                        Background="{ThemeResource AccentFillColorDefaultBrush}"
                        CornerRadius="4">
                        <TextBlock
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="White"
                            Text="Lok 1" />
                    </Button>
                    <Button
                        x:Name="LocoTab2"
                        Padding="12,6"
                        Background="Transparent"
                        CornerRadius="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="Lok 2" />
                    </Button>
                    <Button
                        x:Name="LocoTab3"
                        Padding="12,6"
                        Background="Transparent"
                        CornerRadius="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="Lok 3" />
                    </Button>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!--  Row 2: Main Content (Loco Image + Throttle)  -->
        <Grid Grid.Row="2" Padding="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Locomotive Image with Navigation  -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Previous Loco Arrow  -->
                <Button
                    Grid.Column="0"
                    Width="40"
                    Height="80"
                    VerticalAlignment="Center"
                    Background="Transparent"
                    BorderThickness="0">
                    <FontIcon
                        FontSize="24"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Glyph="&#xE76B;" />
                </Button>

                <!--  Locomotive Image  -->
                <Border
                    Grid.Column="1"
                    Height="80"
                    Margin="8,0"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <Grid>
                        <FontIcon
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontSize="48"
                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                            Glyph="&#xE7C0;" />
                        <TextBlock
                            Margin="0,0,0,8"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="BR 80" />
                    </Grid>
                </Border>

                <!--  Next Loco Arrow  -->
                <Button
                    Grid.Column="2"
                    Width="40"
                    Height="80"
                    VerticalAlignment="Center"
                    Background="Transparent"
                    BorderThickness="0">
                    <FontIcon
                        FontSize="24"
                        Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                        Glyph="&#xE76C;" />
                </Button>
            </Grid>

            <!--  Round Throttle Control  -->
            <Grid
                Grid.Row="1"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <controls:RoundThrottleControl
                    x:Name="ThrottleControl"
                    Address="{x:Bind ViewModel.LocoAddress, Mode=OneWay}"
                    IsForward="{x:Bind ViewModel.IsForward, Mode=OneWay}"
                    MaxValue="28"
                    Protocol="DCC 28"
                    Value="{x:Bind ViewModel.Speed, Mode=OneWay}" />
            </Grid>
        </Grid>

        <!--  Row 3: Function Buttons Grid  -->
        <Border
            Grid.Row="3"
            Padding="16,12"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Row 1: F0-F3  -->
                <controls:FunctionButtonControl
                    x:Name="F0Button"
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="4"
                    FunctionNumber="0"
                    Glyph="&#xE71E;"
                    IsActive="{x:Bind ViewModel.IsF0On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F1Button"
                    Grid.Row="0"
                    Grid.Column="1"
                    Margin="4"
                    FunctionNumber="1"
                    Glyph="&#xE767;"
                    IsActive="{x:Bind ViewModel.IsF1On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F2Button"
                    Grid.Row="0"
                    Grid.Column="2"
                    Margin="4"
                    FunctionNumber="2"
                    Glyph="&#xE774;"
                    IsActive="{x:Bind ViewModel.IsF2On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F3Button"
                    Grid.Row="0"
                    Grid.Column="3"
                    Margin="4"
                    FunctionNumber="3"
                    Glyph="&#xE710;"
                    IsActive="{x:Bind ViewModel.IsF3On, Mode=TwoWay}" />

                <!--  Row 2: F4-F7  -->
                <controls:FunctionButtonControl
                    x:Name="F4Button"
                    Grid.Row="1"
                    Grid.Column="0"
                    Margin="4"
                    FunctionNumber="4"
                    Glyph="&#xE706;"
                    IsActive="{x:Bind ViewModel.IsF4On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F5Button"
                    Grid.Row="1"
                    Grid.Column="1"
                    Margin="4"
                    FunctionNumber="5"
                    Glyph="&#xE71E;"
                    IsActive="{x:Bind ViewModel.IsF5On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F6Button"
                    Grid.Row="1"
                    Grid.Column="2"
                    Margin="4"
                    FunctionNumber="6"
                    Glyph="&#xE71E;"
                    IsActive="{x:Bind ViewModel.IsF6On, Mode=TwoWay}" />
                <controls:FunctionButtonControl
                    x:Name="F7Button"
                    Grid.Row="1"
                    Grid.Column="3"
                    Margin="4"
                    FunctionNumber="7"
                    Glyph="&#xE71E;"
                    IsActive="{x:Bind ViewModel.IsF7On, Mode=TwoWay}" />
            </Grid>
        </Border>
    </Grid>
</Page>
