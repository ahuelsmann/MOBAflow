<Page
    x:Class="Moba.WinUI.View.EditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="using:Moba.WinUI.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:domain="using:Moba.Domain"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodel="using:Moba.SharedUI.ViewModel"
    x:Name="PageRoot"
    DataContext="{x:Bind ViewModel}"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/EntityTemplates.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
            <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <converter:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
            <converter:BoolToGlyphConverter x:Key="BoolToGlyphConverter" TrueValue="&#xE76B;" FalseValue="&#xE76C;" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="PropertiesStates">
                                <VisualState x:Name="Expanded">
                                    <VisualState.Setters>
                                        <Setter Target="PropertiesContent.Visibility" Value="Visible" />
                                    </VisualState.Setters>
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="PropertiesContent"
                                                Storyboard.TargetProperty="Opacity"
                                                From="0.0"
                                                To="1.0"
                                                Duration="0:0:0.25">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>

                                <VisualState x:Name="Collapsed">
                                    <VisualState.Setters>
                                        <Setter Target="PropertiesContent.Visibility" Value="Collapsed" />
                                    </VisualState.Setters>
                                    <VisualState.Storyboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="PropertiesContent"
                                                Storyboard.TargetProperty="Opacity"
                                                From="1.0"
                                                To="0.0"
                                                Duration="0:0:0.20">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </VisualState.Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Page Header  -->
        <StackPanel
            Grid.Row="0"
            Margin="16,2,16,2"
            Spacing="8">
            <TextBlock
                FontWeight="Bold"
                Style="{StaticResource TitleTextBlockStyle}"
                Text="Editor" />
        </StackPanel>

        <!--  TabView Navigation  -->
        <TabView
            x:Name="EditorTabView"
            Grid.Row="1"
            CanDragTabs="True"
            CanReorderTabs="True"
            IsAddTabButtonVisible="False"
            TabWidthMode="SizeToContent">

            <!--  ============================================  -->
            <!--  ============================================  -->
            <!--  Solution Tab: Projects + PropertyGrid  -->
            <!--  ============================================  -->
            <TabViewItem
                x:Name="SolutionTab"
                Header="Solution"
                IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE8F1;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="300" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition
                            Width="400"
                            MinWidth="300"
                            MaxWidth="600" />
                    </Grid.ColumnDefinitions>

                    <!--  Column 0: Projects  -->
                    <Grid Grid.Column="0" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Projects" />
                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.SolutionViewModel.Projects, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedProject, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:ProjectViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE8F1;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 2: PropertyGrid  -->
                    <Grid Grid.Column="2" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Properties" />
                        <ContentControl
                            Grid.Row="1"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"
                            Content="{Binding CurrentSelectedObject, Mode=OneWay}"
                            ContentTemplateSelector="{StaticResource EntityTemplateSelector}" />
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  ============================================  -->
            <!--  ============================================  -->
            <!--  Journeys Tab: Journeys + Stations + City Library + PropertyGrid  -->
            <!--  ============================================  -->
            <TabViewItem
                x:Name="JourneysTab"
                Header="Journeys"
                IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE81D;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="250" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="250" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" MinWidth="300" />
                    </Grid.ColumnDefinitions>

                    <!--  Column 0: Journeys  -->
                    <Grid Grid.Column="0" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Journeys" />
                        <AutoSuggestBox
                            Grid.Row="1"
                            Margin="8,0,8,4"
                            PlaceholderText="Search journeys..."
                            QueryIcon="Find"
                            Text="{x:Bind ViewModel.JourneySearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <ListView
                            Grid.Row="2"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Journeys, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedJourney, Mode=TwoWay}"
                            SelectionMode="Single"
                            Tapped="JourneyListView_Tapped">
                            <ListView.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem Command="{x:Bind ViewModel.AddJourneyCommand}" Text="Add Journey">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE710;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem Command="{x:Bind ViewModel.DeleteJourneyCommand}" Text="Delete Journey">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE738;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </ListView.ContextFlyout>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:JourneyViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE81D;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 2: Stations (of selected Journey)  -->
                    <Grid Grid.Column="2" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Stations" />
                        <ListView
                            Grid.Row="1"
                            AllowDrop="True"
                            DragOver="StationListView_DragOver"
                            Drop="StationListView_Drop"
                            ItemsSource="{x:Bind ViewModel.SelectedJourney.Stations, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedStation, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:StationViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE80F;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="3"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 4: City Library (for Drag & Drop)  -->
                    <Grid Grid.Column="4" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="City Library" />
                        <ListView
                            Grid.Row="1"
                            CanDragItems="True"
                            DoubleTapped="CityListView_DoubleTapped"
                            DragItemsStarting="CityListView_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CityLibrary, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedCity, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="domain:City">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE80F;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="5"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 6: PropertyGrid  -->
                    <Grid Grid.Column="6" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Properties" />
                        <ContentControl
                            Grid.Row="1"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"
                            Content="{Binding CurrentSelectedObject, Mode=OneWay}"
                            ContentTemplateSelector="{StaticResource EntityTemplateSelector}" />
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  ============================================  -->
            <!--  Workflows Tab: Workflows + Actions + PropertyGrid  -->
            <!--  ============================================  -->
            <TabViewItem
                x:Name="WorkflowsTab"
                Header="Workflows"
                IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE713;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="300" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" MinWidth="300" />
                    </Grid.ColumnDefinitions>

                    <!--  Column 0: Workflows  -->
                    <Grid Grid.Column="0" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Workflows" />
                        <AutoSuggestBox
                            Grid.Row="1"
                            Margin="8,0,8,4"
                            PlaceholderText="Search workflows..."
                            QueryIcon="Find"
                            Text="{x:Bind ViewModel.WorkflowSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <ListView
                            Grid.Row="2"
                            CanDragItems="True"
                            DragItemsStarting="WorkflowListView_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Workflows, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedWorkflow, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem Command="{x:Bind ViewModel.AddWorkflowCommand}" Text="Add Workflow">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE710;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem Command="{x:Bind ViewModel.DeleteWorkflowCommand}" Text="Delete Workflow">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE738;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </ListView.ContextFlyout>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:WorkflowViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE713;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 2: Actions (of selected Workflow)  -->
                    <Grid Grid.Column="2" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Actions" />
                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.SelectedWorkflow.Actions, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedAction, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE945;" />
                                        <TextBlock Grid.Column="1" VerticalAlignment="Center">
                                            <Run FontWeight="SemiBold" Text="{Binding Name}" />
                                            <Run Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text=" (" />
                                            <Run Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{Binding Type}" />
                                            <Run Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text=")" />
                                        </TextBlock>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="3"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 4: PropertyGrid  -->
                    <Grid Grid.Column="4" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Properties" />
                        <ContentControl
                            Grid.Row="1"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"
                            Content="{Binding CurrentSelectedObject, Mode=OneWay}"
                            ContentTemplateSelector="{StaticResource EntityTemplateSelector}" />
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  ============================================  -->
            <!--  Trains Tab: Trains + Locomotives + Wagons + Libraries + PropertyGrid  -->
            <!--  ============================================  -->
            <TabViewItem
                x:Name="TrainsTab"
                Header="Trains"
                IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE7C0;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="200" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="200" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="180" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="180" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="180" MinWidth="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" MinWidth="300" />
                    </Grid.ColumnDefinitions>

                    <!--  Column 0: Trains (Master)  -->
                    <Grid Grid.Column="0" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Trains" />
                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Trains, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedTrain, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:TrainViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE7C0;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 2: Locomotives (of selected Train)  -->
                    <Grid Grid.Column="2" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Locomotives" />
                        <ListView
                            Grid.Row="1"
                            AllowDrop="True"
                            DragOver="LocomotiveListView_DragOver"
                            Drop="LocomotiveListView_Drop"
                            ItemsSource="{x:Bind ViewModel.SelectedTrain.Locomotives, Mode=OneWay}"
                            KeyDown="LocomotiveListView_KeyDown"
                            SelectionMode="Single">
                            <ListView.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem
                                        Click="RemoveLocomotiveMenuItem_Click"
                                        Icon="Delete"
                                        Text="Remove">
                                        <MenuFlyoutItem.KeyboardAccelerators>
                                            <KeyboardAccelerator Key="Delete" />
                                        </MenuFlyoutItem.KeyboardAccelerators>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem
                                        Click="DuplicateLocomotiveMenuItem_Click"
                                        Icon="Copy"
                                        Text="Duplicate">
                                        <MenuFlyoutItem.KeyboardAccelerators>
                                            <KeyboardAccelerator Key="D" Modifiers="Control" />
                                        </MenuFlyoutItem.KeyboardAccelerators>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </ListView.ContextFlyout>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:LocomotiveViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE7C8;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="3"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 4: Wagons (of selected Train)  -->
                    <Grid Grid.Column="4" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Wagons" />
                        <ListView
                            Grid.Row="1"
                            AllowDrop="True"
                            DragOver="WagonListView_DragOver"
                            Drop="WagonListView_Drop"
                            ItemsSource="{x:Bind ViewModel.SelectedTrain.Wagons, Mode=OneWay}"
                            KeyDown="TrainWagonListView_KeyDown"
                            SelectionMode="Single">
                            <ListView.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem
                                        Click="RemoveWagonMenuItem_Click"
                                        Icon="Delete"
                                        Text="Remove">
                                        <MenuFlyoutItem.KeyboardAccelerators>
                                            <KeyboardAccelerator Key="Delete" />
                                        </MenuFlyoutItem.KeyboardAccelerators>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem
                                        Click="DuplicateWagonMenuItem_Click"
                                        Icon="Copy"
                                        Text="Duplicate">
                                        <MenuFlyoutItem.KeyboardAccelerators>
                                            <KeyboardAccelerator Key="D" Modifiers="Control" />
                                        </MenuFlyoutItem.KeyboardAccelerators>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </ListView.ContextFlyout>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:WagonViewModel">
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Glyph="&#xE7E8;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="5"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 6: Locomotive Library (Drag Source)  -->
                    <Grid Grid.Column="6" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Loco Library" />
                        <ListView
                            Grid.Row="1"
                            CanDragItems="True"
                            DoubleTapped="LocomotiveLibrary_DoubleTapped"
                            DragItemsStarting="LocomotiveLibrary_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Locomotives, Mode=OneWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:LocomotiveViewModel">
                                    <Grid Padding="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,6,0"
                                            FontSize="14"
                                            Glyph="&#xE7C8;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            FontSize="12"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="7"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 8: Passenger Wagon Library (Drag Source)  -->
                    <Grid Grid.Column="8" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Passenger" />
                        <ListView
                            Grid.Row="1"
                            CanDragItems="True"
                            DoubleTapped="PassengerWagonLibrary_DoubleTapped"
                            DragItemsStarting="PassengerWagonListView_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.PassengerWagons, Mode=OneWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:PassengerWagonViewModel">
                                    <Grid Padding="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,6,0"
                                            FontSize="14"
                                            Glyph="&#xE7E8;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            FontSize="12"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="9"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 10: Goods Wagon Library (Drag Source)  -->
                    <Grid Grid.Column="10" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Padding="16,6,24,4"
                            FontWeight="SemiBold"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Goods" />
                        <ListView
                            Grid.Row="1"
                            CanDragItems="True"
                            DoubleTapped="GoodsWagonLibrary_DoubleTapped"
                            DragItemsStarting="GoodsWagonListView_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.GoodsWagons, Mode=OneWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:GoodsWagonViewModel">
                                    <Grid Padding="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <FontIcon
                                            Grid.Column="0"
                                            Margin="0,0,6,0"
                                            FontSize="14"
                                            Glyph="&#xE7E8;" />
                                        <TextBlock
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            FontSize="12"
                                            Text="{x:Bind Name, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="11"
                        Grid.RowSpan="2"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Column 12: PropertyGrid (Full-Height with Collapse)  -->
                    <Grid x:Name="PropertiesPanel" Grid.Column="12" Grid.RowSpan="2" Padding="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>


                        <!--  Header with Collapse Button  -->
                        <Grid Grid.Row="0" Padding="16,6,8,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                VerticalAlignment="Center"
                                FontWeight="SemiBold"
                                Style="{StaticResource SubtitleTextBlockStyle}"
                                Text="Properties" />

                            <ToggleButton
                                x:Name="PropertiesCollapseToggle"
                                Grid.Column="1"
                                Width="32"
                                Height="32"
                                Padding="0"
                                Checked="PropertiesCollapseToggle_Checked"
                                Unchecked="PropertiesCollapseToggle_Unchecked"
                                ToolTipService.ToolTip="Toggle Properties Panel">
                                <FontIcon x:Name="PropertiesCollapseIcon" FontSize="12" Glyph="{Binding ElementName=PropertiesCollapseToggle, Path=IsChecked, Converter={StaticResource BoolToGlyphConverter}}" />
                            </ToggleButton>
                        </Grid>

                        <ContentControl
                            x:Name="PropertiesContent"
                            Grid.Row="1"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"
                            Content="{Binding CurrentSelectedObject, Mode=OneWay}"
                            ContentTemplateSelector="{StaticResource EntityTemplateSelector}" />
                    </Grid>
                </Grid>
            </TabViewItem>
        </TabView>
    </Grid>
</Page>













