<Page
    x:Name="PageRoot"
    x:Class="Moba.WinUI.View.EditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="using:Moba.WinUI.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:domain="using:Moba.Domain"
    xmlns:viewmodel="using:Moba.SharedUI.ViewModel"
    xmlns:local="using:Moba.WinUI.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converter:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converter:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
        <converter:DateTimeToTimeSpanConverter x:Key="DateTimeToTimeSpanConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" MinWidth="600" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="1*" MinWidth="300" MaxWidth="400" />
        </Grid.ColumnDefinitions>

        <!--  Page Header  -->
        <StackPanel
            Grid.Row="0"
            Grid.Column="0"
            Margin="24,16,24,8"
            Spacing="8">
            <TextBlock
                FontWeight="Bold"
                Style="{StaticResource TitleTextBlockStyle}"
                Text="Editor" />
            <TextBlock
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Style="{StaticResource BodyTextBlockStyle}"
                Text="{x:Bind ViewModel.Solution.Name, Mode=OneWay}" />
        </StackPanel>

        <!--  TabView with Editor Tabs  -->
        <TabView
            Grid.Row="1"
            Grid.Column="0"
            Margin="24,0,24,24"
            TabWidthMode="Equal" VerticalAlignment="Stretch" IsAddTabButtonVisible="False" CanDragTabs="False" CanReorderTabs="False">

            <!--  Solution/Projects Tab  -->
            <TabViewItem Header="Solution" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE8F1;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="250" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="3*" MinWidth="350" />
                    </Grid.ColumnDefinitions>

                    <!--  Master: Solution (Single Item)  -->
                    <Grid Grid.Column="0" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Solution" />

                        <ListView
                            Grid.Row="1"
                            SelectionMode="Single">
                            <ListView.Items>
                                <Grid Background="Transparent" Padding="8">
                                    <TextBlock Text="{x:Bind ViewModel.Solution.Name, Mode=OneWay}" />
                                    <Button 
                                        Command="{x:Bind ViewModel.SelectSolutionCommand}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        Padding="0" />
                                </Grid>
                            </ListView.Items>
                        </ListView>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Detail: Projects  -->
                    <Grid Grid.Column="2" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Projects" />

                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.SolutionViewModel.Projects, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedProject, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:ProjectViewModel">
                                    <Grid Background="Transparent">
                                        <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                        <Button 
                                            Command="{Binding DataContext.SelectProjectCommand, ElementName=PageRoot}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Padding="0" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Row="2"
                            Margin="0,8,0,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                Command="{x:Bind ViewModel.AddProjectCommand}"
                                Content="+"
                                Style="{StaticResource AccentButtonStyle}"
                                ToolTipService.ToolTip="Add Project" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  Journeys Tab  -->
            <TabViewItem Header="Journeys" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE81D;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="250" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="3*" MinWidth="350" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="2*" MinWidth="250" />
                    </Grid.ColumnDefinitions>

                    <!--  Master: Journeys  -->
                    <Grid Grid.Column="0" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Journeys" />

                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Journeys, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedJourney, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:JourneyViewModel">
                                    <Grid Background="Transparent">
                                        <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                        <Button 
                                            Command="{Binding DataContext.SelectJourneyCommand, ElementName=PageRoot}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Padding="0" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Row="2"
                            Margin="0,8,0,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                Command="{x:Bind ViewModel.AddJourneyCommand}"
                                Content="+"
                                Style="{StaticResource AccentButtonStyle}"
                                ToolTipService.ToolTip="Add Journey" />
                            <Button
                                Command="{x:Bind ViewModel.DeleteJourneyCommand}"
                                Content="-"
                                ToolTipService.ToolTip="Delete Journey" />
                        </StackPanel>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  Detail: Stations  -->
                    <Grid Grid.Column="2" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Stations" />

                        <ListView
                            x:Name="StationsListView"
                            Grid.Row="1"
                            AllowDrop="True"
                            DragOver="StationsListView_DragOver"
                            Drop="StationsListView_Drop"
                            ItemsSource="{x:Bind ViewModel.SelectedJourney.Stations, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedStation, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:StationViewModel">
                                    <Grid Background="Transparent">
                                        <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                        <Button 
                                            Command="{Binding DataContext.SelectStationCommand, ElementName=PageRoot}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Padding="0" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Row="2"
                            Margin="0,8,0,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                Command="{x:Bind ViewModel.AddStationCommand}"
                                Content="+"
                                Style="{StaticResource AccentButtonStyle}"
                                ToolTipService.ToolTip="Add Station" />
                            <Button Content="Add from City Library">
                                <Button.Flyout>
                                    <Flyout>
                                        <StackPanel Width="350" Spacing="12">
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="Select City from Library" />

                                            <TextBox PlaceholderText="Search cities..." Text="{x:Bind ViewModel.CitySearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                <TextBox.Description>
                                                    <TextBlock Text="Type to filter German railway stations" />
                                                </TextBox.Description>
                                            </TextBox>

                                            <ListView
                                                x:Name="CityListView"
                                                Height="400"
                                                ItemsSource="{x:Bind ViewModel.CityLibrary, Mode=OneWay}"
                                                SelectionMode="Single">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate x:DataType="domain:City">
                                                        <StackPanel Padding="8,4" Tapped="CityItem_Tapped">
                                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Name}" />
                                                            <TextBlock
                                                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                Style="{StaticResource CaptionTextBlockStyle}"
                                                                Text="{x:Bind Stations[0].Name}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                                <ListView.ItemContainerStyle>
                                                    <Style TargetType="ListViewItem">
                                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                    </Style>
                                                </ListView.ItemContainerStyle>
                                            </ListView>

                                            <Button
                                                HorizontalAlignment="Stretch"
                                                Command="{x:Bind ViewModel.AddStationFromCityCommand}"
                                                CommandParameter="{Binding SelectedItem, ElementName=CityListView}"
                                                Content="Add Selected Station"
                                                Style="{StaticResource AccentButtonStyle}" />
                                        </StackPanel>
                                    </Flyout>
                                </Button.Flyout>
                            </Button>
                            <Button
                                Command="{x:Bind ViewModel.DeleteStationCommand}"
                                Content="-"
                                ToolTipService.ToolTip="Delete Station" />
                        </StackPanel>
                    </Grid>

                    <!--  Divider between Stations and Cities  -->
                    <Border
                        Grid.Column="3"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <!--  City Library Panel  -->
                    <Grid Grid.Column="4" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="City Library" />

                        <TextBox
                            Grid.Row="1"
                            Margin="0,0,0,8"
                            PlaceholderText="Search cities..."
                            Text="{x:Bind ViewModel.CitySearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Description>
                                <TextBlock Text="Double-click or drag to add station" />
                            </TextBox.Description>
                        </TextBox>

                        <ListView
                            x:Name="CityLibraryListView"
                            Grid.Row="2"
                            AllowDrop="False"
                            CanDragItems="True"
                            CanReorderItems="False"
                            DragItemsStarting="CityListView_DragItemsStarting"
                            ItemsSource="{x:Bind ViewModel.CityLibrary, Mode=OneWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="domain:City">
                                    <StackPanel Padding="8,4" DoubleTapped="CityItem_DoubleTapped">
                                        <TextBlock FontWeight="SemiBold" Text="{x:Bind Name}" />
                                        <TextBlock
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            Text="{x:Bind Stations[0].Name}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  Workflows Tab  -->
            <TabViewItem Header="Workflows" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE8F5;" />
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="300" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="3*" MinWidth="400" />
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Workflows" />

                        <ListView
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Workflows, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedWorkflow, Mode=TwoWay}"
                            SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodel:WorkflowViewModel">
                                    <Grid Background="Transparent">
                                        <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                        <Button 
                                            Command="{Binding DataContext.SelectWorkflowCommand, ElementName=PageRoot}"
                                            CommandParameter="{x:Bind}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Padding="0" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Row="2"
                            Margin="0,8,0,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                Command="{x:Bind ViewModel.AddWorkflowCommand}"
                                Content="+"
                                Style="{StaticResource AccentButtonStyle}"
                                ToolTipService.ToolTip="Add Workflow" />
                            <Button
                                Command="{x:Bind ViewModel.DeleteWorkflowCommand}"
                                Content="-"
                                ToolTipService.ToolTip="Delete Workflow" />
                        </StackPanel>
                    </Grid>

                    <Border
                        Grid.Column="1"
                        Width="1"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                    <Grid Grid.Column="2" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="0,0,0,8"
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            Text="Actions" />

                        <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SelectedWorkflow.Actions, Mode=OneWay}">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Padding="8" Text="{Binding Name}" />
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Row="2"
                            Margin="0,8,0,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                Command="{x:Bind ViewModel.AddAnnouncementCommand}"
                                Content="Announcement"
                                ToolTipService.ToolTip="Add Announcement Action" />
                            <Button
                                Command="{x:Bind ViewModel.AddCommandCommand}"
                                Content="Command"
                                ToolTipService.ToolTip="Add Command Action" />
                            <Button
                                Command="{x:Bind ViewModel.AddAudioCommand}"
                                Content="Audio"
                                ToolTipService.ToolTip="Add Audio Action" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabViewItem>

            <!--  Trains Tab  -->
            <TabViewItem Header="Trains" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE7C0;" />
                </TabViewItem.IconSource>
                <Grid Padding="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Margin="0,0,0,8"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Trains" />

                    <ListView
                        Grid.Row="1"
                        ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Trains, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.SelectedTrain, Mode=TwoWay}"
                        SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:TrainViewModel">
                                <Grid Background="Transparent">
                                    <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                    <Button 
                                        Command="{Binding DataContext.SelectTrainCommand, ElementName=PageRoot}"
                                        CommandParameter="{x:Bind}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        Padding="0" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <StackPanel
                        Grid.Row="2"
                        Margin="0,8,0,0"
                        Orientation="Horizontal"
                        Spacing="8">
                        <Button
                            Command="{x:Bind ViewModel.AddTrainCommand}"
                            Content="+"
                            Style="{StaticResource AccentButtonStyle}"
                            ToolTipService.ToolTip="Add Train" />
                        <Button
                            Command="{x:Bind ViewModel.DeleteTrainCommand}"
                            Content="-"
                            ToolTipService.ToolTip="Delete Train" />
                        <Button
                            Command="{x:Bind ViewModel.AddLocomotiveToCompositionCommand}"
                            Content="Add Loco"
                            ToolTipService.ToolTip="Add Locomotive to Train Composition" />
                        <Button
                            Command="{x:Bind ViewModel.AddWagonToCompositionCommand}"
                            Content="Add Wagon"
                            ToolTipService.ToolTip="Add Wagon to Train Composition" />
                    </StackPanel>
                </Grid>
            </TabViewItem>

            <!--  Locomotives Tab  -->
            <TabViewItem Header="Locomotives" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE7C0;" />
                </TabViewItem.IconSource>
                <Grid Padding="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Margin="0,0,0,8"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Locomotives Library" />

                    <ListView
                        Grid.Row="1"
                        ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Locomotives, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.SelectedLocomotive, Mode=TwoWay}"
                        SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:LocomotiveViewModel">
                                <Grid Background="Transparent">
                                    <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                    <Button 
                                        Command="{Binding DataContext.SelectLocomotiveCommand, ElementName=PageRoot}"
                                        CommandParameter="{x:Bind}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        Padding="0" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <StackPanel
                        Grid.Row="2"
                        Margin="0,8,0,0"
                        Orientation="Horizontal"
                        Spacing="8">
                        <Button
                            Command="{x:Bind ViewModel.AddLocomotiveCommand}"
                            Content="+"
                            Style="{StaticResource AccentButtonStyle}"
                            ToolTipService.ToolTip="Add Locomotive" />
                        <Button
                            Command="{x:Bind ViewModel.DeleteLocomotiveCommand}"
                            Content="-"
                            ToolTipService.ToolTip="Delete Locomotive" />
                    </StackPanel>
                </Grid>
            </TabViewItem>

            <!--  Wagons Tab  -->
            <TabViewItem Header="Wagons" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE8EC;" />
                </TabViewItem.IconSource>
                <Grid Padding="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Margin="0,0,0,8"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Wagons Library" />

                    <ListView
                        Grid.Row="1"
                        ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Wagons, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.SelectedWagon, Mode=TwoWay}">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:WagonViewModel">
                                <Grid Background="Transparent">
                                    <TextBlock Padding="8" Text="{x:Bind Name, Mode=OneWay}" />
                                    <Button 
                                        Command="{Binding DataContext.SelectWagonCommand, ElementName=PageRoot}"
                                        CommandParameter="{x:Bind}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        Padding="0" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <StackPanel
                        Grid.Row="2"
                        Margin="0,8,0,0"
                        Orientation="Horizontal"
                        Spacing="8">
                        <Button
                            Command="{x:Bind ViewModel.AddPassengerWagonCommand}"
                            Content="+"
                            Style="{StaticResource AccentButtonStyle}"
                            ToolTipService.ToolTip="Add Passenger Wagon" />
                        <Button
                            Command="{x:Bind ViewModel.AddGoodsWagonCommand}"
                            Content="Add Goods"
                            ToolTipService.ToolTip="Add Goods Wagon" />
                        <Button
                            Command="{x:Bind ViewModel.DeleteWagonCommand}"
                            Content="-"
                            ToolTipService.ToolTip="Delete Wagon" />
                    </StackPanel>
                </Grid>
            </TabViewItem>

            <!--  Settings Tab  -->
        </TabView>
        
        <!--  Vertical Divider  -->
        <Border
            Grid.Row="0"
            Grid.RowSpan="2"
            Grid.Column="1"
            Width="1"
            Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  PropertyGrid Panel (Dynamically Generated)  -->
        <Grid
            Grid.Row="0"
            Grid.RowSpan="2"
            Grid.Column="2"
            Padding="0"
            Background="{ThemeResource LayerFillColorDefaultBrush}">
            
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <TextBlock
                Grid.Row="0"
                Padding="16,24,24,16"
                FontWeight="SemiBold"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="Properties" />
            
            <!-- Dynamic PropertyGrid that automatically shows all properties -->
            <local:SimplePropertyGrid 
                Grid.Row="1"
                x:Name="PropertyGrid"
                SelectedObject="{x:Bind CurrentSelectedObject, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.HasSelectedEntity, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                
            <!--  Empty State (when nothing selected)  -->
            <StackPanel 
                Grid.Row="1"
                Spacing="16" 
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Margin="0,60,0,0"
                Visibility="{x:Bind ViewModel.HasSelectedEntity, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <FontIcon
                    FontSize="48"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Glyph="&#xE946;"
                    HorizontalAlignment="Center" />
                <TextBlock
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Text="No item selected"
                    TextAlignment="Center" />
                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Text="Select an item from the left to view and edit its properties"
                    TextAlignment="Center"
                    TextWrapping="Wrap"
                    MaxWidth="220" />
            </StackPanel>
        </Grid>
    </Grid>
</Page>

