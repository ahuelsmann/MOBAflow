<Page
    x:Name="PageRoot"
    x:Class="Moba.WinUI.View.EditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="using:Moba.WinUI.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:domain="using:Moba.Domain"
    xmlns:viewmodel="using:Moba.SharedUI.ViewModel"
    xmlns:local="using:Moba.WinUI.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converter:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converter:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
        <converter:DateTimeToTimeSpanConverter x:Key="DateTimeToTimeSpanConverter" />
    </Page.Resources>

    <Grid>
        <Grid.Resources>
            <!-- Compact Sizing -->
            <Thickness x:Key="ListViewItemContentMargin">6,4,6,4</Thickness>
            <x:Double x:Key="ListViewItemMinHeight">32</x:Double>
        </Grid.Resources>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <!--  Column 0: Projects  -->
            <ColumnDefinition Width="2*" MinWidth="250" MaxWidth="350" />
            <ColumnDefinition Width="Auto" />
            <!--  Column 2: City Library  -->
            <ColumnDefinition Width="1*" MinWidth="200" MaxWidth="300" />
            <ColumnDefinition Width="Auto" />
            <!--  Column 4: Workflows  -->
            <ColumnDefinition Width="1*" MinWidth="200" MaxWidth="300" />
            <ColumnDefinition Width="Auto" />
            <!--  Column 6: PropertyGrid  -->
            <ColumnDefinition Width="2*" MinWidth="300" />
        </Grid.ColumnDefinitions>

        <!--  Page Header  -->
        <StackPanel
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="7"
            Margin="16,2,16,2"
            Spacing="8">
            <TextBlock
                FontWeight="Bold"
                Style="{StaticResource TitleTextBlockStyle}"
                Text="Editor" />
        </StackPanel>

        <!--  SelectorBar Navigation  -->
        <SelectorBar
            x:Name="EditorSelectorBar"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="7"
            Margin="16,8,16,8"
            SelectionChanged="EditorSelectorBar_SelectionChanged">
            <SelectorBarItem x:Name="SolutionSelector" Text="Solution">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE8F1;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="JourneysSelector" Text="Journeys">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE81D;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="WorkflowsSelector" Text="Workflows">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE9D9;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="TrainsSelector" Text="Trains">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE7C0;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
        </SelectorBar>

        <!--  Column 0: Projects  -->
        <Grid Grid.Row="2" Grid.Column="0" Padding="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Margin="0,0,0,8"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="Projects" />

            <ListView
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.SolutionViewModel.Projects, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedProject, Mode=TwoWay}"
                SelectionMode="Single">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodel:ProjectViewModel">
                        <Grid Padding="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <FontIcon
                                Grid.Column="0"
                                FontSize="16"
                                Glyph="&#xE8F1;"
                                Margin="0,0,8,0" />
                            <TextBlock
                                Grid.Column="1"
                                Text="{x:Bind Name, Mode=OneWay}"
                                VerticalAlignment="Center" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <!--  Separator between Projects and City Library (TODO: Replace with GridSplitter when CommunityToolkit.WinUI.Controls.Sizers is installed)  -->
        <Border
            Grid.Row="2"
            Grid.Column="1"
            Width="1"
            Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

        <!--  Column 2: City Library  -->
        <Grid Grid.Row="2" Grid.Column="2" Padding="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Margin="0,0,0,8"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="City Library" />

            <ListView
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.CityLibrary, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedCity, Mode=TwoWay}"
                SelectionMode="Single"
                CanDragItems="True"
                DragItemsStarting="CityListView_DragItemsStarting">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="domain:City">
                        <Grid Padding="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <FontIcon
                                Grid.Column="0"
                                FontSize="16"
                                Glyph="&#xE81D;"
                                Margin="0,0,8,0" />
                            <TextBlock
                                Grid.Column="1"
                                Text="{x:Bind Name}"
                                VerticalAlignment="Center" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <!--  Separator between City Library and Workflows (TODO: Replace with GridSplitter)  -->
        <Border
            Grid.Row="2"
            Grid.Column="3"
            Width="1"
            Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

        <!--  Column 4: Workflows  -->
        <Grid Grid.Row="2" Grid.Column="4" Padding="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Margin="0,0,0,8"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="Workflows" />

            <ListView
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Workflows, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedWorkflow, Mode=TwoWay}"
                SelectionMode="Single"
                CanDragItems="True"
                DragItemsStarting="WorkflowListView_DragItemsStarting">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodel:WorkflowViewModel">
                        <Grid Padding="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <FontIcon
                                Grid.Column="0"
                                FontSize="16"
                                Glyph="&#xE9D9;"
                                Margin="0,0,8,0" />
                            <TextBlock
                                Grid.Column="1"
                                Text="{x:Bind Name, Mode=OneWay}"
                                VerticalAlignment="Center" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <!--  Separator between Workflows and PropertyGrid (TODO: Replace with GridSplitter)  -->
        <Border
            Grid.Row="2"
            Grid.Column="5"
            Width="1"
            Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

        <!--  Column 6: PropertyGrid  -->
        <Grid Grid.Row="2" Grid.Column="6" Padding="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Padding="16,6,24,4"
                FontWeight="SemiBold"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="Properties" />

            <!-- Dynamic PropertyGrid that automatically shows all properties -->
            <local:SimplePropertyGrid 
                Grid.Row="1"
                x:Name="PropertyGrid"
                SelectedObject="{x:Bind CurrentSelectedObject, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.HasSelectedEntity, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

            <!--  Empty State (when nothing selected)  -->
            <StackPanel 
                Grid.Row="1"
                Spacing="16" 
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Margin="0,60,0,0"
                Visibility="{x:Bind ViewModel.HasSelectedEntity, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <FontIcon
                    FontSize="48"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Glyph="&#xE946;"
                    HorizontalAlignment="Center" />
                <TextBlock
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Text="No item selected"
                    TextAlignment="Center" />
                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Text="Select an item from the left to view and edit its properties"
                    TextAlignment="Center"
                    TextWrapping="Wrap"
                    MaxWidth="220" />
            </StackPanel>
        </Grid>
    </Grid>
</Page>
