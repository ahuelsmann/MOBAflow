<Page
    x:Class="Moba.WinUI.View.EditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:domain="using:Moba.Domain"
    xmlns:local="using:Moba.WinUI.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodel="using:Moba.SharedUI.ViewModel"
    xmlns:converter="using:Moba.WinUI.Converter"
    DataContext="{x:Bind ViewModel}"
    x:Name="PageRoot"
    mc:Ignorable="d">

    <Page.Resources>
        <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converter:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Page Header  -->
        <StackPanel Grid.Row="0" Margin="16,2,16,2" Spacing="8">
            <TextBlock FontWeight="Bold" Style="{StaticResource TitleTextBlockStyle}" Text="Editor" />
        </StackPanel>

        <!--  SelectorBar Navigation  -->
        <SelectorBar x:Name="EditorSelectorBar" Grid.Row="1" Margin="16,8,16,8" SelectionChanged="EditorSelectorBar_SelectionChanged">
            <SelectorBarItem x:Name="SolutionSelector" Text="Solution">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE8F1;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="JourneysSelector" Text="Journeys">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE81D;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="WorkflowsSelector" Text="Workflows">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE713;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
            <SelectorBarItem x:Name="TrainsSelector" Text="Trains">
                <SelectorBarItem.Icon>
                    <FontIcon Glyph="&#xE7C0;" />
                </SelectorBarItem.Icon>
            </SelectorBarItem>
        </SelectorBar>

        <!--  Content Area with Multi-Column Grids  -->
        <Grid Grid.Row="2">
            
            <!--  ============================================  -->
            <!--  ============================================  -->
            <!--  Solution Tab: Projects + PropertyGrid  -->
            <!--  ============================================  -->
            <Grid x:Name="SolutionContent" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="300" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="400" MinWidth="300" MaxWidth="600" />
                </Grid.ColumnDefinitions>

                <!--  Column 0: Projects  -->
                <Grid Grid.Column="0" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Projects" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SolutionViewModel.Projects, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedProject, Mode=TwoWay}" SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:ProjectViewModel">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE8F1;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 2: PropertyGrid  -->
                <Grid Grid.Column="2" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Properties" />
                    <local:SimplePropertyGrid Grid.Row="1" SelectedObject="{Binding CurrentSelectedObject, Mode=OneWay}" />
                </Grid>
            </Grid>

            <!--  ============================================  -->
            <!--  Journeys Tab: Journeys + Stations + City Library + PropertyGrid  -->
            <!--  ============================================  -->
            <Grid x:Name="JourneysContent" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250" MinWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="250" MinWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="250" MinWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" MinWidth="300" />
                </Grid.ColumnDefinitions>

                <!--  Column 0: Journeys  -->
                <Grid Grid.Column="0" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Journeys" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Journeys, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedJourney, Mode=TwoWay}" SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:JourneyViewModel">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE81D;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 2: Stations (of selected Journey)  -->
                <Grid Grid.Column="2" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Stations" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SelectedJourney.Stations, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedStation, Mode=TwoWay}" SelectionMode="Single" AllowDrop="True" DragOver="StationListView_DragOver" Drop="StationListView_Drop">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:StationViewModel">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE80F;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="3" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 4: City Library (for Drag & Drop)  -->
                <Grid Grid.Column="4" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="City Library" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.CityLibrary, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedCity, Mode=TwoWay}" SelectionMode="Single" CanDragItems="True" DragItemsStarting="CityListView_DragItemsStarting" DoubleTapped="CityListView_DoubleTapped">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="domain:City">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE80F;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="5" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 6: PropertyGrid  -->
                <Grid Grid.Column="6" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Properties" />
                    <local:SimplePropertyGrid Grid.Row="1" SelectedObject="{Binding CurrentSelectedObject, Mode=OneWay}" />
                </Grid>
            </Grid>

            <!--  ============================================  -->
            <!--  Workflows Tab: Workflows + Actions + PropertyGrid  -->
            <!--  ============================================  -->
            <Grid x:Name="WorkflowsContent" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300" MinWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="300" MinWidth="200" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" MinWidth="300" />
                </Grid.ColumnDefinitions>

                <!--  Column 0: Workflows  -->
                <Grid Grid.Column="0" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Workflows" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Workflows, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedWorkflow, Mode=TwoWay}" SelectionMode="Single" CanDragItems="True" DragItemsStarting="WorkflowListView_DragItemsStarting">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:WorkflowViewModel">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE713;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 2: Actions (of selected Workflow)  -->
                <Grid Grid.Column="2" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Actions" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SelectedWorkflow.Actions, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedAction, Mode=TwoWay}" SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE945;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{Binding}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="3" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <!--  Column 4: PropertyGrid  -->
                <Grid Grid.Column="4" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Properties" />
                    <local:SimplePropertyGrid Grid.Row="1" SelectedObject="{Binding CurrentSelectedObject, Mode=OneWay}" />
                </Grid>
            </Grid>

            <!--  ============================================  -->
            <!--  Trains Tab: Trains + PropertyGrid  -->
            <!--  ============================================  -->
            <Grid x:Name="TrainsContent" Visibility="Visible">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="350" MinWidth="300" MaxWidth="500" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Trains" />
                    <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.CurrentProjectViewModel.Trains, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedTrain, Mode=TwoWay}" SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodel:TrainViewModel">
                                <Grid Padding="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <FontIcon Grid.Column="0" FontSize="16" Glyph="&#xE7C0;" Margin="0,0,8,0" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name, Mode=OneWay}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                <Grid Grid.Column="2" Padding="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Padding="16,6,24,4" FontWeight="SemiBold" Style="{StaticResource SubtitleTextBlockStyle}" Text="Properties" />
                    <local:SimplePropertyGrid Grid.Row="1" SelectedObject="{Binding CurrentSelectedObject, Mode=OneWay}" />
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>











