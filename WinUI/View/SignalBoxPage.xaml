<Page
    x:Class="Moba.WinUI.View.SignalBoxPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Moba.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid
        x:Name="RootGrid"
        Padding="0"
        Background="{ThemeResource SolidBackgroundFillColorBaseBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Page Header - Fluent Design System  -->
        <Border
            x:Name="HeaderBorder"
            Grid.Row="0"
            Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
            BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
            BorderThickness="0,0,0,1">
            <Grid
                x:Name="HeaderGrid"
                Padding="32,16,32,16"
                ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Title  -->
                <StackPanel
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    Spacing="2">
                    <TextBlock
                        x:Name="TitleText"
                        FontSize="28"
                        FontWeight="SemiBold"
                        Text="Elektronisches Stellwerk" />
                    <TextBlock
                        FontSize="12"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="ESTW - Gleisbildstellwerk" />
                </StackPanel>

                <!--  Grid Toggle  -->
                <ToggleButton
                    x:Name="GridToggleButton"
                    Grid.Column="2"
                    VerticalAlignment="Center"
                    Checked="OnGridToggled"
                    IsChecked="True"
                    ToolTipService.ToolTip="Raster ein-/ausblenden"
                    Unchecked="OnGridToggled">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="16" Glyph="&#xE80A;" />
                        <TextBlock Text="Raster" />
                    </StackPanel>
                </ToggleButton>

                <!--  Toolbox Toggle (for Medium/Compact)  -->
                <ToggleButton
                    x:Name="ToolboxToggleButton"
                    Grid.Column="3"
                    VerticalAlignment="Center"
                    IsChecked="True"
                    ToolTipService.ToolTip="Toolbox ein-/ausblenden"
                    Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="16" Glyph="&#xE70F;" />
                        <TextBlock Text="Toolbox" />
                    </StackPanel>
                </ToggleButton>

                <!--  Properties Toggle (for Medium/Compact)  -->
                <ToggleButton
                    x:Name="PropertiesToggleButton"
                    Grid.Column="4"
                    VerticalAlignment="Center"
                    IsChecked="True"
                    ToolTipService.ToolTip="Eigenschaften ein-/ausblenden"
                    Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="16" Glyph="&#xE713;" />
                        <TextBlock Text="Eigenschaften" />
                    </StackPanel>
                </ToggleButton>

                <!--  Skin Selector Button with Flyout  -->
                <Button
                    x:Name="SkinSelectorButton"
                    Grid.Column="5"
                    VerticalAlignment="Center"
                    ToolTipService.ToolTip="Farbschema auswählen">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontSize="16" Glyph="&#xE790;" />
                            <TextBlock Text="Skin" />
                        </StackPanel>
                    </Button.Content>
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Width="200" Spacing="8">
                                <TextBlock
                                    FontSize="12"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="FARBSCHEMA WÄHLEN" />
                                <Button
                                    HorizontalAlignment="Stretch"
                                    Click="OnSkinSystemClicked"
                                    Tag="System">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border
                                            Width="20"
                                            Height="20"
                                            Background="{ThemeResource SystemAccentColor}"
                                            CornerRadius="4" />
                                        <TextBlock VerticalAlignment="Center" Text="System" />
                                    </StackPanel>
                                </Button>
                                <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />
                                <TextBlock
                                    FontSize="10"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="COLOR SKINS" />
                                <Button
                                    HorizontalAlignment="Stretch"
                                    Click="OnSkinBlueClicked"
                                    Tag="Blue">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border
                                            Width="20"
                                            Height="20"
                                            Background="#0078D4"
                                            CornerRadius="4" />
                                        <TextBlock VerticalAlignment="Center" Text="Blau" />
                                    </StackPanel>
                                </Button>
                                <Button
                                    HorizontalAlignment="Stretch"
                                    Click="OnSkinGreenClicked"
                                    Tag="Green">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border
                                            Width="20"
                                            Height="20"
                                            Background="#2ECC71"
                                            CornerRadius="4" />
                                        <TextBlock VerticalAlignment="Center" Text="Grün" />
                                    </StackPanel>
                                </Button>
                                <Button
                                    HorizontalAlignment="Stretch"
                                    Click="OnSkinOrangeClicked"
                                    Tag="Orange">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border
                                            Width="20"
                                            Height="20"
                                            Background="#FF6600"
                                            CornerRadius="4" />
                                        <TextBlock VerticalAlignment="Center" Text="Orange" />
                                    </StackPanel>
                                </Button>
                                <Button
                                    HorizontalAlignment="Stretch"
                                    Click="OnSkinRedClicked"
                                    Tag="Red">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border
                                            Width="20"
                                            Height="20"
                                            Background="#CC0000"
                                            CornerRadius="4" />
                                        <TextBlock VerticalAlignment="Center" Text="Red" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </Grid>
        </Border>

        <!--  Main Content: Toolbox | Canvas | Properties  -->
        <Grid
            x:Name="MainContentGrid"
            Grid.Row="1"
            Padding="0"
            ColumnSpacing="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="ToolboxColumn" Width="240" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition x:Name="PropertiesColumn" Width="300" />
            </Grid.ColumnDefinitions>

            <!--  LEFT: Toolbox Panel  -->
            <Border
                x:Name="ToolboxPanel"
                Grid.Column="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,1,0">
                <ScrollViewer Padding="0,0,4,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Padding="16" Spacing="20">
                        <!--  Toolbox Header  -->
                        <StackPanel Spacing="2">
                            <TextBlock
                                FontSize="16"
                                FontWeight="SemiBold"
                                Text="Elemente" />
                            <TextBlock
                                FontSize="11"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="Drag &amp; Drop auf Gleisbild" />
                        </StackPanel>

                        <!--  GLEISE Category  -->
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Text="GLEISE" />
                            <Grid ColumnSpacing="6" RowSpacing="6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <!--  Gerade  -->
                                <Border
                                    x:Name="ToolStraight"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="TrackStraight"
                                    ToolTipService.ToolTip="Gerades Gleis">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="Gerade" />
                                    </StackPanel>
                                </Border>
                                <!--  Kurve 90°  -->
                                <Border
                                    x:Name="ToolCurve90"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="TrackCurve"
                                    ToolTipService.ToolTip="Kurve 90°">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Path
                                                Data="M 4,14 Q 24,14 24,26"
                                                Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                StrokeThickness="3" />
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="Kurve" />
                                    </StackPanel>
                                </Border>
                                <!--  Prellbock  -->
                                <Border
                                    x:Name="ToolBufferStop"
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="TrackStraight"
                                    ToolTipService.ToolTip="Prellbock">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="32"
                                                    Y1="14"
                                                    Y2="14" />
                                                <Rectangle
                                                    Canvas.Left="32"
                                                    Canvas.Top="6"
                                                    Width="4"
                                                    Height="16"
                                                    Fill="#D32F2F"
                                                    RadiusX="1"
                                                    RadiusY="1" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="Prellbock" />
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>

                        <!--  Separator  -->
                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                        <!--  WEICHEN Category  -->
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Text="WEICHEN" />
                            <Grid ColumnSpacing="6" RowSpacing="6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <!--  Weiche Links  -->
                                <Border
                                    x:Name="ToolSwitchLeft"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="Switch"
                                    ToolTipService.ToolTip="Einfache Weiche Links">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <!--  Hauptgleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                                <!--  Abzweig  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="24"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="4" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="EW L" />
                                    </StackPanel>
                                </Border>
                                <!--  Weiche Rechts  -->
                                <Border
                                    x:Name="ToolSwitchRight"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="Switch"
                                    ToolTipService.ToolTip="Einfache Weiche Rechts">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <!--  Hauptgleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                                <!--  Abzweig  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="24"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="24" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="EW R" />
                                    </StackPanel>
                                </Border>
                                <!--  DKW  -->
                                <Border
                                    x:Name="ToolSwitchDouble"
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="Switch"
                                    ToolTipService.ToolTip="Doppelkreuzungsweiche">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <!--  Oberes Gleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="8"
                                                    Y2="8" />
                                                <!--  Unteres Gleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="20"
                                                    Y2="20" />
                                                <!--  Kreuzung  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="10"
                                                    X2="38"
                                                    Y1="8"
                                                    Y2="20" />
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="10"
                                                    X2="38"
                                                    Y1="20"
                                                    Y2="8" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="DKW" />
                                    </StackPanel>
                                </Border>
                                <!--  Kreuzung  -->
                                <Border
                                    x:Name="ToolCrossing"
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="TrackStraight"
                                    ToolTipService.ToolTip="Kreuzung">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="24"
                                                    X2="24"
                                                    Y1="2"
                                                    Y2="26" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="Kreuz" />
                                    </StackPanel>
                                </Border>
                                <!--  Dreiwege-Weiche  -->
                                <Border
                                    x:Name="ToolSwitchThreeWay"
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="Switch"
                                    ToolTipService.ToolTip="Dreiwege-Weiche">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <!--  Hauptgleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                                <!--  Abzweig oben  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="24"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="4" />
                                                <!--  Abzweig unten  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="2"
                                                    X1="24"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="24" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="DWW" />
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>

                        <!--  Separator  -->
                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                        <!--  SIGNAL Category - nur Ks-Signalschirm  -->
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Text="SIGNAL" />
                            <!--  Ks Signal Screen (UserControl)  -->
                            <Border
                                x:Name="ToolSignalKsScreen"
                                Height="70"
                                Padding="4"
                                Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CanDrag="True"
                                CornerRadius="6"
                                DragStarting="OnToolDragStarting"
                                PointerEntered="OnToolPointerEntered"
                                PointerExited="OnToolPointerExited"
                                Tag="Signal"
                                ToolTipService.ToolTip="Ks-Signalschirm (Mehrabschnittssignal)">
                                <StackPanel
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Spacing="4">
                                    <controls:KsSignalScreen
                                        Width="50"
                                        Height="40"
                                        HorizontalAlignment="Center"
                                        IsHitTestVisible="False" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="10"
                                        Text="Ks-Signal" />
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!--  Separator  -->
                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                        <!--  SONSTIGE Category  -->
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Text="SONSTIGE" />
                            <Grid ColumnSpacing="6" RowSpacing="6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <!--  Rückmelder  -->
                                <Border
                                    x:Name="ToolFeedback"
                                    Grid.Column="0"
                                    Height="60"
                                    Padding="4"
                                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CanDrag="True"
                                    CornerRadius="6"
                                    DragStarting="OnToolDragStarting"
                                    PointerEntered="OnToolPointerEntered"
                                    PointerExited="OnToolPointerExited"
                                    Tag="Detector"
                                    ToolTipService.ToolTip="Rückmelder">
                                    <StackPanel
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                                        <Border
                                            Width="48"
                                            Height="28"
                                            Background="{ThemeResource SolidBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4">
                                            <Canvas>
                                                <!--  Gleis  -->
                                                <Line
                                                    Stroke="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                    StrokeThickness="3"
                                                    X1="4"
                                                    X2="44"
                                                    Y1="14"
                                                    Y2="14" />
                                                <!--  Sensor-Markierung  -->
                                                <Ellipse
                                                    Canvas.Left="20"
                                                    Canvas.Top="10"
                                                    Width="8"
                                                    Height="8"
                                                    Fill="#00C800" />
                                            </Canvas>
                                        </Border>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Text="Rückm." />
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!--  CENTER: Stellwerk Canvas  -->
            <Border
                x:Name="CanvasBorder"
                Grid.Column="1"
                Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0">
                <ScrollViewer
                    x:Name="CanvasScrollViewer"
                    HorizontalScrollBarVisibility="Auto"
                    MaxZoomFactor="3.0"
                    MinZoomFactor="0.3"
                    VerticalScrollBarVisibility="Auto"
                    ZoomMode="Enabled">
                    <Canvas
                        x:Name="TrackCanvas"
                        Width="1920"
                        Height="1080"
                        AllowDrop="True"
                        Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
                        DragOver="OnCanvasDragOver"
                        Drop="OnCanvasDrop"
                        PointerMoved="OnCanvasPointerMoved"
                        PointerPressed="OnCanvasPointerPressed"
                        PointerReleased="OnCanvasPointerReleased" />
                </ScrollViewer>
            </Border>

            <!--  RIGHT: Properties Panel  -->
            <Border
                x:Name="PropertiesPanel"
                Grid.Column="2"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1,0,0,0">
                <ScrollViewer Padding="0,0,4,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Padding="16" Spacing="16">
                        <!--  Properties Header  -->
                        <StackPanel Spacing="2">
                            <TextBlock
                                FontSize="16"
                                FontWeight="SemiBold"
                                Text="Eigenschaften" />
                            <TextBlock
                                FontSize="11"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="Element bearbeiten" />
                        </StackPanel>

                        <!--  No Selection State  -->
                        <Border
                            x:Name="NoSelectionInfo"
                            Padding="16"
                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                            CornerRadius="6">
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="8">
                                <FontIcon
                                    FontSize="32"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Glyph="&#xE8B9;" />
                                <TextBlock
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="Kein Element ausgewählt"
                                    TextAlignment="Center" />
                                <TextBlock
                                    FontSize="11"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="Klicken Sie auf ein Element im Gleisbild"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <!--  Element Properties (Hidden when no selection)  -->
                        <StackPanel
                            x:Name="ElementPropertiesPanel"
                            Spacing="16"
                            Visibility="Collapsed">
                            <!--  Element Info  -->
                            <Border
                                Padding="12"
                                Background="{ThemeResource LayerFillColorDefaultBrush}"
                                CornerRadius="6">
                                <StackPanel Spacing="8">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="SemiBold"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                        Text="ELEMENT-INFO" />
                                    <Grid ColumnSpacing="12" RowSpacing="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            FontSize="12"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="Typ:" />
                                        <TextBlock
                                            x:Name="ElementTypeText"
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            FontSize="12"
                                            FontWeight="SemiBold"
                                            Text="--" />
                                        <TextBlock
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            FontSize="12"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="Position:" />
                                        <TextBlock
                                            x:Name="ElementPositionText"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            FontSize="12"
                                            Text="--" />
                                        <TextBlock
                                            Grid.Row="2"
                                            Grid.Column="0"
                                            FontSize="12"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="ID:" />
                                        <TextBlock
                                            x:Name="ElementIdText"
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            FontSize="10"
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            Text="--"
                                            TextTrimming="CharacterEllipsis" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!--  Rotation Control  -->
                            <StackPanel Spacing="8">
                                <TextBlock
                                    FontSize="11"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="DREHUNG" />
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Button
                                        x:Name="Rotate0Button"
                                        Grid.Column="0"
                                        HorizontalAlignment="Stretch"
                                        Click="OnRotateClicked"
                                        Content="0°"
                                        Tag="0" />
                                    <Button
                                        x:Name="Rotate90Button"
                                        Grid.Column="1"
                                        HorizontalAlignment="Stretch"
                                        Click="OnRotateClicked"
                                        Content="90°"
                                        Tag="90" />
                                    <Button
                                        x:Name="Rotate180Button"
                                        Grid.Column="2"
                                        HorizontalAlignment="Stretch"
                                        Click="OnRotateClicked"
                                        Content="180°"
                                        Tag="180" />
                                    <Button
                                        x:Name="Rotate270Button"
                                        Grid.Column="3"
                                        HorizontalAlignment="Stretch"
                                        Click="OnRotateClicked"
                                        Content="270°"
                                        Tag="270" />
                                </Grid>
                            </StackPanel>

                            <!--  Signal Configuration (only for signals)  -->
                            <StackPanel
                                x:Name="SignalAspectPanel"
                                Spacing="12"
                                Visibility="Collapsed">
                                <!--  Signal Type Selection  -->
                                <StackPanel Spacing="8">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="SemiBold"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                        Text="SIGNALTYP" />
                                    <ComboBox
                                        x:Name="SignalTypeComboBox"
                                        HorizontalAlignment="Stretch"
                                        SelectionChanged="OnSignalTypeChanged">
                                        <ComboBoxItem Content="Ks-Hauptsignal" Tag="KsMain" />
                                        <ComboBoxItem Content="Ks-Vorsignal" Tag="KsDistant" />
                                        <ComboBoxItem Content="Ks-Mehrabschnittssignal" Tag="KsMulti" />
                                        <ComboBoxItem Content="Rangiersignal (Ra12)" Tag="Shunt" />
                                        <ComboBoxItem Content="Gleissperrsignal" Tag="Block" />
                                    </ComboBox>
                                </StackPanel>

                                <!--  Current Signal Preview  -->
                                <Border
                                    Padding="12"
                                    HorizontalAlignment="Center"
                                    Background="#1E1E1E"
                                    CornerRadius="6">
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="10"
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            Text="AKTUELLES SIGNALBILD" />
                                        <controls:KsSignalScreen
                                            x:Name="SignalPreview"
                                            Width="60"
                                            Height="80"
                                            HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>

                                <!--  Signal Aspect Selection  -->
                                <StackPanel Spacing="8">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="SemiBold"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                        Text="SIGNALBILD WÄHLEN" />
                                    <Grid ColumnSpacing="6" RowSpacing="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!--  Row 0: Hp0, Ks1, Ks2  -->
                                        <!--  Hp0 - Halt (Rot)  -->
                                        <Border
                                            x:Name="AspectHp0Button"
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Hp0"
                                            ToolTipService.ToolTip="Hp 0 - Halt">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectHp0Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Hp0" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Ks1 - Fahrt (Grün)  -->
                                        <Border
                                            x:Name="AspectKs1Button"
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Ks1"
                                            ToolTipService.ToolTip="Ks 1 - Fahrt">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectKs1Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Ks1" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Ks2 - Halt erwarten (Gelb)  -->
                                        <Border
                                            x:Name="AspectKs2Button"
                                            Grid.Row="0"
                                            Grid.Column="2"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Ks2"
                                            ToolTipService.ToolTip="Ks 2 - Halt erwarten">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectKs2Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Ks2" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Row 1: Ks1Blink, Kennlicht, Dunkel  -->
                                        <!--  Ks1 Blink - Fahrt mit Zs3v  -->
                                        <Border
                                            x:Name="AspectKs1BlinkButton"
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Ks1Blink"
                                            ToolTipService.ToolTip="Ks 1 blinkend - Fahrt mit Geschwindigkeitsvoranzeiger">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectKs1BlinkSignal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Ks1 Bl" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Kennlicht - Signal abgeschaltet  -->
                                        <Border
                                            x:Name="AspectKennlichtButton"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Kennlicht"
                                            ToolTipService.ToolTip="Kennlicht - Signal betrieblich abgeschaltet">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectKennlichtSignal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Kennl." />
                                            </StackPanel>
                                        </Border>

                                        <!--  Dunkel - Signal aus  -->
                                        <Border
                                            x:Name="AspectDunkelButton"
                                            Grid.Row="1"
                                            Grid.Column="2"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Dunkel"
                                            ToolTipService.ToolTip="Dunkelschaltung - Signal nicht aktiv">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectDunkelSignal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Dunkel" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Row 2: Sh1/Ra12, Zs1, Zs7  -->
                                        <!--  Sh1/Ra12 - Rangierfahrt erlaubt  -->
                                        <Border
                                            x:Name="AspectRa12Button"
                                            Grid.Row="2"
                                            Grid.Column="0"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Ra12"
                                            ToolTipService.ToolTip="Sh 1/Ra 12 - Rangierfahrt erlaubt">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectRa12Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Ra12" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Zs1 - Ersatzsignal  -->
                                        <Border
                                            x:Name="AspectZs1Button"
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Zs1"
                                            ToolTipService.ToolTip="Zs 1 - Ersatzsignal (weiß blinkend)">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectZs1Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Zs1" />
                                            </StackPanel>
                                        </Border>

                                        <!--  Zs7 - Vorsichtsignal  -->
                                        <Border
                                            x:Name="AspectZs7Button"
                                            Grid.Row="2"
                                            Grid.Column="2"
                                            Height="80"
                                            Padding="4"
                                            Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            PointerPressed="OnAspectClicked"
                                            Tag="Zs7"
                                            ToolTipService.ToolTip="Zs 7 - Vorsichtsignal (3x gelb)">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                                <controls:KsSignalScreen
                                                    x:Name="AspectZs7Signal"
                                                    Width="40"
                                                    Height="50"
                                                    IsHitTestVisible="False" />
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="9"
                                                    Text="Zs7" />
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>

                            <!--  Switch Position Control (only for switches)  -->
                            <StackPanel
                                x:Name="SwitchPositionPanel"
                                Spacing="8"
                                Visibility="Collapsed">
                                <TextBlock
                                    FontSize="11"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="WEICHENSTELLUNG" />
                                <TextBlock
                                    FontSize="10"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="Doppelklick auf Weiche zum Umschalten" />
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition x:Name="ThirdSwitchColumn" Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Button
                                        x:Name="SwitchStraightButton"
                                        Grid.Column="0"
                                        HorizontalAlignment="Stretch"
                                        Click="OnSwitchPositionClicked"
                                        Tag="Straight">
                                        <StackPanel Spacing="4">
                                            <FontIcon FontSize="16" Glyph="&#xE72A;" />
                                            <TextBlock FontSize="10" Text="Gerade" />
                                        </StackPanel>
                                    </Button>
                                    <Button
                                        x:Name="SwitchLeftButton"
                                        Grid.Column="1"
                                        HorizontalAlignment="Stretch"
                                        Click="OnSwitchPositionClicked"
                                        Tag="DivergingLeft">
                                        <StackPanel Spacing="4">
                                            <FontIcon FontSize="16" Glyph="&#xE76B;" />
                                            <TextBlock FontSize="10" Text="Links" />
                                        </StackPanel>
                                    </Button>
                                    <Button
                                        x:Name="SwitchRightButton"
                                        Grid.Column="2"
                                        HorizontalAlignment="Stretch"
                                        Click="OnSwitchPositionClicked"
                                        Tag="DivergingRight">
                                        <StackPanel Spacing="4">
                                            <FontIcon FontSize="16" Glyph="&#xE76C;" />
                                            <TextBlock FontSize="10" Text="Rechts" />
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </StackPanel>

                            <!--  Separator  -->
                            <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                            <!--  Address Configuration  -->
                            <StackPanel Spacing="8">
                                <TextBlock
                                    FontSize="11"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="ADRESSE" />
                                <NumberBox
                                    x:Name="ElementAddressBox"
                                    Header="DCC-Adresse"
                                    Maximum="2048"
                                    Minimum="1"
                                    PlaceholderText="1-2048"
                                    SpinButtonPlacementMode="Compact"
                                    ValueChanged="OnAddressChanged" />
                            </StackPanel>

                            <!--  Delete Button  -->
                            <Button
                                x:Name="DeleteElementButton"
                                HorizontalAlignment="Stretch"
                                Click="OnDeleteElementClicked"
                                Style="{ThemeResource AccentButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon FontSize="14" Glyph="&#xE74D;" />
                                    <TextBlock Text="Element löschen" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!--  Statistics  -->
                        <Border
                            Padding="12"
                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                            CornerRadius="6">
                            <StackPanel Spacing="8">
                                <TextBlock
                                    FontSize="11"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Text="STATISTIK" />
                                <Grid ColumnSpacing="12" RowSpacing="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="Gleise:" />
                                    <TextBlock
                                        x:Name="TrackCountText"
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Text="0" />
                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="Weichen:" />
                                    <TextBlock
                                        x:Name="SwitchCountText"
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Text="0" />
                                    <TextBlock
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="Signale:" />
                                    <TextBlock
                                        x:Name="SignalCountText"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Text="0" />
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!--  VisualStateManager for Responsive Layout  -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="WindowStates">
                <!--  Wide State: All three columns visible (>1200px)  -->
                <VisualState x:Name="WideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1200" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ToolboxColumn.Width" Value="240" />
                        <Setter Target="PropertiesColumn.Width" Value="300" />
                        <Setter Target="ToolboxPanel.Visibility" Value="Visible" />
                        <Setter Target="PropertiesPanel.Visibility" Value="Visible" />
                        <Setter Target="ToolboxToggleButton.Visibility" Value="Collapsed" />
                        <Setter Target="PropertiesToggleButton.Visibility" Value="Collapsed" />
                    </VisualState.Setters>
                </VisualState>
                <!--  Medium State: Toggle panels (800-1200px)  -->
                <VisualState x:Name="MediumState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ToolboxColumn.Width" Value="200" />
                        <Setter Target="PropertiesColumn.Width" Value="250" />
                        <Setter Target="ToolboxPanel.Visibility" Value="Visible" />
                        <Setter Target="PropertiesPanel.Visibility" Value="Visible" />
                        <Setter Target="ToolboxToggleButton.Visibility" Value="Visible" />
                        <Setter Target="PropertiesToggleButton.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>
                <!--  Compact State: Only canvas with flyouts (<800px)  -->
                <VisualState x:Name="CompactState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ToolboxColumn.Width" Value="0" />
                        <Setter Target="PropertiesColumn.Width" Value="0" />
                        <Setter Target="ToolboxPanel.Visibility" Value="Collapsed" />
                        <Setter Target="PropertiesPanel.Visibility" Value="Collapsed" />
                        <Setter Target="ToolboxToggleButton.Visibility" Value="Visible" />
                        <Setter Target="PropertiesToggleButton.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
