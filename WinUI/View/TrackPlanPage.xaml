<Page
    x:Class="Moba.WinUI.View.TrackPlanPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Page Header  -->
        <StackPanel
            Grid.Row="0"
            Padding="24,16"
            Orientation="Horizontal"
            Spacing="12">
            <FontIcon FontSize="24" Glyph="&#xE809;" />
            <TextBlock
                VerticalAlignment="Center"
                Style="{StaticResource TitleTextBlockStyle}"
                Text="Track Plan" />
            <TextBlock
                VerticalAlignment="Center"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Style="{StaticResource BodyTextBlockStyle}"
                Text="Physical layout with sensor positions" />
        </StackPanel>

        <!--  Track Plan Container  -->
        <Grid
            Grid.Row="1"
            Margin="24,0"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            CornerRadius="8">

            <!--  SVG/Image will be loaded here  -->
            <Canvas x:Name="TrackCanvas">
                <!--  Placeholder: Track plan will be rendered here  -->
            </Canvas>

            <!--  Sensor Markers Overlay  -->
            <ItemsControl x:Name="SensorMarkers" ItemsSource="{x:Bind ViewModel.SensorMarkers, Mode=OneWay}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid
                            Canvas.Left="{Binding X}"
                            Canvas.Top="{Binding Y}"
                            Width="32"
                            Height="32">
                            <Ellipse
                                Fill="{Binding IsActive, Converter={StaticResource BoolToColorConverter}}"
                                Stroke="{ThemeResource AccentFillColorDefaultBrush}"
                                StrokeThickness="2" />
                            <TextBlock
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontWeight="Bold"
                                Foreground="White"
                                Text="{Binding InPort}" />
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!--  Train Position Indicator  -->
            <Grid
                x:Name="TrainIndicator"
                Width="48"
                Height="48"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Visibility="{x:Bind ViewModel.IsTrainVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <Ellipse Fill="{ThemeResource AccentFillColorDefaultBrush}" Opacity="0.3" />
                <FontIcon
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="24"
                    Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                    Glyph="&#xE7C1;" />
            </Grid>

            <!--  Placeholder message when no track plan loaded  -->
            <StackPanel
                x:Name="PlaceholderPanel"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{x:Bind ViewModel.HasTrackPlan, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}">
                <FontIcon
                    Margin="0,0,0,16"
                    FontSize="64"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Glyph="&#xE8B9;" />
                <TextBlock
                    HorizontalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource SubtitleTextBlockStyle}"
                    Text="No Track Plan Loaded" />
                <TextBlock
                    Margin="0,8,0,16"
                    HorizontalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Text="Import an SVG file from AnyRail to visualize your layout" />
                <Button
                    HorizontalAlignment="Center"
                    Command="{x:Bind ViewModel.ImportTrackPlanCommand}"
                    Content="Import SVG..."
                    Style="{StaticResource AccentButtonStyle}" />
            </StackPanel>
        </Grid>

        <!--  Status Bar  -->
        <Grid
            Grid.Row="2"
            Padding="24,12"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            ColumnSpacing="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!--  Current Station  -->
            <StackPanel
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="8">
                <FontIcon
                    FontSize="16"
                    Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                    Glyph="&#xE80F;" />
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="Station:" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontWeight="SemiBold"
                    Text="{x:Bind ViewModel.CurrentStationName, Mode=OneWay}" />
            </StackPanel>

            <!--  Lap Counter  -->
            <StackPanel
                Grid.Column="1"
                Orientation="Horizontal"
                Spacing="8">
                <FontIcon
                    FontSize="16"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Glyph="&#xE8EE;" />
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="Lap:" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontWeight="SemiBold"
                    Text="{x:Bind ViewModel.CurrentLapDisplay, Mode=OneWay}" />
            </StackPanel>

            <!--  Journey Name  -->
            <StackPanel
                Grid.Column="2"
                Orientation="Horizontal"
                Spacing="8">
                <FontIcon
                    FontSize="16"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Glyph="&#xE81D;" />
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="Journey:" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontWeight="SemiBold"
                    Text="{x:Bind ViewModel.CurrentJourneyName, Mode=OneWay}" />
            </StackPanel>

            <!--  Sensor Status  -->
            <StackPanel
                Grid.Column="4"
                Orientation="Horizontal"
                Spacing="8">
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Text="Sensors:" />
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="{x:Bind ViewModel.SensorStatusText, Mode=OneWay}" />
            </StackPanel>
        </Grid>
    </Grid>
</Page>


