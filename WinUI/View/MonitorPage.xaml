<Page
    x:Class="Moba.WinUI.View.MonitorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="using:Moba.WinUI.Converter"
    xmlns:model="using:Moba.Backend.Model"
    DataContext="{x:Bind ViewModel}">

    <Page.Resources>
        <converter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converter:BoolToFontWeightConverter x:Key="BoolToFontWeightConverter" />
        <converter:BoolToFeedbackBackgroundConverter x:Key="BoolToFeedbackBackgroundConverter" />
        <converter:BoolToScrollIconConverter x:Key="BoolToScrollIconConverter" />
        <converter:BoolToScrollTextConverter x:Key="BoolToScrollTextConverter" />
    </Page.Resources>

    <Grid Padding="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Title  -->
        <TextBlock
            Grid.Row="0"
            Padding="8,0,0,0"
            Style="{StaticResource TitleTextBlockStyle}"
            Text="Monitor" />

        <!--  Main Content: Traffic + Activity Logs  -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="35*" MinWidth="350" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="65*" MinWidth="400" />
            </Grid.ColumnDefinitions>

            <!--  Traffic Packets List  -->
            <Grid Grid.Column="0" Padding="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Section Header  -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Column="0"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Z21 Traffic" />

                    <ToggleButton
                        Grid.Column="1"
                        Margin="0,0,8,0"
                        IsChecked="{x:Bind ViewModel.IsTrafficScrollPaused, Mode=TwoWay}"
                        ToolTipService.ToolTip="Pause auto-scroll (allows manual scrolling)">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon FontSize="14" Glyph="{x:Bind ViewModel.IsTrafficScrollPaused, Mode=OneWay, Converter={StaticResource BoolToScrollIconConverter}}" />
                            <TextBlock Text="{x:Bind ViewModel.IsTrafficScrollPaused, Mode=OneWay, Converter={StaticResource BoolToScrollTextConverter}}" />
                        </StackPanel>
                    </ToggleButton>

                    <Button
                        Grid.Column="2"
                        Command="{x:Bind ViewModel.ClearTrafficCommand}"
                        ToolTipService.ToolTip="Clear all traffic packets">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon FontSize="14" Glyph="&#xE74D;" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!--  Column Headers  -->
                <Grid
                    Grid.Row="1"
                    Padding="12,4"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    ColumnSpacing="12"
                    CornerRadius="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90" />
                        <ColumnDefinition Width="30" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Column="0"
                        FontFamily="Consolas"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="TIME" />
                    <TextBlock
                        Grid.Column="1"
                        FontFamily="Consolas"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="DIR" />
                    <TextBlock
                        Grid.Column="2"
                        FontFamily="Consolas"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="INPORT" />
                    <TextBlock
                        Grid.Column="3"
                        FontFamily="Consolas"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="PACKET TYPE" />
                </Grid>

                <!--  Traffic ListView  -->
                <ListView
                    x:Name="TrafficListView"
                    Grid.Row="2"
                    Margin="0,4,0,0"
                    ItemsSource="{x:Bind ViewModel.TrafficPackets, Mode=OneWay}"
                    SelectionMode="None">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="model:Z21TrafficPacket">
                            <Grid
                                Padding="12,4"
                                Background="{x:Bind IsFeedbackRelated, Converter={StaticResource BoolToFeedbackBackgroundConverter}}"
                                ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="90" />
                                    <ColumnDefinition Width="30" />
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!--  Row 1: Time + Direction + InPort + Packet Type  -->
                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontFamily="Consolas"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind TimestampFormatted}" />

                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    FontFamily="Consolas"
                                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind DirectionIcon}" />

                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    FontFamily="Consolas"
                                    FontWeight="SemiBold"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind InPortFormatted}"
                                    Visibility="{x:Bind IsFeedbackRelated, Converter={StaticResource BoolToVisibilityConverter}}" />

                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="3"
                                    FontFamily="Consolas"
                                    FontWeight="{x:Bind IsFeedbackRelated, Converter={StaticResource BoolToFontWeightConverter}}"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind PacketType}"
                                    TextTrimming="CharacterEllipsis" />

                                <!--  Row 2: Byte Sequence (unter Packet Type)  -->
                                <TextBlock
                                    Grid.Row="1"
                                    Grid.Column="3"
                                    Margin="0,2,0,0"
                                    FontFamily="Consolas"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind DataHex}"
                                    TextTrimming="CharacterEllipsis" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <!--  Vertical Divider  -->
            <Border
                Grid.Column="1"
                Width="1"
                Margin="8,0"
                Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

            <!--  Activity Logs  -->
            <Grid Grid.Column="2" Padding="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Section Header  -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Column="0"
                        Margin="0,0,0,8"
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Text="Application Log" />

                    <ToggleButton
                        Grid.Column="1"
                        Margin="0,0,8,0"
                        IsChecked="{x:Bind ViewModel.IsActivityLogScrollPaused, Mode=TwoWay}"
                        ToolTipService.ToolTip="Pause auto-scroll (allows manual scrolling)">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon FontSize="14" Glyph="{x:Bind ViewModel.IsActivityLogScrollPaused, Mode=OneWay, Converter={StaticResource BoolToScrollIconConverter}}" />
                            <TextBlock Text="{x:Bind ViewModel.IsActivityLogScrollPaused, Mode=OneWay, Converter={StaticResource BoolToScrollTextConverter}}" />
                        </StackPanel>
                    </ToggleButton>

                    <Button
                        Grid.Column="2"
                        Command="{x:Bind ViewModel.ClearActivityLogsCommand}"
                        ToolTipService.ToolTip="Clear activity logs">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon FontSize="14" Glyph="&#xE74D;" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!--  Column Header  -->
                <Grid
                    Grid.Row="1"
                    Padding="12,4"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    CornerRadius="4">
                    <TextBlock
                        FontFamily="Consolas"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="LOG" />
                </Grid>

                <!--  Logs ListView  -->
                <ListView
                    x:Name="ActivityLogListView"
                    Grid.Row="2"
                    Margin="0,4,0,0"
                    ItemsSource="{x:Bind ViewModel.ActivityLogs, Mode=OneWay}"
                    SelectionMode="None">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="x:String">
                            <TextBlock
                                Padding="12,4"
                                FontFamily="Consolas"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Text="{x:Bind}"
                                TextWrapping="Wrap" />
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Grid>
    </Grid>
</Page>