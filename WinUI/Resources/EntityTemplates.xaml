<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behavior="using:Moba.WinUI.Behavior"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:selector="using:Moba.WinUI.Selector"
    xmlns:vm="using:Moba.SharedUI.ViewModel"
    xmlns:vmAction="using:Moba.SharedUI.ViewModel.Action">

    <!--  ============================================  -->
    <!--  Journey Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="JourneyTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <!--  Header  -->
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Journey Properties" />

                <!--  Runtime State Section  -->
                <StackPanel
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="4"
                    Spacing="8">
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{ThemeResource CaptionTextBlockStyle}"
                        Text="RUNTIME STATE" />
                    <Grid ColumnSpacing="16" RowSpacing="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Text="Counter:" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentCounter, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Text="Position:" />
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentPos, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="Current Station:" />
                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentStation, Mode=OneWay}" />
                    </Grid>
                </StackPanel>

                <!--  Name  -->
                <TextBox
                    Header="Name"
                    PlaceholderText="Enter journey name"
                    Text="{Binding Name, Mode=TwoWay}" />

                <!--  Description  -->
                <TextBox
                    Height="80"
                    AcceptsReturn="True"
                    Header="Description"
                    PlaceholderText="Enter description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <!--  InPort  -->
                <NumberBox
                    Header="InPort"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding InPort, Mode=TwoWay}" />

                <!--  FirstPos  -->
                <NumberBox
                    Header="First Position"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding FirstPos, Mode=TwoWay}" />

                <!--  Behavior On Last Stop  -->
                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Behavior On Last Stop"
                    ItemsSource="{Binding BehaviorOnLastStopValues}"
                    SelectedItem="{Binding BehaviorOnLastStop, Mode=TwoWay}" />

                <!--  Timer Settings  -->
                <StackPanel Spacing="12">
                    <CheckBox Content="Use Timer To Ignore Feedbacks" IsChecked="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=TwoWay}" />

                    <NumberBox
                        Header="Timer Interval (seconds)"
                        IsEnabled="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=OneWay}"
                        Minimum="1"
                        SpinButtonPlacementMode="Inline"
                        Value="{Binding IntervalForTimerToIgnoreFeedbacks, Mode=TwoWay}" />
                </StackPanel>

                <!--  Text-to-Speech Template  -->
                <TextBox
                    Height="240"
                    AcceptsReturn="True"
                    Header="Text-to-Speech Template"
                    PlaceholderText="e.g., '{TrainName} is arriving at {StationName}'"
                    Text="{Binding Text, Mode=TwoWay}"
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Station Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="StationTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Station Properties" />

                <TextBox
                    Header="Name"
                    PlaceholderText="Station name"
                    Text="{Binding Name, Mode=TwoWay}" />

                <!--<TextBox
                    Height="60"
                    AcceptsReturn="True"
                    Header="Description"
                    PlaceholderText="Optional description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />-->

                <NumberBox
                    Header="InPort"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding InPort, Mode=TwoWay}" />

                <NumberBox
                    Header="Number Of Laps To Stop"
                    Minimum="1"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding NumberOfLapsToStop, Mode=TwoWay}" />

                <CheckBox Content="Exit On Left Side" IsChecked="{Binding IsExitOnLeft, Mode=TwoWay}" />

                <!--  Workflow Assignment (Drop Target)  -->
                <TextBlock
                    Margin="0,8,0,4"
                    Style="{ThemeResource BaseTextBlockStyle}"
                    Text="Workflow" />
                <Grid Background="Transparent">
                    <i:Interaction.Behaviors>
                        <behavior:WorkflowDropBehavior Command="{Binding AssignWorkflowCommand}" />
                    </i:Interaction.Behaviors>
                    <!--  Dashed Border Background  -->
                    <Rectangle
                        RadiusX="6"
                        RadiusY="6"
                        Stroke="{ThemeResource AccentFillColorDefaultBrush}"
                        StrokeDashArray="4,2"
                        StrokeThickness="1.5" />
                    <!--  Content  -->
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="{Binding WorkflowName, Mode=OneWay, TargetNullValue='Drop workflow here...'}" />
                        <FontIcon
                            Grid.Column="1"
                            FontSize="14"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Glyph="&#xE74B;"
                            ToolTipService.ToolTip="Drag a workflow from the library" />
                    </Grid>
                </Grid>

                <!--  Schedule  -->
                <!--<TextBlock
                    Margin="0,8,0,4"
                    Style="{ThemeResource BaseTextBlockStyle}"
                    Text="Schedule" />-->

                <TimePicker
                    ClockIdentifier="24HourClock"
                    Header="Arrival Time"
                    Time="{Binding Arrival, Mode=TwoWay, Converter={StaticResource DateTimeToTimeSpanConverter}}" />

                <TimePicker
                    ClockIdentifier="24HourClock"
                    Header="Departure Time"
                    Time="{Binding Departure, Mode=TwoWay, Converter={StaticResource DateTimeToTimeSpanConverter}}" />

                <!--<NumberBox
                    Header="Track Number"
                    Minimum="1"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Track, Mode=TwoWay}" />-->
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Default Template (Fallback)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="DefaultTemplate">
        <StackPanel
            Padding="16"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
            <TextBlock
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Style="{ThemeResource BodyTextBlockStyle}"
                Text="No editor available"
                TextAlignment="Center" />
            <TextBlock
                Margin="0,4,0,0"
                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                Style="{ThemeResource CaptionTextBlockStyle}"
                Text="Select an entity to edit its properties"
                TextAlignment="Center" />
        </StackPanel>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Workflow Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="WorkflowTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <!--  Header  -->
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Workflow Properties" />

                <!--  Name  -->
                <TextBox
                    Header="Name"
                    PlaceholderText="Enter workflow name"
                    Text="{Binding Name, Mode=TwoWay}" />

                <!--  Description  -->
                <TextBox
                    Height="80"
                    AcceptsReturn="True"
                    Header="Description"
                    PlaceholderText="Enter description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <!--  InPort  -->
                <NumberBox
                    Header="InPort (Trigger)"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding InPort, Mode=TwoWay}" />

                <!--  Timer Settings  -->
                <StackPanel Spacing="12">
                    <CheckBox Content="Use Timer To Ignore Feedbacks" IsChecked="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=TwoWay}" />

                    <NumberBox
                        Header="Timer Interval (seconds)"
                        IsEnabled="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=OneWay}"
                        Minimum="1"
                        SpinButtonPlacementMode="Inline"
                        Value="{Binding IntervalForTimerToIgnoreFeedbacks, Mode=TwoWay}" />
                </StackPanel>

                <!--  Execution Mode  -->
                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Execution Mode"
                    ItemsSource="{Binding ExecutionModeValues, Mode=OneWay}"
                    SelectedItem="{Binding ExecutionMode, Mode=TwoWay}" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{ThemeResource CaptionTextBlockStyle}"
                    Text="Sequential: Actions run one-by-one, DelayAfterMs adds pause after completion. Parallel: Actions start staggered, DelayAfterMs controls start offset (cumulative)."
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="TrainTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Train Properties" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <TextBox
                    MinHeight="80"
                    AcceptsReturn="True"
                    Header="Description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Train Type"
                    ItemsSource="{Binding TrainTypeValues}"
                    SelectedItem="{Binding TrainType, Mode=TwoWay}" />

                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Service Type"
                    ItemsSource="{Binding ServiceTypeValues}"
                    SelectedItem="{Binding ServiceType, Mode=TwoWay}" />

                <CheckBox Content="Is Double Traction" IsChecked="{Binding IsDoubleTraction, Mode=TwoWay}" />

                <TextBlock
                    Margin="0,16,0,0"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Composition" />

                <StackPanel Spacing="8">
                    <TextBlock FontWeight="SemiBold" Text="Locomotives" />
                    <ListView
                        MaxHeight="200"
                        ItemsSource="{Binding Locomotives, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock FontWeight="SemiBold" Text="Wagons" />
                    <ListView
                        MaxHeight="200"
                        ItemsSource="{Binding Wagons, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="ProjectTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Project Properties" />

                <!--  Project Statistics  -->
                <StackPanel
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="4"
                    Spacing="8">
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{ThemeResource CaptionTextBlockStyle}"
                        Text="PROJECT STATISTICS" />
                    <Grid ColumnSpacing="16" RowSpacing="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Text="Journeys:" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding JourneyCount, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Text="Workflows:" />
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding WorkflowCount, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="Trains:" />
                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding TrainCount, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="3"
                            Grid.Column="0"
                            Text="Locomotives:" />
                        <TextBlock
                            Grid.Row="3"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding LocomotiveCount, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="4"
                            Grid.Column="0"
                            Text="Wagons:" />
                        <TextBlock
                            Grid.Row="4"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding WagonCount, Mode=OneWay}" />
                    </Grid>
                </StackPanel>

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  Action Templates (Polymorphic)  -->
    <DataTemplate x:Key="AnnouncementActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Announcement Action" />

                <TextBox
                    Header="Name"
                    PlaceholderText="e.g., Arrival Announcement"
                    Text="{Binding Name, Mode=TwoWay}" />

                <TextBox
                    MinHeight="100"
                    AcceptsReturn="True"
                    Header="Message"
                    PlaceholderText="e.g., '{TrainName} is arriving at {StationName}'"
                    Text="{Binding Message, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <TextBox
                    Header="Voice Name"
                    PlaceholderText="e.g., de-DE-KatjaNeural"
                    Text="{Binding VoiceName, Mode=TwoWay}" />

                <NumberBox
                    Header="Rate (Speech Speed)"
                    Maximum="10"
                    Minimum="-10"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Rate, Mode=TwoWay}" />

                <NumberBox
                    Header="Delay After (ms)"
                    Maximum="60000"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    ToolTipService.ToolTip="Wait time after this action completes (Sequential mode only)"
                    Value="{Binding DelayAfterMs, Mode=TwoWay}" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{ThemeResource CaptionTextBlockStyle}"
                    Text="Volume is controlled via Windows system volume settings. Use Drag &amp; Drop in the Actions list to change execution order. DelayAfterMs applies only in Sequential mode."
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="AudioActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Audio Action" />

                <TextBox
                    Header="Name"
                    PlaceholderText="e.g., Station Bell"
                    Text="{Binding Name, Mode=TwoWay}" />

                <StackPanel Spacing="8">
                    <TextBlock Text="File Path" />
                    <Grid ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox
                            Grid.Column="0"
                            PlaceholderText="Resources\Sounds\Station\sound.wav"
                            Text="{Binding FilePath, Mode=TwoWay}" />
                        <Button
                            Grid.Column="1"
                            Command="{Binding BrowseForFileCommand}"
                            Content="Browse..."
                            ToolTipService.ToolTip="Select an audio file" />
                    </Grid>
                </StackPanel>

                <NumberBox
                    Header="Delay After (ms)"
                    Maximum="60000"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    ToolTipService.ToolTip="Wait time after this action completes (Sequential mode only)"
                    Value="{Binding DelayAfterMs, Mode=TwoWay}" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{ThemeResource CaptionTextBlockStyle}"
                    Text="Volume is controlled via Windows system volume settings. The audio file will play once when this action is triggered. Use Drag &amp; Drop to change execution order. DelayAfterMs applies only in Sequential mode."
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="CommandActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Command Action" />

                <TextBox
                    Header="Name"
                    PlaceholderText="e.g., Stop Loco 101"
                    Text="{Binding Name, Mode=TwoWay}" />

                <!--  Address  -->
                <NumberBox
                    Header="Address"
                    Maximum="10239"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Address, Mode=TwoWay}" />

                <!--  Speed  -->
                <NumberBox
                    Header="Speed"
                    Maximum="127"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Speed, Mode=TwoWay}" />

                <!--  Direction  -->
                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Direction"
                    ItemsSource="{Binding DirectionValues}"
                    SelectedItem="{Binding Direction, Mode=TwoWay}" />

                <NumberBox
                    Header="Delay After (ms)"
                    Maximum="60000"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    ToolTipService.ToolTip="Wait time after this command executes (Sequential mode only)"
                    Value="{Binding DelayAfterMs, Mode=TwoWay}" />

                <!--  Raw Z21 Bytes (Advanced)  -->
                <TextBox
                    Height="80"
                    AcceptsReturn="True"
                    Header="Digital command byte sequence in hex format"
                    IsReadOnly="True"
                    Text="{Binding BytesHex, Mode=OneWay}"
                    TextWrapping="Wrap" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Style="{ThemeResource CaptionTextBlockStyle}"
                    Text="Decoded from Z21 DCC command format. Edit the command in Z21 app or use raw bytes directly. Use Drag &amp; Drop to change execution order. DelayAfterMs applies only in Sequential mode."
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  Generic Action Template (Fallback)  -->
    <DataTemplate x:Key="ActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Workflow Action" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{Binding Type}" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="Select specific action type in Workflow for detailed properties. Use Drag &amp; Drop to change execution order."
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Locomotive Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="LocomotiveTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Locomotive Properties" />

                <!--  Basic Information  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Basic Information" />

                        <TextBox
                            Header="Name"
                            PlaceholderText="Enter locomotive name"
                            Text="{Binding Name, Mode=TwoWay}" />

                        <NumberBox
                            Header="Digital Address (optional)"
                            Maximum="10239"
                            Minimum="1"
                            PlaceholderText="DCC address"
                            SpinButtonPlacementMode="Inline"
                            Value="{Binding DigitalAddress, Mode=TwoWay, Converter={StaticResource NullableUIntConverter}}" />
                    </StackPanel>
                </Border>

                <!--  Purchase Information  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Purchase Information" />

                        <TextBox
                            Header="Manufacturer"
                            PlaceholderText="e.g., Piko, Roco, Fleischmann"
                            Text="{Binding Manufacturer, Mode=TwoWay}" />

                        <TextBox
                            Header="Article Number"
                            PlaceholderText="Product SKU/article code"
                            Text="{Binding ArticleNumber, Mode=TwoWay}" />

                        <CalendarDatePicker
                            Header="Invoice Date (optional)"
                            PlaceholderText="Select date"
                            Date="{Binding InvoiceDate, Mode=TwoWay, Converter={StaticResource DateTimeOffsetConverter}}" />

                        <CalendarDatePicker
                            Header="Delivery Date (optional)"
                            PlaceholderText="Select date"
                            Date="{Binding DeliveryDate, Mode=TwoWay, Converter={StaticResource DateTimeOffsetConverter}}" />
                    </StackPanel>
                </Border>

                <!--  Technical Details  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Technical Details" />

                        <TextBox
                            Header="Series"
                            PlaceholderText="e.g., BR 64, ICE 3"
                            Text="{Binding Series, Mode=TwoWay}" />

                        <CheckBox
                            Content="Pushing locomotive (Wendezug)"
                            IsChecked="{Binding IsPushing, Mode=TwoWay}" />
                    </StackPanel>
                </Border>

                <!--  Photo Path (Read-Only for now)  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8"
                    Visibility="{Binding HasPhoto, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Photo" />
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Text="{Binding PhotoPath, Mode=OneWay}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Wagon Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="WagonTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Wagon Properties" />

                <!--  Basic Information  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Basic Information" />

                        <TextBox
                            Header="Name"
                            PlaceholderText="Enter wagon name"
                            Text="{Binding Name, Mode=TwoWay}" />

                        <NumberBox
                            Header="Digital Address (optional)"
                            Maximum="10239"
                            Minimum="1"
                            PlaceholderText="DCC address (if wagon has decoder)"
                            SpinButtonPlacementMode="Inline"
                            Value="{Binding DigitalAddress, Mode=TwoWay, Converter={StaticResource NullableUIntConverter}}" />
                    </StackPanel>
                </Border>

                <!--  Purchase Information  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Purchase Information" />

                        <TextBox
                            Header="Manufacturer"
                            PlaceholderText="e.g., Piko, Roco, Fleischmann"
                            Text="{Binding Manufacturer, Mode=TwoWay}" />

                        <TextBox
                            Header="Article Number"
                            PlaceholderText="Product SKU/article code"
                            Text="{Binding ArticleNumber, Mode=TwoWay}" />

                        <CalendarDatePicker
                            Header="Invoice Date (optional)"
                            PlaceholderText="Select date"
                            Date="{Binding InvoiceDate, Mode=TwoWay, Converter={StaticResource DateTimeOffsetConverter}}" />

                        <CalendarDatePicker
                            Header="Delivery Date (optional)"
                            PlaceholderText="Select date"
                            Date="{Binding DeliveryDate, Mode=TwoWay, Converter={StaticResource DateTimeOffsetConverter}}" />
                    </StackPanel>
                </Border>

                <!--  Technical Details  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Technical Details" />

                        <TextBox
                            Header="Series"
                            PlaceholderText="e.g., Eurofima, Avmz"
                            Text="{Binding Series, Mode=TwoWay}" />
                    </StackPanel>
                </Border>

                <!--  Photo Path (Read-Only for now)  -->
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    CornerRadius="8"
                    Visibility="{Binding HasPhoto, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Spacing="8">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="Photo" />
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Text="{Binding PhotoPath, Mode=OneWay}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  EntityTemplateSelector (MUST BE LAST)  -->
    <!--  ============================================  -->
    <selector:EntityTemplateSelector
        x:Key="EntityTemplateSelector"
        ActionTemplate="{StaticResource ActionTemplate}"
        AnnouncementActionTemplate="{StaticResource AnnouncementActionTemplate}"
        AudioActionTemplate="{StaticResource AudioActionTemplate}"
        CommandActionTemplate="{StaticResource CommandActionTemplate}"
        DefaultTemplate="{StaticResource DefaultTemplate}"
        JourneyTemplate="{StaticResource JourneyTemplate}"
        LocomotiveTemplate="{StaticResource LocomotiveTemplate}"
        ProjectTemplate="{StaticResource ProjectTemplate}"
        StationTemplate="{StaticResource StationTemplate}"
        TrainTemplate="{StaticResource TrainTemplate}"
        WagonTemplate="{StaticResource WagonTemplate}"
        WorkflowTemplate="{StaticResource WorkflowTemplate}" />
</ResourceDictionary>