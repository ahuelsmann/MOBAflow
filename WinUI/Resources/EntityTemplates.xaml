<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behavior="using:Moba.WinUI.Behavior"
    xmlns:domain="using:Moba.Domain"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:selector="using:Moba.WinUI.Selector"
    xmlns:vm="using:Moba.SharedUI.ViewModel">

    <!--  EntityTemplateSelector  -->
    <selector:EntityTemplateSelector
        x:Key="EntityTemplateSelector"
        DefaultTemplate="{StaticResource DefaultTemplate}"
        JourneyTemplate="{StaticResource JourneyTemplate}"
        ProjectTemplate="{StaticResource ProjectTemplate}"
        StationTemplate="{StaticResource StationTemplate}"
        TrainTemplate="{StaticResource TrainTemplate}"
        WorkflowTemplate="{StaticResource WorkflowTemplate}" />

    <!--  ============================================  -->
    <!--  Journey Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="JourneyTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <!--  Header  -->
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Journey Properties" />

                <!--  Runtime State Section  -->
                <StackPanel
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="4"
                    Spacing="8">
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{ThemeResource CaptionTextBlockStyle}"
                        Text="RUNTIME STATE" />
                    <Grid ColumnSpacing="16" RowSpacing="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Text="Current Station:" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentStation, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Text="Counter:" />
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentCounter, Mode=OneWay}" />

                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="Current Position:" />
                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                            Text="{Binding CurrentPos, Mode=OneWay}" />
                    </Grid>
                </StackPanel>

                <!--  Name  -->
                <TextBox
                    Header="Name"
                    PlaceholderText="Enter journey name"
                    Text="{Binding Name, Mode=TwoWay}" />

                <!--  Description  -->
                <TextBox
                    Height="80"
                    AcceptsReturn="True"
                    Header="Description"
                    PlaceholderText="Enter description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <!--  InPort  -->
                <NumberBox
                    Header="InPort (Feedback Sensor)"
                    Maximum="255"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding InPort, Mode=TwoWay}" />

                <!--  FirstPos  -->
                <NumberBox
                    Header="First Position"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding FirstPos, Mode=TwoWay}" />

                <!--  Behavior On Last Stop  -->
                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Behavior On Last Stop"
                    ItemsSource="{Binding BehaviorOnLastStopValues}"
                    SelectedItem="{Binding BehaviorOnLastStop, Mode=TwoWay}" />

                <!--  Timer Settings  -->
                <StackPanel Spacing="12">
                    <CheckBox Content="Use Timer To Ignore Feedbacks" IsChecked="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=TwoWay}" />

                    <NumberBox
                        Header="Timer Interval (seconds)"
                        IsEnabled="{Binding IsUsingTimerToIgnoreFeedbacks, Mode=OneWay}"
                        Maximum="60"
                        Minimum="0"
                        SpinButtonPlacementMode="Inline"
                        Value="{Binding IntervalForTimerToIgnoreFeedbacks, Mode=TwoWay}" />
                </StackPanel>

                <!--  Text-to-Speech Template  -->
                <TextBox
                    Height="60"
                    AcceptsReturn="True"
                    Header="Text-to-Speech Template"
                    PlaceholderText="e.g., '{TrainName} is arriving at {StationName}'"
                    Text="{Binding Text, Mode=TwoWay}"
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Station Template (Fluent Design 2)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="StationTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock
                    Margin="0,0,0,8"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Station Properties" />

                <TextBox
                    Header="Name"
                    PlaceholderText="Station name"
                    Text="{Binding Name, Mode=TwoWay}" />

                <TextBox
                    Height="60"
                    AcceptsReturn="True"
                    Header="Description"
                    PlaceholderText="Optional description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <NumberBox
                    Header="InPort (Platform Sensor)"
                    Maximum="255"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding InPort, Mode=TwoWay}" />

                <NumberBox
                    Header="Number Of Laps To Stop"
                    Minimum="1"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding NumberOfLapsToStop, Mode=TwoWay}" />

                <CheckBox Content="Exit On Left Side" IsChecked="{Binding IsExitOnLeft, Mode=TwoWay}" />

                <!--  Workflow Assignment (Drop Target)  -->
                <TextBlock
                    Margin="0,8,0,4"
                    Style="{ThemeResource BaseTextBlockStyle}"
                    Text="Workflow" />
                <Border
                    Padding="12"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="4">
                    <i:Interaction.Behaviors>
                        <behavior:WorkflowDropBehavior Command="{Binding AssignWorkflowCommand}" />
                    </i:Interaction.Behaviors>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <FontIcon
                            Grid.Column="0"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Glyph="&#xE9D5;" />
                        <TextBlock
                            Grid.Column="1"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding WorkflowName, Mode=OneWay}" />
                        <FontIcon
                            Grid.Column="2"
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                            Glyph="&#xE8B0;"
                            ToolTipService.ToolTip="Drag a workflow here" />
                    </Grid>
                </Border>

                <!--  Schedule  -->
                <TextBlock
                    Margin="0,8,0,4"
                    Style="{ThemeResource BaseTextBlockStyle}"
                    Text="Schedule" />

                <!--  Schedule (Arrival/Departure not yet in ViewModel)  -->
                <!--
                <TimePicker Header="Arrival Time" Time="{Binding Arrival, Mode=TwoWay}" />
                <TimePicker Header="Departure Time" Time="{Binding Departure, Mode=TwoWay}" />
                -->

                <NumberBox
                    Header="Track Number"
                    Maximum="99"
                    Minimum="1"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Track, Mode=TwoWay}" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  ============================================  -->
    <!--  Default Template (Fallback)  -->
    <!--  ============================================  -->
    <DataTemplate x:Key="DefaultTemplate">
        <StackPanel
            Padding="16"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
            <TextBlock
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Style="{ThemeResource BodyTextBlockStyle}"
                Text="No editor available"
                TextAlignment="Center" />
            <TextBlock
                Margin="0,4,0,0"
                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                Style="{ThemeResource CaptionTextBlockStyle}"
                Text="Select an entity to edit its properties"
                TextAlignment="Center" />
        </StackPanel>
    </DataTemplate>

    <!--  Placeholder templates for remaining types  -->
    <DataTemplate x:Key="WorkflowTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Workflow Properties" />
                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />
                <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="(More properties coming...)" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="TrainTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Train Properties" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <TextBox
                    MinHeight="80"
                    AcceptsReturn="True"
                    Header="Description"
                    Text="{Binding Description, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Train Type"
                    ItemsSource="{Binding TrainTypeValues}"
                    SelectedItem="{Binding TrainType, Mode=TwoWay}" />

                <ComboBox
                    HorizontalAlignment="Stretch"
                    Header="Service Type"
                    ItemsSource="{Binding ServiceTypeValues}"
                    SelectedItem="{Binding ServiceType, Mode=TwoWay}" />

                <CheckBox Content="Is Double Traction" IsChecked="{Binding IsDoubleTraction, Mode=TwoWay}" />

                <TextBlock
                    Margin="0,16,0,0"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    Text="Composition" />

                <StackPanel Spacing="8">
                    <TextBlock FontWeight="SemiBold" Text="Locomotives" />
                    <ListView
                        MaxHeight="200"
                        ItemsSource="{Binding Locomotives, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock FontWeight="SemiBold" Text="Wagons" />
                    <ListView
                        MaxHeight="200"
                        ItemsSource="{Binding Wagons, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="ProjectTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Project Properties" />
                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  Action Templates (Polymorphic)  -->
    <DataTemplate x:Key="AnnouncementActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Announcement Action" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <NumberBox
                    Header="Number"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Number, Mode=TwoWay}" />

                <TextBox
                    MinHeight="100"
                    AcceptsReturn="True"
                    Header="Message"
                    Text="{Binding Message, Mode=TwoWay}"
                    TextWrapping="Wrap" />

                <TextBox Header="Voice Name" Text="{Binding VoiceName, Mode=TwoWay}" />

                <NumberBox
                    Header="Rate (Speech Speed)"
                    Maximum="10"
                    Minimum="-10"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Rate, Mode=TwoWay}" />

                <Slider
                    Header="Volume"
                    Maximum="1"
                    Minimum="0"
                    StepFrequency="0.1"
                    Value="{Binding Volume, Mode=TwoWay}" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="AudioActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Audio Action" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <NumberBox
                    Header="Number"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Number, Mode=TwoWay}" />

                <TextBox Header="File Path" Text="{Binding FilePath, Mode=TwoWay}" />

                <Slider
                    Header="Volume"
                    Maximum="1"
                    Minimum="0"
                    StepFrequency="0.1"
                    Value="{Binding Volume, Mode=TwoWay}" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="CommandActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Command Action" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <NumberBox
                    Header="Number"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Number, Mode=TwoWay}" />

                <TextBox
                    MinHeight="100"
                    AcceptsReturn="True"
                    Header="Command String"
                    Text="{Binding CommandString, Mode=TwoWay}"
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

    <!--  Generic Action Template (Fallback)  -->
    <DataTemplate x:Key="ActionTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Workflow Action" />

                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />

                <NumberBox
                    Header="Number"
                    Minimum="0"
                    SpinButtonPlacementMode="Inline"
                    Value="{Binding Number, Mode=TwoWay}" />

                <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{Binding Type}" />

                <TextBlock
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="(Select specific action type in Workflow for detailed properties)"
                    TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>

</ResourceDictionary>
