

## üé® DataTemplate Binding Rules (x:Bind vs Binding)

### **Decision Matrix:**

| Context | Binding Type | Performance | Reason |
|---------|--------------|-------------|--------|
| **Page/UserControl** | `{x:Bind}` ‚úÖ | 10x faster | Compiled, Type-Safe |
| **Inline DataTemplate (in Page)** | `{x:Bind}` ‚úÖ | 10x faster | With x:DataType attribute |
| **ResourceDictionary DataTemplate** | `{Binding}` ‚ö†Ô∏è | Slower | No Code-Behind available! |
| **Control Template** | `{TemplateBinding}` ‚úÖ | Fast | Template-Specific |

---

### **Rule 1: Page/UserControl ‚Üí x:Bind**

```xaml
<!-- ‚úÖ CORRECT: Page with x:Bind -->
<Page x:Class="Moba.WinUI.View.EditorPage"
      xmlns:vm="using:Moba.SharedUI.ViewModel"
      DataContext="{x:Bind ViewModel}">
    
    <TextBox Header="Name" Text="{x:Bind ViewModel.Name, Mode=TwoWay}" />
    <CheckBox Content="Active" IsChecked="{x:Bind ViewModel.IsActive, Mode=TwoWay}" />
</Page>
```

**Why x:Bind?**
- ‚úÖ Compile-time type checking (errors during build)
- ‚úÖ 10x faster than `Binding` (no Reflection)
- ‚úÖ `Mode=OneTime` is default (Performance!)
- ‚úÖ IntelliSense support

---

### **Rule 2: Inline DataTemplate ‚Üí x:Bind with x:DataType**

```xaml
<!-- ‚úÖ CORRECT: Inline DataTemplate with x:DataType -->
<ListView ItemsSource="{x:Bind ViewModel.Stations}">
    <ListView.ItemTemplate>
        <DataTemplate x:DataType="vm:StationViewModel">
            <StackPanel>
                <TextBlock Text="{x:Bind Name}" FontWeight="Bold" />
                <TextBlock Text="{x:Bind InPort}" Foreground="Gray" />
            </StackPanel>
        </DataTemplate>
    </ListView.ItemTemplate>
</ListView>
```

**Important:** `x:DataType` is **mandatory** for x:Bind in DataTemplate!

---

### **Rule 3: ResourceDictionary DataTemplate ‚Üí Binding**

```xaml
<!-- ‚ùå WRONG: ResourceDictionary with x:Bind -->
<ResourceDictionary>
    <DataTemplate x:Key="StationTemplate">
        <TextBox Text="{x:Bind Name, Mode=TwoWay}" />  
        <!-- ‚ùå Compiler Error WMC1119: No code-behind! -->
    </DataTemplate>
</ResourceDictionary>

<!-- ‚úÖ CORRECT: ResourceDictionary with Binding -->
<ResourceDictionary>
    <DataTemplate x:Key="StationTemplate">
        <StackPanel Padding="16" Spacing="16">
            <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />
            <NumberBox Header="InPort" Value="{Binding InPort, Mode=TwoWay}" />
        </StackPanel>
    </DataTemplate>
</ResourceDictionary>
```

**Why Binding?**
- ‚ö†Ô∏è ResourceDictionary files have **no Code-Behind**
- ‚ö†Ô∏è `x:Bind` requires Code-Behind at compile-time
- ‚úÖ `Binding` is runtime binding (DataContext-based)

---

### **Compiler Error: WMC1119**

```
WMC1119: This Xaml file must have a code-behind class to use {x:Bind}
```

**Solution:**
1. **Option A:** Use Binding instead of x:Bind
2. **Option B:** Move DataTemplate from ResourceDictionary into Page/UserControl

---

### **Real-World Example: MOBAflow EntityTemplates.xaml**

```xaml
<!-- WinUI/Resources/EntityTemplates.xaml -->
<ResourceDictionary>
    <!-- ‚úÖ CORRECT: Use Binding in ResourceDictionary -->
    <DataTemplate x:Key="JourneyTemplate">
        <ScrollViewer>
            <StackPanel Padding="16" Spacing="16">
                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Journey Properties" />
                <TextBox Header="Name" Text="{Binding Name, Mode=TwoWay}" />
                <NumberBox Header="InPort" Value="{Binding InPort, Mode=TwoWay}" SpinButtonPlacementMode="Inline" />
            </StackPanel>
        </ScrollViewer>
    </DataTemplate>
</ResourceDictionary>
```

**Usage in Page:**

```xaml
<!-- EditorPage.xaml -->
<Page x:Class="Moba.WinUI.View.EditorPage">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/EntityTemplates.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Page.Resources>
    
    <!-- ContentControl applies template based on object type -->
    <ContentControl Content="{x:Bind ViewModel.CurrentSelectedObject, Mode=OneWay}"
                    ContentTemplateSelector="{StaticResource EntityTemplateSelector}" />
</Page>
```

---

### **Performance Comparison:**

| Binding Type | Resolution | Type Safety | Performance |
|--------------|------------|-------------|-------------|
| `{x:Bind}` | Compile-time | ‚úÖ Yes | üöÄ 10x |
| `{Binding}` | Runtime | ‚ùå No | ‚ö†Ô∏è 1x |
| `{TemplateBinding}` | Compile-time | ‚úÖ Yes | üöÄ 10x |

**Recommendation:**
- Use `x:Bind` **always** when possible (Page, UserControl, Inline Templates)
- Use `Binding` **only** in ResourceDictionary DataTemplates

---

**Last Updated:** 2025-12-09  
**Related Error:** WMC1119
