# MOBAflow - Cross-Session Knowledge Bridge

> **Cross-Session Knowledge Bridge** fuer Copilot
> **Erstellt:** 2025-02-04 | **Letztes Update:** 2026-01-14

---

## Letzte Session (2026-01-14)

### Umgesetzt

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Navigation Icons Update Revert** | MOBAtps und MOBAesb Icons auf Original zurueckgesetzt |
| Done | **Todo-Liste aktualisiert** | Feedback zu Feature-Backlog eingearbeitet |
| Done | **Drag&Drop Workflow Actions verifiziert** | Bereits implementiert (CanReorderItems, AllowDrop in WorkflowsPage.xaml) |
| Done | **Play-Button in Audio-Action Editor** | PlayAudioCommand zu AudioViewModel hinzugefuegt, EntityTemplates.xaml mit Play-Button erweitert, ISoundPlayer durch ViewModel-Hierarchie durchgereicht |
| Done | **Keyboard Shortcuts auf MOBAcmd** | CreateKeyboardShortcutsCard() Methode in CmdTransactionContentProvider.cs mit F5, Space, R, Ctrl+N/O/S, Enter, Esc Shortcuts |
| Done | **MOBAerp zu MOBAcmd umbenannt** | Komplette Umbenennung: ErpPlugin -> CmdPlugin, Namespace Moba.Plugin.Erp -> Moba.Plugin.Cmd, "ERP-style" -> "Command-style", alte Dateien geloescht |

### Geaenderte Dateien

- `SharedUI/ViewModel/Action/AudioViewModel.cs` - PlayAudioCommand hinzugefuegt
- `WinUI/Resources/EntityTemplates.xaml` - Play-Button neben Browse-Button
- `SharedUI/ViewModel/WorkflowViewModel.cs` - ISoundPlayer Parameter
- `SharedUI/ViewModel/ProjectViewModel.cs` - ISoundPlayer Parameter
- `SharedUI/ViewModel/SolutionViewModel.cs` - ISoundPlayer Parameter
- `SharedUI/ViewModel/MainWindowViewModel.Solution.cs` - SoundPlayer durchgereicht
- `SharedUI/ViewModel/MainWindowViewModel.Workflow.cs` - SoundPlayer an AudioViewModel uebergeben
- `.github/instructions/.copilot-todos.md` - MOBAerp -> MOBAcmd Branding

### Neue Dateien

- `Plugins/CmdPlugin/CmdPlugin.csproj` - Neues Plugin-Projekt
- `Plugins/CmdPlugin/CmdPlugin.cs` - MOBAcmd System Plugin
- `Plugins/CmdPlugin/CmdPluginViewModel.cs` - Command-basierte ViewModel
- `Plugins/CmdPlugin/TransactionCodeMapper.cs` - Transaction Code Mapping (CMD statt ERP)
- `Plugins/CmdPlugin/CmdTransactionContentProvider.cs` - Command-Style UI mit Keyboard Shortcuts

### Geloeschte Dateien

- `Plugins/ErpPlugin/ErpPlugin.csproj` - Ersetzt durch CmdPlugin
- `Plugins/ErpPlugin/ErpPlugin.cs` - Ersetzt durch CmdPlugin.cs
- `Plugins/ErpPlugin/ErpPluginViewModel.cs` - Ersetzt durch CmdPluginViewModel.cs
- `Plugins/ErpPlugin/TransactionCodeMapper.cs` - Ersetzt durch neue Version
- `Plugins/ErpPlugin/ErpTransactionContentProvider.cs` - Ersetzt durch CmdTransactionContentProvider.cs

---

## Letzte Session (2026-01-13)

### Umgesetzt

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **SignalBoxPage Konsolidierung** | 8 SignalBox-Seiten zu einer konfigurierbaren Seite zusammengefuehrt |
| Done | **Light/Dark Theme** | Theme-Toggle Button im Header, SignalBoxColorScheme.Light/.Dark |
| Done | **Verspielte Header** | Datum, Uhrzeit, ZN/ZU Status-Indikatoren, Signalmodus-Anzeige (GN/WS/RT/GE/BL) |
| Done | **Kein Footer/StatusBar** | ShowStatusBar => false, cleanes Design |
| Done | **Gerade Gleislinien** | ILTIS-Style ohne Abrundungen (PenLineCap.Flat) |
| Done | **Grid-Toggle** | Raster ein-/ausblenden per Button |
| Done | **Signal-Toolbox gruppiert** | H/V-System (Hp/Vr), Ks-System, Sv-System (S-Bahn), Rangiersignale, Zusatz |
| Done | **Signal-Cycling** | Klick auf Signal wechselt Aspekte fuer alle Systeme |
| Done | **Hl-System entfernt** | DDR/DR-Signale nicht benoetigt - aus Toolbox, Enums und Rendering entfernt |
| Done | **SignalBoxPlanViewModel** | ViewModel-Wrapper mit ObservableCollections erstellt |
| Done | **Alte Pages geloescht** | SignalBoxPage2-8.cs, SignalBoxPageBase2.cs (8 Dateien) |
| Done | **Mapping erweitert** | MapToSymbol/MapFromSymbol fuer alle neuen Signaltypen |

### Geaenderte Dateien

- `WinUI/View/SignalBoxPage.cs` - Komplett ueberarbeitet (Themes, Header, Toolbox, Rendering)
- `WinUI/View/SignalBoxPageBase.cs` - Optional StatusBar, IsSignalType(), erweiterte Mappings
- `WinUI/Model/SignalBoxElement.cs` - Neue Signaltypen (H/V, Ks, Sv), Hl entfernt
- `SharedUI/ViewModel/SignalBoxPlanViewModel.cs` - NEU: ViewModel-Wrapper

### Geloeschte Dateien

- `WinUI/View/SignalBoxPage2.cs` bis `SignalBoxPage8.cs` (7 Dateien)
- `WinUI/View/SignalBoxPageBase2.cs` (1 Datei)

---

## Session (2026-01-12)

### Umgesetzt

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Copyright-Header (46 Dateien)** | TrackPlan/*, TrackPlan.Editor/*, TrackPlan.Renderer/*, WinUI/Rendering/*, TrackPlanEditorPage.xaml.cs |
| Done | **GeometryConnectionConstraint DI** | Registriert in TrackPlanServiceExtensions.cs als ITopologyConstraint |
| Done | **SimpleLayoutEngine DI** | Implementiert ILayoutEngine, als Keyed Service "Simple" registriert |
| Done | **UpdateActionNumbers() Refactoring** | Von WorkflowsPage.xaml.cs nach WorkflowViewModel.cs verschoben (MVVM-konform) |
| Done | **TFM-Analyse** | net9.0 fuer Libraries, net10.0 fuer Apps - Architektur ist KORREKT, keine Aenderung noetig |
| Done | **EntityTemplates.xaml Fix** | Click="PhotoImage_Click" durch Command="{Binding OpenPhotoCommand}" ersetzt |
| Done | **OpenPhotoCommand** | Zu LocomotiveViewModel und WagonViewModel hinzugefuegt |
| Done | **DuplicateFeedbackPointNumberConstraint Fix** | Interface-Implementierung `: ITopologyConstraint` wiederhergestellt |
| Done | **Positional Records repariert** | TrackEnd, TrackTemplate, Endpoint, Point2D, ArcPrimitive, LinePrimitive, IGeometryPrimitive |
| Done | **Copilot-Processing.md geloescht** | Redundante Datei entfernt, nur .copilot-todos.md als Single Source of Truth |

### Architektur-Erkenntnisse

**TFM-Strategie (Best Practice - KEINE Aenderung noetig):**
- Libraries (Common, Domain, Backend, SharedUI, TrackPlan, etc.): `net9.0` - Stabilitaet, Kompatibilitaet
- Apps (WinUI, WebApp): `net10.0(-windows)` - Neueste Features
- Plugins (ErpPlugin, StatisticsPlugin): `net10.0-windows` - Muss zum Host passen

**DI-Registrierung TrackPlanServiceExtensions.cs:**
```csharp
// Layout Engines - multiple implementations
services.AddSingleton<ILayoutEngine, CircularLayoutEngine>();  // Default
services.AddKeyedSingleton<ILayoutEngine, CircularLayoutEngine>("Circular");
services.AddKeyedSingleton<ILayoutEngine, SimpleLayoutEngine>("Simple");

// Constraints
services.AddSingleton<ITopologyConstraint, DuplicateFeedbackPointNumberConstraint>();
services.AddSingleton<ITopologyConstraint, GeometryConnectionConstraint>();
```

---

## Session (2026-01-11)

### Umgesetzt

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **TrackLibrary.PikoA Projekt** | Separates Projekt fuer Piko A-Gleis Templates |
| Done | **ITrackCatalog Interface** | Abstraktion fuer Track Libraries in TrackPlan |
| Done | **TrackPlanEditor Fixes** | Rendering-Skalierung, Hit-Test, Panning, Hover |
| Done | **ItemsControl statt ListView** | Toolbox verwendet jetzt ItemsControl (kein Scroll-Konflikt) |
| Done | **MAUI .NET 10 Upgrade** | net10.0-android mit MAUI 10.0.11 |
| Done | **Instructions aktualisiert** | ItemsControl-Richtlinien in winui.instructions.md |

### Architektur-Aenderungen

**Neues Projekt: TrackLibrary.PikoA**
```
TrackLibrary.PikoA/
  - Catalog/PikoATrackCatalog.cs    # ITrackCatalog Implementation
  - Template/StraightTemplates.cs   # G231, G119, etc.
  - Template/CurveTemplates.cs      # R1, R2, R3, R9
  - Template/SwitchTemplates.cs     # BWL, BWR, K30
  - Metadata/PikoAConstants.cs      # Physische Masse
  - Metadata/PikoAArticle.cs        # Artikelnummern
```

**Zukuenftige Track Libraries:**
- TrackLibrary.RocoLine (geplant)
- TrackLibrary.Tillig (geplant)
- TrackLibrary.Maerklin (geplant)

---

## MOBA* Produktfamilie - Branding und Naming

| Produkt | Vollname | Beschreibung | Seite/Projekt |
|---------|----------|--------------|---------------|
| **MOBAflow** | MOBAflow Desktop | Hauptanwendung (WinUI) | `WinUI/` |
| **MOBAsmart** | MOBAsmart Mobile | Mobile App (MAUI) | `MAUI/` |
| **MOBAdash** | MOBAdash Web | Web Dashboard (Blazor) | `WebApp/` |
| **MOBAcmd** | MOBAcmd Command Interface | Command-Palette Navigation | `CmdPlugin` |
| **MOBAixl** | MOBAixl Interlocking | Elektronisches Stellwerk (ESTW) | `SignalBoxPage` |
| **MOBAtps** | MOBAtps Track Planner | Track Planner System | `TrackPlanEditorPage` |

> **MOBA** = **Mo**dell**ba**hn (Model Railroad / Modellbahner)

### Markenschutz

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Markenrecherche-Anleitung** | `docs/TRADEMARK-GUIDE.md` mit DPMA, EUIPO, WIPO Anleitung und Kosten |
| Done | **CLA erstellt** | `CLA.md` - Contributor License Agreement mit Trademark-Schutz |
| Done | **InfoPage mit Trademarks** | `WinUI/View/InfoPage.cs` - About, License, Trademarks, Third-Party |
| Pending | **DPMA Markenrecherche durchfuehren** | Pruefung ob "MOBAflow" etc. verfuegbar |
| Pending | **Wortmarken-Registrierung** | Nach Recherche: DPMA (DE) oder EUIPO (EU) |
| Pending | **README Trademark Notice** | In README.md Trademark-Hinweis einfuegen |

### Projekt-Klassifizierung (MIT Core vs. Commercial)

> **WICHTIG**: Vor Veroeffentlichung muss klar definiert werden, welche Teile der Solution MIT-lizenziert bleiben und welche als kommerzielle Erweiterungen gelten.

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **MIT Core definieren** | Liste der Projekte/Ordner die IMMER MIT-lizenziert bleiben |
| Pending | **Commercial Extensions definieren** | Liste der Premium-Plugins/Features die kommerziell lizenziert werden koennten |
| Pending | **LICENSING.md erstellen** | Dokument das klar die Lizenzstruktur erklaert |
| Pending | **Ordnerstruktur ggf. anpassen** | z.B. `Plugins/Community/` (MIT) vs. `Plugins/Premium/` (Commercial) |

**Vorgeschlagene Klassifizierung:**

| Projekt/Ordner | Lizenz | Begruendung |
|----------------|--------|-------------|
| `Backend/` | MIT Core | Basis-Funktionalitaet, Z21-Kommunikation |
| `Common/` | MIT Core | Shared Utilities |
| `Domain/` | MIT Core | Domain Models |
| `SharedUI/` | MIT Core | Gemeinsame ViewModels |
| `WinUI/` | MIT Core | Desktop-Anwendung |
| `MAUI/` | MIT Core | Mobile App |
| `WebApp/` | MIT Core | Blazor Dashboard |
| `TrackPlan/` | MIT Core | Basis-Gleisplanung |
| `Plugins/SamplePlugin/` | MIT Core | Beispiel-Plugin fuer Community |
| `Plugins/ErpPlugin/` | MIT Core | MOBAerp (Beispiel) |
| `Plugins/Premium/*` | Commercial | Zukuenftige Premium-Plugins |

---

## Architektur-Unterschiede: MOBAtps vs. MOBAixl (09.01.2026)

> **WICHTIG fuer Copilot**: Diese Architekturnotizen dokumentieren die fundamentalen Unterschiede zwischen den beiden Gleisplan-Systemen.

### MOBAtps (TrackPlan) - Topologie-basiert (KORREKT)

**Projekt:** `TrackPlan/`

| Aspekt | Beschreibung |
|--------|--------------|
| **Architektur** | **Reine Topologie** - KEINE Koordinaten im JSON |
| **Datenmodell** | `TrackLayout` mit `Segments` (Knoten) + `Connections` (Ecken) |
| **Segment** | `TrackSegment` mit `ArticleCode` (z.B. "G231", "WL"), keine X/Y Position |
| **Connection** | `TrackConnection` mit Segment1Id, Connector1Index, Segment2Id, Connector2Index |
| **Geometrie** | `TrackGeometry` liefert Endpoints + Headings pro ArticleCode |
| **Rendering** | TopologyRenderer berechnet WorldTransform aus Graphtraversal + Geometrie |
| **Gleissystem** | Piko A-Gleis Geometrie als Basis (Laenge, Winkel, Radien) |

**Domain-Klassen:**
```
TrackPlan/Domain/
Ã¢â€Å“Ã¢â€žâ€â‚¬Ã¢â€â‚¬ TrackLayout.cs      # Topology container (Segments + Connections)
Ã¢â€Å“Ã¢â€žâ€â‚¬Ã¢â€â‚¬ TrackSegment.cs     # ArticleCode, AssignedInPort, SwitchState, WorldTransform (runtime)
Ã¢â€Å“Ã¢â€žâ€â‚¬Ã¢â€â‚¬ TrackConnection.cs  # Segment1Id, Connector1Index, Segment2Id, Connector2Index
Ã¢â€žâ€žÃ¢â€â‚¬Ã¢â€žâ€ž TrackGeometry.cs    # ArticleCode -> Endpoints, Headings, PathData
Ã¢â€žâ€žÃ¢â€â‚¬Ã¢â€žâ€ž Transform2D.cs      # 2D Transformation matrix (runtime calculated)
```

**Wichtig:** WorldTransform wird zur Runtime berechnet, NICHT gespeichert!

### MOBAixl (SignalBox) - Koordinaten-basiert (OK fuer Stellwerk)

**Projekt:** `WinUI/View/SignalBoxPage.cs` + `Domain/SignalBoxPlan.cs`

| Aspekt | Beschreibung |
|--------|--------------|
| **Architektur** | **Zellen-Grid** mit X/Y Koordinaten |
| **Datenmodell** | `SignalBoxPlan` mit `Elements` (Grid-Positionen) + `Connections` (optional) |
| **Element** | `SignalBoxPlanElement` mit X, Y, Rotation, Symbol |
| **Rendering** | Direkt aus Koordinaten: `Canvas.SetLeft(x * CellSize)` |
| **Verwendung** | ESTW-Gleisbild (schematische Darstellung, nicht masstabsgetreu) |

**Unterschied zum echten Gleisplan:**
- Stellwerk-Gleisbild ist **schematisch**, nicht geometrisch korrekt
- Zellen-Grid ist fuer Stellwerk-UI **angemessen**
- Keine Piko-Geometrie noetig

### Zusammenfassung: Zwei verschiedene Anwendungsfaelle

| System | Zweck | Koordinaten | Geometrie |
|--------|-------|-------------|-----------|
| **MOBAtps** | Gleisplan-Editor (physisch) | NEIN (Topologie) | Piko A-Gleis |
| **MOBAixl** | Stellwerk-UI (schematisch) | JA (Grid) | Symbole/Icons |

### Naechste Schritte fuer TrackPlan (MOBAtps)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Domain-Modell** | TrackLayout, TrackSegment, TrackConnection existieren |
| Done | **Piko Geometrie-Bibliothek** | PikoATrackLibrary mit Templates, TrackGeometryLibrary Service |
| Done | **TopologyRenderer** | Graphtraversals -> WorldTransform Berechnung via TopologySolver |
| Done | **SVG/Path-Generator** | PathDataTransformer wendet WorldTransform auf PathData an |
| Done | **Connection-Editor** | Snap-to-Connect beim Drag&Drop (TrySnapToNearestConnector) |
| Done | **Persistierung** | SaveToProject/LoadFromProject mit SolutionSaving/Loaded Events |
| Pending | **AnyRail Import** | Import von .any Dateien in TrackLayout (Basis implementiert) |

### Naechste Schritte fuer MOBAixl (SignalBox)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **8 Style-Varianten erstellt** | SignalBoxPage1-4 (SignalBoxPageBase) + SignalBoxPage5-8 (SignalBoxPageBase2) |
| Done | **Konsolidierung zu einer Seite** | Alle 8 SignalBox-Seiten zu EINER konfigurierbaren Seite zusammengefuehrt. Light/Dark Theme per Toggle-Button. Verspielte Header (Datum/Uhrzeit/Status), kein Footer, gerade Gleislinien (ILTIS-Style), Raster ein-/ausblendbar |
| Done | **Signal-Toolbox nach System** | Signale gruppiert: H/V-System (Hp/Vr), Ks-System, Sv-System (S-Bahn), Rangiersignale. Hl-System entfernt (DDR/DR nicht benoetigt) |
| Done | **Signal-Cycling implementiert** | Klick auf Signal wechselt Aspekte: Rot->Gelb->Gruen. Alle Signalsysteme unterstuetzt |
| Done | **SignalBoxPlanViewModel erstellt** | ViewModel-Wrapper fuer Domain-Model mit ObservableCollections |
| Done | **Konfigurierbare Farbschemata** | `SignalBoxColorScheme.Light` und `.Dark` mit Theme-Toggle |
| Done | **Alte Pages entfernt** | SignalBoxPage2-8.cs und SignalBoxPageBase2.cs geloescht (8 Dateien) |
| Done | **Navigation** | Nur noch ein "MOBAixl" Eintrag (war bereits so konfiguriert) |

---
## KRITISCH - Vor Veroeffentlichung PFLICHT

### 0. Encoding-Bereinigung (DRINGEND!)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Korrupte Zeichen bereinigen** | MainWindow.xaml.cs Zeile 86, TrainControlViewModel.cs Zeilen 643, 816 |
| Done | **no-special-chars.instructions.md** | Instruction-Datei erstellt die Emojis/Sonderzeichen in Code verbietet |
| Done | **Emojis aus Debug.WriteLine entfernen** | MainWindow.xaml.cs: "[OK]" statt Emoji; TrainControlViewModel: "FWD/REV" und "[STOP]" statt korrupte Pfeile |
| Verified | **Deutsche Umlaute in UI-Strings** | Kein Problem - Übersetzung in Resource-Dateien nicht erforderlich fuer dieses Projekt |

**Betroffene Dateien (ALLE ERLEDIGT):**
- `WinUI/View/MainWindow.xaml.cs` (Zeile 86) - ERLEDIGT (2026-01-12)
- `SharedUI/ViewModel/TrainControlViewModel.cs` (Zeilen 643, 816) - ERLEDIGT (2026-01-12)
- SignalBoxPage.cs - VERIFIZIERT (keine korrupten Zeichen gefunden)
- TrackPlanEditorPage.xaml.cs - VERIFIZIERT (keine korrupten Zeichen gefunden)

### 1. Sicherheit und Secrets (HOECHSTE PRIORITAET!)


| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **Azure Speech Key entfernen** | `WinUI\appsettings.json` enthaelt echten API-Key - MUSS entfernt werden! |
| Pending | **appsettings.json Template erstellen** | Erstelle `appsettings.template.json` ohne Secrets, dokumentiere in README |
| Pending | **.gitignore erweitern** | `appsettings.json` und `appsettings.Development.json` auf .gitignore setzen |
| Pending | **Git History bereinigen** | Falls Key bereits committed: `git filter-branch` oder BFG Repo-Cleaner verwenden |
| Pending | **Azure Key rotieren** | Nach Bereinigung neuen Key generieren (alter Key ist kompromittiert) |
| Pending | **docs/SECURITY-SECRETS.md ausfuellen** | Datei existiert aber ist leer - Dokumentation fuer Secret-Management |

### 2. Copyright Header

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **Copyright-Jahr festgelegt** | Standard: "2026" (nicht "2025-2026"). Alle neuen Dateien verwenden nur 2026. |
| Done | **LICENSE-Datei aktualisiert** | Von "Copyright (c) 2025" auf "Copyright (c) 2026" geaendert |
| Done | **TrackPlan/* (18 Dateien)** | Copyright-Header hinzugefuegt (2026-01-12) |
| Done | **TrackPlan.Editor/* (11 Dateien)** | Copyright-Header hinzugefuegt (2026-01-12) |
| Done | **TrackPlan.Renderer/* (14 Dateien)** | Copyright-Header hinzugefuegt (2026-01-12) |
| Done | **WinUI/Rendering/* (2 Dateien)** | Copyright-Header hinzugefuegt (2026-01-12) |
| Done | **TrackPlanEditorPage.xaml.cs** | Copyright-Header hinzugefuegt (2026-01-12) |


### 3. Ressourcen-Pfade (NEU - 07.01.2026)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **Audio-Dateien relativ speichern** | Aktuell: Absolute Pfade (`C:\Repos\...`). Problem: Funktioniert nicht auf anderen Rechnern (z.B. `C:\Repo\...` vs `C:\Repos\...`) |
| Pending | **Sounds-Ordner im Output-Verzeichnis** | Audio-Dateien (.wav) sollten relativ zum App-Verzeichnis liegen: `Sounds\gong.wav` statt absolutem Pfad |
| Pending | **Bild-Dateien relativ speichern** | Analog zu Audio: Bilder (Lok-Fotos etc.) sollten relativ im `Photos\` Ordner liegen |
| Pending | **Workflow FilePath Konvertierung** | Beim Speichern: Absolute Pfade zu relativen konvertieren. Beim Laden: Relative zu absoluten aufloesen |
| Pending | **Copy to Output in .csproj** | Sound-Dateien mit `<Content CopyToOutputDirectory="PreserveNewest">` ins bin-Verzeichnis kopieren |

---

## Erledigte Aufgaben (09.01.2026)

### MOBAtps und MOBAixl Persistierung

| Status | Feature | Details |
|--------|---------|---------|
| Done | **TrackPlanEditorViewModel Persistierung** | Subscribe auf SolutionSaving/SolutionLoaded Events. SaveToProject/LoadFromProject Methoden implementiert. |
| Done | **SignalBoxPage Persistierung** | Als Singleton registriert. SolutionSaving/SolutionLoaded Handler. Laedt/speichert SignalBoxPlan korrekt. |
| Done | **Plugin Navigation Fix** | Plugins werden jetzt VOR Help/Info/Settings in der NavigationView eingefuegt. SamplePlugin Build-Artefakt geloescht. |
| Done | **Panning Fix** | TrackPlanEditorPage: Rechtsklick-Panning mit Button-State-Verifikation und Exception-Handling. |
| Done | **Snap-to-Connect Root Fix** | TopologySolver verwendet Target-Segment als Root beim Verbinden (behÃ¤lt Position bei). |
| Done | **Neue Segmente Positionierung** | Neue Gleise werden gestaffelt platziert (Grid-Pattern), nicht mehr alle bei 0,0. |

### MOBA* Produktfamilie und Naming

| Status | Feature | Details |
|--------|---------|---------|
| Done | **MOBAixl Toolbox Icons** | Stylische Fluent Design Symbol-Icons fuer Stellwerk-Toolbox (2x2 Grid, 56x56px Buttons, SVG-Paths fuer Gleise/Weichen/Signale). |
| Done | **MOBAerp Page** | `WinUI/View/ErpPage.cs` - Standalone ERP-style Navigation (nicht mehr nur Plugin). Transaction Grid, History, Keyboard-Navigation. |
| Done | **HelpPage konsolidiert** | HelpPage2 (TreeView) als einzige HelpPage beibehalten. HelpPage1 (WebView2) und HelpPage3 (TabView) entfernt. |
| Done | **Drag & Drop Fix** | SignalBoxPage: Echtes WinUI Drag&Drop mit CanDrag, DragStarting, DragOver, Drop statt Pointer-Events. |

### ErpPlugin und Help-Page Varianten (frueherer Stand)

| Status | Feature | Details |
|--------|---------|---------|
| Done | **ErpPlugin erstellt** | `Plugins/ErpPlugin/` - Plugin-Projekt mit MOBAerp System (zusaetzlich zur Core ErpPage). |
| Done | **SignalBoxPage erweitert** | Buntes ESTW mit Toolbox, Drag&Drop, Mausrad-Rotation, LED-Effekte, Ks/HV-Signale, Weichen, Hover-States. |
| Done | **SapTransactionPage entfernt** | Aus WinUI entfernt, Funktionalitaet jetzt im ErpPlugin. |
| Done | **Navigation aktualisiert** | Help 1/2/3 und Signal Box im Menu. ErpPlugin wird dynamisch geladen. |

### Alte Prototyp-Seiten (vor Umbau)

| Status | Feature | Details |
|--------|---------|---------|
| Replaced | **HelpPage (Wiki)** | Ersetzt durch HelpPage1 (WebView2-Variante). |
| Replaced | **SapTransactionPage** | Ersetzt durch ErpPlugin mit MOBAerp System. |
| Done | **SignalBoxPage (Stellwerk)** | `WinUI/View/SignalBoxPage.cs` - Elektronisches Stellwerk mit Track Diagram (Gleisbild), Message Log, Nothalt-Button. |

---

## Erledigte Aufgaben (07.01.2026)

### TrainControlPage Verbesserungen

| Status | Feature | Details |
|--------|---------|---------|
| Done | **Tachometer-Control** | Moderner Halbkreis-Tacho mit animierter Nadel und Farbverlauf (Gruen-Gelb-Rot). SpeedometerControl UserControl in WinUI/Controls/. |
| Done | **Speed Ramp (Software-Momentum)** | Konfigurierbare sanfte Beschleunigung/Verzoegerung beim Richtungswechsel. Einstellbar: Step Size (1-20), Interval (50-500ms). |
| Done | **4-Spalten Layout** | Links: Locomotive Settings (260px), Mitte: Tachometer, Functions F0-F20 (100px), Rechts: Speed Categories (200px) |
| Done | **Functions F0-F20 Panel** | Neue Spalte mit vertikalen Funktionsbuttons, scrollbar |
| Done | **Fluent Design Akzentfarben** | F0-F8 mit individuellen Farben: F0 Gelb (Licht), F1 Blau (Sound), F2 Orange (Horn), etc. |
| Done | **Benutzerdefinierte Vektor-Icons** | F3: Tueren schliessen (rot, SVG-Path), F4: Tuerfreigabe (gruen, SVG-Path) |
| Done | **CommandParameter Fix** | SetSpeedPresetCommand akzeptiert jetzt object? statt int (XAML uebergibt immer string) |
| Done | **SpeedometerControl Null-Checks** | Loaded-Event statt Konstruktor fuer UI-Initialisierung |
| Done | **ScrollViewer Padding** | Scrollbar ueberlagert Content nicht mehr (Padding-Fix) |

### Encoding und Dateien

| Status | Feature | Details |
|--------|---------|---------|
| Done | **.copilot-todos.md neu erstellt** | Komplett neu geschrieben ohne Encoding-Probleme (keine Emojis, ASCII-Umlaute) |
| Done | **maui.instructions.md neu erstellt** | Encoding-Probleme behoben |
| Done | **Instruction-Dateien konsolidiert** | 6 redundante Dateien geloescht |
| Done | **no-terminal.instructions.md** | Temporaere Einschraenkung fuer Terminal-Nutzung dokumentiert |

---

## Erledigte Aufgaben (06.02.2025)

### MAUI Auto-Discovery fuer REST API

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **UdpDiscoveryResponder fuer WinUI** | `WinUI\Service\UdpDiscoveryResponder.cs` - UDP Multicast Responder |
| Done | **Integration in REST API Startup** | Startet automatisch wenn REST API aktiviert ist |
| Done | **MAUI Discovery Service erweitert** | UDP Multicast Discovery mit Fallback auf manuelle IP |
| Done | **Automatische Server-Erkennung** | MAUI findet WinUI automatisch im lokalen Netzwerk |

### Plugin System - XAML Entfernung

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **SamplePlugin XAML entfernt** | XAML-Datei geloescht, komplett C#-basierte UI implementiert |
| Done | **C#-basierte UI erstellt** | Programmatische UI-Konstruktion mit WinUI 3 Controls |
| Done | **Dashboard-UI verbessert** | Z21 + REST API Status Cards, Project Statistics |

### REST API Port Check

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **PortChecker Utility erstellt** | `WinUI\Utilities\PortChecker.cs` fuer Port-Verfuegbarkeitspruefung |
| Done | **User-Friendly Error Dialog** | Zeigt hilfreiche Fehlermeldung bei Port-Konflikt |
| Done | **FirewallHelper entfernt** | Keine Windows Firewall Dialoge mehr beim Start |

---

## Erledigte Aufgaben (05.02.2025)

### Plugin System Verbesserungen

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **MinimalPlugin zu SamplePlugin umbenennen** | Verzeichnis, Projekt und Klasse umbenannt |
| Done | **PluginLoadContext erstellen** | Microsoft Best Practice: Custom AssemblyLoadContext fuer Plugin-Isolation |
| Done | **PluginDiscoveryService aktualisieren** | Verwendet nun PluginLoadContext statt Assembly.LoadFrom() |

### Datei-Codierungen und Zeilenenden

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **.gitattributes erstellen** | Konsistente CRLF-Zeilenenden im Repository |
| Done | **Gemischte Zeilenenden korrigiert** | IPlugin.cs, PluginBase.cs, AppSettings.cs, PluginRegistry.cs |

---

## Standard GitHub-Veroeffentlichung Checkliste

### 3. Dokumentation

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | README.md vorhanden | Gut strukturiert mit Badges, Features, Getting Started |
| Done | LICENSE vorhanden | MIT License |
| Done | THIRD-PARTY-NOTICES.md | Vorhanden |
| Done | docs/ARCHITECTURE.md | Vorhanden |
| Done | CONTRIBUTING.md erstellen | Erledigt (04.02.2025) |
| Done | Azure Speech Wiki | `docs/wiki/AZURE-SPEECH-SETUP.md` erstellt |
| Pending | **CODE_OF_CONDUCT.md erstellen** | Fuer Open-Source-Projekte empfohlen |
| Pending | **SECURITY.md erstellen** | GitHub Security Policy |
| Pending | **CHANGELOG.md erstellen** | Versionshistorie dokumentieren |

### 4. Repository-Konfiguration

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | .gitignore vorhanden | Gut konfiguriert |
| Done | .gitattributes erstellen | CRLF-Normalisierung fuer alle Textdateien |
| Pending | **GitHub Issue Templates** | `.github/ISSUE_TEMPLATE/` erstellen |
| Pending | **Pull Request Template** | `.github/PULL_REQUEST_TEMPLATE.md` erstellen |
| Pending | **GitHub Actions Workflow** | CI/CD fuer Build/Test erstellen |
| Pending | **Dependabot konfigurieren** | `.github/dependabot.yml` fuer NuGet-Updates |
| Pending | **Repository Topics** | Tags setzen: model-railroad, z21, winui, maui, blazor, dotnet |

### 5. Code-Bereinigung

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | Architektur MVVM-konform | Gut strukturiert mit SharedUI/Backend/Domain-Trennung |
| Done | DI-Pattern konsistent | `AddMobaBackendServices()` Extension fuer alle Plattformen |
| Done | NullObject-Pattern | Fuer optionale Services (NullCityService, NullSettingsService, etc.) |
| Done | **AppSettings.cs Architektur KORREKT** | Ist KEINE Duplizierung! Ist die C# POCO-Klasse zur Deserialisierung von appsettings.json via IOptions<AppSettings> (Best Practice .NET) |
| Done | **Unused Usings bereinigt** | IDE-Analyse durchgefuehrt - alle benoetigten Usings vorhanden |

### 6. Tests

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | Test-Projekt vorhanden | `Test\Test.csproj` mit NUnit |
| Pending | **Test-Coverage pruefen** | Kritische Pfade (Z21, JourneyManager, WorkflowService) abgedeckt? |
| Pending | **CI-Integration** | Tests in GitHub Actions integrieren |

---

## Feature-Ideen (Backlog)

### MOBAflow (WinUI)

| Status | Feature | Details |
|--------|---------|---------|
| Done | **Help-Page mit integriertem Wiki** | Bereits erledigt - HelpPage2 mit TreeView Navigation vorhanden |
| Done | **History/Log View** | Bereits erledigt - MonitorPage in WinUI App vorhanden |
| Done | **Drag and Drop Workflow Actions** | Bereits implementiert - CanReorderItems="True", AllowDrop="True" |
| Done | **Keyboard Shortcuts auf MOBAerp** | Keyboard-Shortcuts-Uebersicht auf MOBAerp-Page (2026-01-14) |
| Done | **Play-Button in Audio-Action Editor** | Sound-Vorschau im Workflow-Editor implementiert (2026-01-14) |
| Pending | **Export Statistics** | Lap Counter Daten als CSV/Excel exportieren |
| Pending | **Fuehrerstand-Page (Cab Simulator)** | Realistische Lokfuehrer-Perspektive inspiriert von ICE/Vectron/Taurus Fuehrerpulten. Elemente: ETCS/PZB-Anzeige, Fahrschalter (Hebel), Bremscontroller, Sifa (Totmannknopf), Signalwiederholung, Tuersteuerung. Aehnlich wie Train Simulator oder ZUSI-Displays. |
| Pending | **Funktionstasten-Konfiguration (F0-F28)** | Groesseres Feature: Symbol-Toolbox (wie Cities Library) mit Eisenbahn-Icons. Drag and Drop von Symbolen auf F0-F20 Buttons zur visuellen Konfiguration. Persistierung pro Lok/Wagen in Project (Locomotives, PassengerWagons, GoodsWagons). Konfiguration erfolgt auf TrainsPage. Hinweis: Auch Personen- und Gueterwagen koennen Funktionsdecoder besitzen! |
| Done | **TrainControlPage 4-Spalten Layout** | Links: Locomotive Settings, Mitte: Tachometer, Functions F0-F20 (mit Akzentfarben und Icons), Rechts: Speed Categories (07.01.2026) |
| Done | **Benutzerdefinierte Vektor-Icons** | F3: Tueren schliessen (rot), F4: Tuerfreigabe (gruen) - SVG-basierte Path-Grafiken (07.01.2026) |

### MOBAsmart (MAUI)

| Status | Feature | Details |
|--------|---------|---------|
| Done | **Light/Dark Theme** | Dynamisch wechselbar, persistiert in Settings |
| Done | **Logo im Header** | Train-Icon zwischen Titel und Theme-Switch |
| Done | **Haptic Feedback** | Bei Theme/Connection/Track Power Toggle |
| Done | **Pulsing Connection LED** | Animiert wenn verbunden |
| Pending | **Landscape Mode** | Optimiertes 2-Spalten Layout fuer Querformat |
| Pending | **Widget fuer Homescreen** | Android Widget mit Lap Counter Status |
| Pending | **Notification bei Zielrunden** | Push-Notification wenn Target Laps erreicht |
| Pending | **Vibration bei Feedback** | Haptic Feedback wenn Zug Feedback-Point passiert |
| Pending | **QR-Code Scanner** | Z21/REST IP per QR-Code einlesen |

### MOBAdash (Blazor)

| Status | Feature | Details |
|--------|---------|---------|
| Priority | **Real-time Charts** | Live-Diagramme fuer Lap Times, Feedback-Frequenz - GROESSERES FEATURE, separate Implementierung |
| Priority | **Dark Mode** | Theme-Switch wie in MAUI - GROESSERES FEATURE, separate Implementierung |
| Pending | **Multi-User Session** | Mehrere Benutzer sehen gleiche Live-Daten (SignalR) |
| Pending | **PWA Installation** | "Add to Home Screen" Prompt |
| Pending | **Fullscreen Dashboard** | Kiosk-Modus fuer Always-On Display |
| Pending | **Audio Notifications** | Browser-Sound bei Events |

### MOBAtps (Track Planning)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **AnyRail Import** | Import von .any Dateien in TrackLayout (Basis implementiert) |

---

## Fortschritt

- **Kritisch (Sicherheit):** 0/6 Pending (Azure Key muss noch entfernt werden!)
- **Copyright-Header:** 10/10 Done (inkl. neue Plugin-Dateien)
- **Plugin-System:** Done (PluginLoadContext, SamplePlugin, Best Practices)
- **Dokumentation:** 7/9 (78%)
- **Repository-Konfiguration:** 2/7 (29%)
- **Code-Bereinigung:** 3/5 (60%)
- **Tests:** 1/3 (33%)

**Gesamtfortschritt:** ca. 55% abgeschlossen

---

## Naechste Schritte (Priorisierte Reihenfolge)

### Kritisch (vor Veroeffentlichung)
1. Azure Speech Key aus appsettings.json entfernen
2. appsettings.template.json erstellen
3. .gitignore fuer Secrets erweitern
4. Git History bereinigen (falls Key bereits committed)
5. Azure Key rotieren
6. Ressourcen-Pfade relativ machen (Audio/Bilder)

### Features (Naechste Quick Wins)
1. **Export Statistics** - Lap Counter Daten als CSV/Excel
2. **Dark Mode fuer Blazor** - Groesseres Feature, separate Session
3. **Real-time Charts fuer Blazor** - Groesseres Feature, separate Session

### Dokumentation
1. SECURITY.md erstellen
2. CHANGELOG.md erstellen
3. GitHub Actions CI/CD Workflow erstellen

---

## Fuer Copilot: Session-Start Checkliste

Beim Start jeder neuen Session:
1. Diese Datei lesen (`.github/instructions/.copilot-todos.md`)
2. Pruefen welche Aufgaben noch Pending offen sind
3. Keine bereits Done erledigten Empfehlungen wiederholen
4. Bei Umsetzung: Status von Pending auf Done aendern mit Datum

---

*Zuletzt aktualisiert: 2026-01-14 durch Copilot-Session*
