---
description: 'Dynamic cross-session knowledge bridge tracking TODOs, decisions, and instruction file status for MOBAflow'
applyTo: '**'
---

# MOBAflow - Cross-Session Knowledge Bridge

> **Cross-Session Knowledge Bridge** fuer Copilot
> **Erstellt:** 2025-02-04 | **Letztes Update:** 2026-01-15

---

## App Shell Architektur (2026-01-15)

> **Ziel:** Zentrales App-Shell-Pattern mit DI-basierter Navigation
> **Status:** ‚úÖ FUNKTIONSFAEHIG - App startet erfolgreich

### App Shell Interfaces (SharedUI/Shell/)

**Neue Interfaces implementiert:**

| Interface | Zweck | Status |
|-----------|-------|--------|
| `INavigationService` | Zentrale Navigation mit History | ‚úÖ Implementiert |
| `IPageFactory` | DI-basierte Page-Erstellung | ‚úÖ Implementiert |
| `ILifecycleHost` | App-weite Lifecycle-Events | ‚úÖ Implementiert |
| `IShellService` | Shell-Regions (Main, Overlay, Sidebar, Footer) | ‚úÖ Implementiert |
| `ShellRegion` (enum) | Regionen-Definition | ‚úÖ Implementiert |
| `PageDescriptor` (record) | Page-Metadaten | ‚úÖ Implementiert |

**WinUI Implementierungen (WinUI/Service/):**

| Service | Beschreibung | Status |
|---------|--------------|--------|
| `NavigationService` | Erweitert um INavigationService, Navigation History | ‚úÖ Erweitert |
| `PageFactory` | DI-basierte Page-Erstellung | ‚úÖ Neu |
| `LifecycleHost` | WinUI Lifecycle-Integration | ‚úÖ Neu |
| `ShellService` | Shell-Region-Management | ‚úÖ Neu |

---

## Responsive Layout - Entscheidung (2026-01-15)

### AdaptivePanel (ENTFERNT)

Das Custom Control `AdaptivePanel` wurde nach ausfuehrlichen Tests **entfernt**, da WinUI 3 zu viele Inkompatibilitaeten mit Custom Controls hat:

| Problem | Ursache |
|---------|---------|
| XAML-Parser Exception | ContentProperty mit ObservableCollection funktioniert nicht |
| DependencyObject nicht erlaubt | Items muessen von FrameworkElement erben |
| Implizite Styles crashen | Custom Controls in ResourceDictionary nicht unterstuetzt |
| GridLength TypeConverter fehlt | Manuelles Parsing erforderlich |

### Empfohlene Alternative: VisualStateManager

Fuer responsive Multi-Column-Layouts wird **VisualStateManager mit AdaptiveTrigger** empfohlen:

```xaml
<Grid>
    <VisualStateManager.VisualStateGroups>
        <VisualStateGroup>
            <VisualState x:Name="WideState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="1024" />
                </VisualState.StateTriggers>
            </VisualState>
            <VisualState x:Name="CompactState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="0" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                    <Setter Target="Panel2.Visibility" Value="Collapsed" />
                </VisualState.Setters>
            </VisualState>
        </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
</Grid>
```

### Noch verfuegbar: ResponsiveLayoutBehavior

`WinUI/Behavior/ResponsiveLayoutBehavior.cs` ist noch vorhanden und kann fuer VisualStateManager-Integration genutzt werden.

### Naechste Schritte (Optional/Backlog)

- [ ] Unit-Tests fuer GetGridLength() Parser
- [ ] VisualStateManager-basiertes Design fuer TrainControlPage
- [ ] Flyout-basierte Toolbox fuer TrackPlanEditorPage in Compact-Mode

---

## üé® NEUE INITIATIVE: WinUI 3 Best Practices Implementation (2026-01-15)

> **Ziel:** Systematische Umsetzung aller WinUI 3 Best Practices mit Fokus auf Responsive Layouts (VisualStateManager)
> **Status:** AKTIV - Step 1 abgeschlossen, Step 2 vertieft
> **Priorit√§t:** Stufe 1 (nach Security-Cleanup, vor ReSharper 0-Warnings)

### Hintergrund: Warum VisualStateManager?

WinUI 3 Apps m√ºssen **responsive** sein - nicht hart-kodierte Layouts f√ºr feste Fenstergr√∂√üen. **VisualStateManager (VSM)** mit **AdaptiveTrigger** ist die Microsoft Best Practice f√ºr:

- ‚úÖ Automatische Umschaltung zwischen Layouts basierend auf Fensterbreite
- ‚úÖ Tablet/Touch-Unterst√ºtzung (Portrait ‚Üî Landscape)
- ‚úÖ Professionelle Smooth Transitions (keine jarring Layout-Shifts)
- ‚úÖ Kein Code-Behind erforderlich (deklarativ, wartbar)
- ‚úÖ Future-proof f√ºr beliebig kleine/gro√üe Fenster

**MOBAflow Breakpoints definiert:**
- **Compact:** 0-640px (Mobile/kleine Fenster)
- **Medium:** 641-1199px (Tablet/Tablet Landscape)
- **Wide:** 1200px+ (Desktop/gro√üer Monitor)

**Siehe auch:** Umfassende Dokumentation in `.github/instructions/winui.instructions.md` (neue Sektion "Responsive Layout with VisualStateManager")

### Step 1: VSM-Dokumentation (‚úÖ FERTIG - 2026-01-15)

**Umgesetzt:**
- ‚úÖ Erweiterte `winui.instructions.md` mit umfassender VSM-Erkl√§rung (Conceptual Guide + Code Examples)
- ‚úÖ MOBAflow-spezifische Breakpoints dokumentiert
- ‚úÖ Komplettes TrainControlPage-Beispiel mit 3 States (Wide/Medium/Compact)
- ‚úÖ H√§ufige VSM-Patterns (Hide/Show, Column Width, Stacking)
- ‚úÖ Window-Resize Testing Guide
- ‚úÖ Architecture Decision Log (warum VSM, nicht Custom Controls)

**Ergebnis:** Entwickler verstehen jetzt VSM-Konzept vollst√§ndig und k√∂nnen es sofort anwenden.

### Step 2: XAML-Audit aller Haupt-Pages (‚úÖ FERTIG - 2026-01-15)

**Audit-Ergebnisse:**

| Page | Layout | Status | Breakpoints | Priorit√§t |
|------|--------|--------|------------|-----------|
| **TrainControlPage.xaml** | Grid (3 Spalten, hart-kodiert) | ‚ö†Ô∏è Braucht VSM | Wide: 4 Spalten \| Medium: 2 Spalten \| Compact: Stack | üî¥ HOCH |
| **TrackPlanEditorPage.xaml** | Grid (3 Spalten: Toolbox \| Canvas \| Palette) | ‚ö†Ô∏è Braucht VSM | Wide: 3 Spalten \| Medium: Canvas Full + Toolbox unten \| Compact: Toolbox Modal | üî¥ HOCH |
| **SignalBoxPage.cs** | Programmatisch (Code-Behind XAML) | ‚ö†Ô∏è Braucht XAML + VSM | Wide: Grid \| Medium: Compact | üü† MITTEL |
| **MainWindow.xaml** | NavigationView (Shell) | ‚è≥ Noch zu pr√ºfen | Wide: Rail sichtbar \| Compact: Hamburger | üü† MITTEL |
| **WorkflowsPage.xaml** | ListBox + Editor | ‚è≥ Noch zu pr√ºfen | Wide: Split \| Compact: Modal | üü† MITTEL |
| **MonitorPage.xaml** | Horizontal Logs | ‚úÖ Wahrscheinlich OK | - | üü¢ NIEDRIG |

**Erkenntnisse:**
- ‚ùå Keine Page hat aktuell VSM implementiert
- ‚ùå Alle kritischen Pages sind Hart-kodiert (feste Auto/*/Pixel-Werte)
- ‚úÖ Gute Grundstruktur (Grid-basiert, proper spacing, CardBackground, Fluent Design)
- ‚ö†Ô∏è SignalBoxPage ist vollst√§ndig Code-Behind generiert (sollte zu XAML migriert werden f√ºr Wartbarkeit)

### Step 3: VSM-Implementierung in Haupt-Pages (N√ÑCHSTE AUFGABE)

**Reihenfolge (Priorit√§t):**

1. **TrainControlPage.xaml** (H√ñCHSTE PRIORIT√ÑT)
   - Aufgabe: Grid von 3 festen Spalten ‚Üí VSM mit Wide/Medium/Compact States
   - Breakpoints:
     - **Wide (1200px+):** [Settings (260px) | Tachometer (*) | Functions (100px) | Speed (200px)]
     - **Medium (641px+):** [Settings (250px) | Tachometer (*)] mit Functions/Speed als Tabs oder Collapsible unten
     - **Compact (0-640px):** Vollst√§ndig gestackt vertikal mit Expandern statt Spalten
   - Tests: Resize von 1920px ‚Üí 1200px ‚Üí 640px ‚Üí 320px
   - Gesch√§tzter Aufwand: 1-2 Stunden
   - Nutzen: Tablet-Supportierung, kleiner Monitor Support

2. **TrackPlanEditorPage.xaml** (HOHE PRIORIT√ÑT)
   - Aufgabe: 3-Spalten Layout (Toolbox | Canvas | Properties) ‚Üí VSM
   - Breakpoints:
     - **Wide:** [Toolbox (180px) | Canvas (*) | Properties (240px)]
     - **Medium:** [Canvas full-width] mit Properties darunter oder als Flyout
     - **Compact:** Canvas full-screen, Toolbox/Properties als Modal/Flyout
   - Tests: Touch-Simulation, Rotation (Landscape ‚Üî Portrait)
   - Gesch√§tzter Aufwand: 1-2 Stunden
   - Nutzen: Track Planning auf Tablet, bessere Touchscreen-Unterst√ºtzung

3. **SignalBoxPage** (MITTLERE PRIORIT√ÑT)
   - Aufgabe: Von Code-Behind-XAML-Generierung zu echtem XAML + VSM migrieren
   - Warum: Wartbarkeit, Performance, Designability, VSM-Integration
   - Breakpoints:
     - **Wide:** Signal-Grid + Console Log side-by-side
     - **Compact:** Signal-Grid full-width, Console unten
   - Tests: Toolbox Visibility Toggle, Grid Resize
   - Gesch√§tzter Aufwand: 2-3 Stunden (gr√∂√üerer Refactoring, aber notwendig)
   - Nutzen: Bessere Wartbarkeit, XAML Designer support, Theme consistency

4. **MainWindow.xaml** (MITTLERE PRIORIT√ÑT)
   - Aufgabe: NavigationView Pane anpassen f√ºr Compact Mode
   - Breakpoints:
     - **Wide:** Rail sichtbar (links)
     - **Compact:** Hamburger Menu (Pane verborgen, Toggle-Button oben)
   - Tests: Window Resize, Fokus auf Accessibility
   - Gesch√§tzter Aufwand: 1-2 Stunden
   - Nutzen: Vollst√§ndig responsive App-Shell

5. **WorkflowsPage.xaml** (NIEDRIGERE PRIORIT√ÑT)
   - Aufgabe: Split-View (ListBox + Editor) ‚Üí VSM
   - Tests: Editor als Modal bei Compact
   - Gesch√§tzter Aufwand: 1 Stunde

### Step 4-12: Weitere WinUI Best Practices (PENDING)

Nach VSM-Implementierung sollten diese weitere Best Practices umgesetzt werden:

| Step | Aufgabe | Aufwand | Notes |
|------|---------|--------|-------|
| 4 | Refactor Navigation Pattern nach Shell-Standard | 2-3h | INavigationService, IPageFactory bereits vorhanden |
| 5 | UI Thread Dispatching Audit (Z21, Journey, TrainControl Events) | 2-3h | Code-Review f√ºr Background‚ÜíUI Updates |
| 6 | Fluent Design System konsistent | 3-4h | Theme Tokens, Akzentfarben, Transitions |
| 7 | DI-Registration √ºberpr√ºfen (App.xaml.cs) | 1-2h | Service Lifetimes (Singleton vs Transient) |
| 8 | ItemsControl Pattern dokumentieren | 1h | Wann ListView, wann ItemsControl, Virtualization |
| 9 | File I/O Pattern √ºberpr√ºfen | 1h | FilePicker mit Window Handle, Async/Await |
| 10 | Keyboard Shortcuts konsistent | 2h | Ctrl+S, Ctrl+O, F5, Escape √ºberpr√ºfen |
| 11 | Window Management Audit | 1h | Sizing, Centering, Startup State |
| 12 | Finale winui.instructions.md Erweiterung | 1h | Architecture Decision Log, Checklisten |

---

### ‚úÖ N√§chste Aktion: Step 3 VSM-Implementierung starten

**Reihenfolge f√ºr Implementation:**
1. TrainControlPage.xaml (Kritisch, gutes Lern-Beispiel)
2. TrackPlanEditorPage.xaml (Kritisch f√ºr Touch-Szenarien)
3. SignalBoxPage (Gr√∂√üeres Refactoring, aber notwendig)
4. MainWindow.xaml (Komplettiert Shell)
5. WorkflowsPage.xaml + MonitorPage.xaml (Optional Refinement)

**Gesch√§tzte Gesamtzeit:** ~5-8 Stunden f√ºr kritische 3 Pages + Shell

---
