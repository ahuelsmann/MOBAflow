# MOBAflow - Cross-Session Knowledge Bridge

> **Cross-Session Knowledge Bridge** fuer Copilot
> **Erstellt:** 2025-02-04 | **Letztes Update:** 2026-01-07

---

## KRITISCH - Vor Veroeffentlichung PFLICHT

### 1. Sicherheit und Secrets (HOECHSTE PRIORITAET!)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **Azure Speech Key entfernen** | `WinUI\appsettings.json` enthaelt echten API-Key - MUSS entfernt werden! |
| Pending | **appsettings.json Template erstellen** | Erstelle `appsettings.template.json` ohne Secrets, dokumentiere in README |
| Pending | **.gitignore erweitern** | `appsettings.json` und `appsettings.Development.json` auf .gitignore setzen |
| Pending | **Git History bereinigen** | Falls Key bereits committed: `git filter-branch` oder BFG Repo-Cleaner verwenden |
| Pending | **Azure Key rotieren** | Nach Bereinigung neuen Key generieren (alter Key ist kompromittiert) |
| Pending | **docs/SECURITY-SECRETS.md ausfuellen** | Datei existiert aber ist leer - Dokumentation fuer Secret-Management |

### 2. Copyright Header

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **Copyright-Jahr klaeren** | User wuenscht "2026", aktuell ist "2025-2026" - Entscheidung treffen |
| Pending | **LICENSE-Datei aktualisieren** | Aktuell: "Copyright (c) 2025" - muss synchron zum Header sein |

### 3. Ressourcen-Pfade (NEU - 07.01.2026)

| Status | Aufgabe | Details |
|--------|---------|---------|
| Pending | **Audio-Dateien relativ speichern** | Aktuell: Absolute Pfade (`C:\Repos\...`). Problem: Funktioniert nicht auf anderen Rechnern (z.B. `C:\Repo\...` vs `C:\Repos\...`) |
| Pending | **Sounds-Ordner im Output-Verzeichnis** | Audio-Dateien (.wav) sollten relativ zum App-Verzeichnis liegen: `Sounds\gong.wav` statt absolutem Pfad |
| Pending | **Bild-Dateien relativ speichern** | Analog zu Audio: Bilder (Lok-Fotos etc.) sollten relativ im `Photos\` Ordner liegen |
| Pending | **Workflow FilePath Konvertierung** | Beim Speichern: Absolute Pfade zu relativen konvertieren. Beim Laden: Relative zu absoluten aufloesen |
| Pending | **Copy to Output in .csproj** | Sound-Dateien mit `<Content CopyToOutputDirectory="PreserveNewest">` ins bin-Verzeichnis kopieren |

---

## Erledigte Aufgaben (07.01.2026)

### TrainControlPage Verbesserungen

| Status | Feature | Details |
|--------|---------|---------|
| Done | **Tachometer-Control** | Moderner Halbkreis-Tacho mit animierter Nadel und Farbverlauf (Gruen-Gelb-Rot). SpeedometerControl UserControl in WinUI/Controls/. |
| Done | **Speed Ramp (Software-Momentum)** | Konfigurierbare sanfte Beschleunigung/Verzoegerung beim Richtungswechsel. Einstellbar: Step Size (1-20), Interval (50-500ms). |
| Done | **4-Spalten Layout** | Links: Locomotive Settings (260px), Mitte: Tachometer, Functions F0-F20 (100px), Rechts: Speed Categories (200px) |
| Done | **Functions F0-F20 Panel** | Neue Spalte mit vertikalen Funktionsbuttons, scrollbar |
| Done | **Fluent Design Akzentfarben** | F0-F8 mit individuellen Farben: F0 Gelb (Licht), F1 Blau (Sound), F2 Orange (Horn), etc. |
| Done | **Benutzerdefinierte Vektor-Icons** | F3: Tueren schliessen (rot, SVG-Path), F4: Tuerfreigabe (gruen, SVG-Path) |
| Done | **CommandParameter Fix** | SetSpeedPresetCommand akzeptiert jetzt object? statt int (XAML uebergibt immer string) |
| Done | **SpeedometerControl Null-Checks** | Loaded-Event statt Konstruktor fuer UI-Initialisierung |
| Done | **ScrollViewer Padding** | Scrollbar ueberlagert Content nicht mehr (Padding-Fix) |

### Encoding und Dateien

| Status | Feature | Details |
|--------|---------|---------|
| Done | **.copilot-todos.md neu erstellt** | Komplett neu geschrieben ohne Encoding-Probleme (keine Emojis, ASCII-Umlaute) |
| Done | **maui.instructions.md neu erstellt** | Encoding-Probleme behoben |
| Done | **Instruction-Dateien konsolidiert** | 6 redundante Dateien geloescht |
| Done | **no-terminal.instructions.md** | Temporaere Einschraenkung fuer Terminal-Nutzung dokumentiert |

---

## Erledigte Aufgaben (06.02.2025)

### MAUI Auto-Discovery fuer REST API

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **UdpDiscoveryResponder fuer WinUI** | `WinUI\Service\UdpDiscoveryResponder.cs` - UDP Multicast Responder |
| Done | **Integration in REST API Startup** | Startet automatisch wenn REST API aktiviert ist |
| Done | **MAUI Discovery Service erweitert** | UDP Multicast Discovery mit Fallback auf manuelle IP |
| Done | **Automatische Server-Erkennung** | MAUI findet WinUI automatisch im lokalen Netzwerk |

### Plugin System - XAML Entfernung

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **SamplePlugin XAML entfernt** | XAML-Datei geloescht, komplett C#-basierte UI implementiert |
| Done | **C#-basierte UI erstellt** | Programmatische UI-Konstruktion mit WinUI 3 Controls |
| Done | **Dashboard-UI verbessert** | Z21 + REST API Status Cards, Project Statistics |

### REST API Port Check

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **PortChecker Utility erstellt** | `WinUI\Utilities\PortChecker.cs` fuer Port-Verfuegbarkeitspruefung |
| Done | **User-Friendly Error Dialog** | Zeigt hilfreiche Fehlermeldung bei Port-Konflikt |
| Done | **FirewallHelper entfernt** | Keine Windows Firewall Dialoge mehr beim Start |

---

## Erledigte Aufgaben (05.02.2025)

### Plugin System Verbesserungen

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **MinimalPlugin zu SamplePlugin umbenennen** | Verzeichnis, Projekt und Klasse umbenannt |
| Done | **PluginLoadContext erstellen** | Microsoft Best Practice: Custom AssemblyLoadContext fuer Plugin-Isolation |
| Done | **PluginDiscoveryService aktualisieren** | Verwendet nun PluginLoadContext statt Assembly.LoadFrom() |

### Datei-Codierungen und Zeilenenden

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | **.gitattributes erstellen** | Konsistente CRLF-Zeilenenden im Repository |
| Done | **Gemischte Zeilenenden korrigiert** | IPlugin.cs, PluginBase.cs, AppSettings.cs, PluginRegistry.cs |

---

## Standard GitHub-Veroeffentlichung Checkliste

### 3. Dokumentation

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | README.md vorhanden | Gut strukturiert mit Badges, Features, Getting Started |
| Done | LICENSE vorhanden | MIT License |
| Done | THIRD-PARTY-NOTICES.md | Vorhanden |
| Done | docs/ARCHITECTURE.md | Vorhanden |
| Done | CONTRIBUTING.md erstellen | Erledigt (04.02.2025) |
| Done | Azure Speech Wiki | `docs/wiki/AZURE-SPEECH-SETUP.md` erstellt |
| Pending | **CODE_OF_CONDUCT.md erstellen** | Fuer Open-Source-Projekte empfohlen |
| Pending | **SECURITY.md erstellen** | GitHub Security Policy |
| Pending | **CHANGELOG.md erstellen** | Versionshistorie dokumentieren |

### 4. Repository-Konfiguration

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | .gitignore vorhanden | Gut konfiguriert |
| Done | .gitattributes erstellen | CRLF-Normalisierung fuer alle Textdateien |
| Pending | **GitHub Issue Templates** | `.github/ISSUE_TEMPLATE/` erstellen |
| Pending | **Pull Request Template** | `.github/PULL_REQUEST_TEMPLATE.md` erstellen |
| Pending | **GitHub Actions Workflow** | CI/CD fuer Build/Test erstellen |
| Pending | **Dependabot konfigurieren** | `.github/dependabot.yml` fuer NuGet-Updates |
| Pending | **Repository Topics** | Tags setzen: model-railroad, z21, winui, maui, blazor, dotnet |

### 5. Code-Bereinigung

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | Architektur MVVM-konform | Gut strukturiert mit SharedUI/Backend/Domain-Trennung |
| Done | DI-Pattern konsistent | `AddMobaBackendServices()` Extension fuer alle Plattformen |
| Done | NullObject-Pattern | Fuer optionale Services (NullCityService, NullSettingsService, etc.) |
| Pending | **WinUI Configuration AppSettings.cs** | Duplikat von Common Configuration? Pruefen und konsolidieren |
| Pending | **Unused Usings entfernen** | IDE-Analyse durchfuehren |

### 6. Tests

| Status | Aufgabe | Details |
|--------|---------|---------|
| Done | Test-Projekt vorhanden | `Test\Test.csproj` mit NUnit |
| Pending | **Test-Coverage pruefen** | Kritische Pfade (Z21, JourneyManager, WorkflowService) abgedeckt? |
| Pending | **CI-Integration** | Tests in GitHub Actions integrieren |

---

## Feature-Ideen (Backlog)

### MOBAflow (WinUI)

| Status | Feature | Details |
|--------|---------|---------|
| Pending | **Keyboard Shortcuts** | F5=Connect, Space=Track Power, R=Reset. Shortcuts in Button-Tooltips anzeigen! |
| Pending | **Play-Button in Audio-Action Editor** | Sound-Vorschau im Workflow-Editor |
| Pending | **Drag and Drop Workflow Actions** | Actions per Drag and Drop neu anordnen |
| Pending | **Export Statistics** | Lap Counter Daten als CSV/Excel exportieren |
| Pending | **Fuehrerstand-Page (Cab Simulator)** | Realistische Lokfuehrer-Perspektive inspiriert von ICE/Vectron/Taurus Fuehrerpulten. Elemente: ETCS/PZB-Anzeige, Fahrschalter (Hebel), Bremscontroller, Sifa (Totmannknopf), Signalwiederholung, Tuersteuerung. Aehnlich wie Train Simulator oder ZUSI-Displays. |
| Pending | **Funktionstasten-Konfiguration (F0-F28)** | Groesseres Feature: Symbol-Toolbox (wie Cities Library) mit Eisenbahn-Icons. Drag and Drop von Symbolen auf F0-F20 Buttons zur visuellen Konfiguration. Persistierung pro Lok/Wagen in Project (Locomotives, PassengerWagons, GoodsWagons). Konfiguration erfolgt auf TrainsPage. Hinweis: Auch Personen- und Gueterwagen koennen Funktionsdecoder besitzen! |
| Done | **TrainControlPage 4-Spalten Layout** | Links: Locomotive Settings, Mitte: Tachometer, Functions F0-F20 (mit Akzentfarben und Icons), Rechts: Speed Categories (07.01.2026) |
| Done | **Benutzerdefinierte Vektor-Icons** | F3: Tueren schliessen (rot), F4: Tuerfreigabe (gruen) - SVG-basierte Path-Grafiken (07.01.2026) |

### MOBAsmart (MAUI)

| Status | Feature | Details |
|--------|---------|---------|
| Done | **Light/Dark Theme** | Dynamisch wechselbar, persistiert in Settings |
| Done | **Logo im Header** | Train-Icon zwischen Titel und Theme-Switch |
| Done | **Haptic Feedback** | Bei Theme/Connection/Track Power Toggle |
| Done | **Pulsing Connection LED** | Animiert wenn verbunden |
| Pending | **Landscape Mode** | Optimiertes 2-Spalten Layout fuer Querformat |
| Pending | **Widget fuer Homescreen** | Android Widget mit Lap Counter Status |
| Pending | **Notification bei Zielrunden** | Push-Notification wenn Target Laps erreicht |
| Pending | **Vibration bei Feedback** | Haptic Feedback wenn Zug Feedback-Point passiert |
| Pending | **QR-Code Scanner** | Z21/REST IP per QR-Code einlesen |
| Pending | **History/Log View** | Letzte 50 Feedbacks anzeigen mit Timestamp |

### MOBAdash (Blazor)

| Status | Feature | Details |
|--------|---------|---------|
| Pending | **Real-time Charts** | Live-Diagramme fuer Lap Times, Feedback-Frequenz |
| Pending | **Multi-User Session** | Mehrere Benutzer sehen gleiche Live-Daten (SignalR) |
| Pending | **Dark Mode** | Theme-Switch wie in MAUI |
| Pending | **PWA Installation** | "Add to Home Screen" Prompt |
| Pending | **Fullscreen Dashboard** | Kiosk-Modus fuer Always-On Display |
| Pending | **Audio Notifications** | Browser-Sound bei Events |

---

## Architektur-Analyse Ergebnisse

### Best Practices eingehalten

1. **Clean Architecture:** Domain - Backend - SharedUI - Platform (WinUI/MAUI/Blazor)
2. **MVVM-Pattern:** CommunityToolkit.Mvvm konsistent verwendet
3. **DI-Container:** Microsoft.Extensions.DependencyInjection durchgaengig
4. **Interface-Segregation:** IZ21, IActionExecutor, ISpeakerEngine, etc.
5. **NullObject-Pattern:** NullSoundPlayer, NullSpeakerEngine, NullCityService
6. **Async-Pattern:** Async/await durchgaengig
7. **Logging:** Serilog mit strukturiertem Logging und In-Memory Sink
8. **Plugin-System:** Extensible Architecture mit IPlugin + PluginLoadContext
9. **File Standards:** UTF-8 encoding, CRLF line endings (enforced via .editorconfig + .gitattributes)

---

## Fortschritt

- **Kritisch (Sicherheit):** 0/6 Pending (Azure Key muss noch entfernt werden!)
- **Copyright-Header:** 10/10 Done (inkl. neue Plugin-Dateien)
- **Plugin-System:** Done (PluginLoadContext, SamplePlugin, Best Practices)
- **Dokumentation:** 7/9 (78%)
- **Repository-Konfiguration:** 2/7 (29%)
- **Code-Bereinigung:** 3/5 (60%)
- **Tests:** 1/3 (33%)

**Gesamtfortschritt:** ca. 55% abgeschlossen

---

## Naechste Schritte (Priorisierte Reihenfolge)

1. Azure Speech Key aus appsettings.json entfernen
2. appsettings.template.json erstellen
3. .gitignore fuer Secrets erweitern
4. Copyright-Jahr entscheiden (2025-2026 vs 2026)
5. SECURITY.md erstellen
6. CHANGELOG.md erstellen
7. GitHub Actions CI/CD Workflow erstellen
8. Duplikate konsolidieren (AppSettings)

---

## Fuer Copilot: Session-Start Checkliste

Beim Start jeder neuen Session:
1. Diese Datei lesen (`.github/instructions/.copilot-todos.md`)
2. Pruefen welche Aufgaben noch Pending offen sind
3. Keine bereits Done erledigten Empfehlungen wiederholen
4. Bei Umsetzung: Status von Pending auf Done aendern mit Datum

---

*Zuletzt aktualisiert: 2026-01-07 durch Copilot-Session*
