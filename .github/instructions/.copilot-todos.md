---
description: 'Dynamic cross-session knowledge bridge tracking TODOs, decisions, and instruction file status for MOBAflow'
applyTo: '**'
---

# MOBAflow - Cross-Session Knowledge Bridge

> **Cross-Session Knowledge Bridge** fuer Copilot
> **Erstellt:** 2025-02-04 | **Letztes Update:** 2026-01-19

---

## âœ… SESSION-BERICHT: 2026-01-19

### DurchgefÃ¼hrte Arbeiten

| Aktion | Details | Status |
|--------|---------|--------|
| **README.md Link korrigiert** | `docs/ARCHITECTURE.md` â†’ `ARCHITECTURE.md` | âœ… |
| **ENCODING.md gelÃ¶scht** | Duplikat von `no-special-chars.instructions.md` | âœ… |
| **TRADEMARK-GUIDE.md gelÃ¶scht** | Interne Registrierungsanleitung (nicht public) | âœ… |
| **CLA.md verschoben** | â†’ `docs/legal/CLA.md` | âœ… |
| **copilot-instructions.md erweitert** | Project Overview mit Features, Tech Stack, Terminology | âœ… |
| **architecture.instructions.md erstellt** | Layers, Data Flow, Key Interfaces, Domain Models | âœ… |
| **mvvm-best-practices.instructions.md erstellt** | CommunityToolkit.Mvvm Attribute, Patterns, Anti-Patterns | âœ… |
| **fluent-design.instructions.md erstellt** | Materials, Spacing, Typography, Icons, Theming | âœ… |

### Neue Instruction Files

| Datei | Inhalt | Zeilen |
|-------|--------|--------|
| `architecture.instructions.md` | Clean Architecture, Data Flow, DI, Plugin System | ~300 |
| `mvvm-best-practices.instructions.md` | [ObservableProperty], [RelayCommand], ViewModel Patterns | ~280 |
| `fluent-design.instructions.md` | Acrylic/Mica, 8px Grid, Segoe Fluent Icons, Theming | ~320 |

### Aktuelle Instruction Files Ãœbersicht

**[ACTIVE] Production-Ready (7 Dateien):**
1. `copilot-instructions.md` - Index + Project Overview
2. `architecture.instructions.md` - Architektur Details
3. `mvvm-best-practices.instructions.md` - MVVM Patterns
4. `fluent-design.instructions.md` - UI Design Guidelines
5. `self-explanatory-code-commenting.instructions.md` - Code Commenting
6. `terminal.instructions.md` - PowerShell Standards
7. `.copilot-todos.md` - Cross-Session Knowledge

**[ACTIVE] WinUI-Spezifisch (4 Dateien):**
1. `winui.instructions.md` - WinUI 3 + VSM Responsive
2. `winui3-best-practices-steps-4-12.md` - Roadmap
3. `winui3-vsm-detailed-guide.md` - VSM Deep Dive
4. `xaml-page-registration.instructions.md` - XAML Compiler Issues

**[ACTIVE] Patterns (3 Dateien):**
1. `di-pattern-consistency.instructions.md` - DI Best Practices
2. `hasunsavedchanges-patterns.instructions.md` - Undo/Redo Integration
3. `no-special-chars.instructions.md` - Encoding Safety

---

## ğŸ”§ REFACTORING: String Nullable zu Non-Nullable (2026-01-19)

> **Status:** â³ GEPLANT
> **PrioritÃ¤t:** ğŸŸ  MITTEL (Code-QualitÃ¤t, kein Performance-Gewinn)
> **Datum:** 2026-01-19

### Analyse-Ergebnis

| Kategorie | Ergebnis |
|-----------|----------|
| **RAM-Ersparnis** | âŒ Keine (`string.Empty` ist interned) |
| **Performance-Gewinn** | âš ï¸ Marginal (~Nanosekunden pro Null-Check) |
| **Code-QualitÃ¤t** | âœ… **Signifikant besser** |
| **Wartbarkeit** | âœ… **Weniger Null-Checks Ã¼berall** |
| **XAML-Bindings** | âœ… **Einfacher (kein TargetNullValue)** |

### Entscheidung: Wann `string.Empty` vs `string?`

| Verwende | FÃ¼r Properties die... | Beispiele |
|----------|----------------------|-----------|
| `string = string.Empty` | Immer einen Wert haben (auch wenn leer) | Name, DisplayName, Manufacturer, Series |
| `string?` | Semantisch "nicht gesetzt" bedeuten kÃ¶nnen | PhotoPath, FilePath, ExternalId |

### Betroffene Dateien

**Domain Layer:**
- [ ] `Domain/Locomotive.cs` - Manufacturer, ArticleNumber, Series
- [ ] `Domain/Journey.cs` - Name, Text, Description
- [ ] `Domain/Station.cs` - Name
- [ ] `Domain/Workflow.cs` - Name, Description
- [ ] `Domain/WorkflowAction.cs` - Message, FilePath (keep nullable!)
- [ ] `Domain/Train.cs` - Name
- [ ] `Domain/Project.cs` - Name, Description
- [ ] `Domain/Solution.cs` - Name
- [ ] `Domain/FeedbackPoint.cs` - Name

**ViewModel Layer:**
- [ ] `SharedUI/ViewModel/JourneyViewModel.cs` - Wrapper anpassen
- [ ] `SharedUI/ViewModel/StationViewModel.cs` - Wrapper anpassen
- [ ] `SharedUI/ViewModel/WorkflowViewModel.cs` - Wrapper anpassen
- [ ] `SharedUI/ViewModel/TrainViewModel.cs` - Wrapper anpassen
- [ ] `SharedUI/ViewModel/ProjectViewModel.cs` - Wrapper anpassen

### Refactoring-Pattern

**Vorher (Domain):**
```csharp
public string? Manufacturer { get; set; }
```

**Nachher (Domain):**
```csharp
public string Manufacturer { get; set; } = string.Empty;
```

**ViewModel Wrapper (bleibt gleich):**
```csharp
public string Manufacturer
{
    get => _model.Manufacturer;
    set => SetProperty(_model.Manufacturer, value, _model, (m, v) => m.Manufacturer = v);
}
```

### Ausnahmen (bleiben nullable!)

| Property | Grund |
|----------|-------|
| `PhotoPath` | null = kein Foto zugewiesen |
| `FilePath` (WorkflowAction) | null = keine Datei ausgewÃ¤hlt |
| `ExternalId` | null = nicht mit externem System verknÃ¼pft |

### Schritte

- [ ] **1. Domain Layer refactoren** (~30min)
- [ ] **2. ViewModel Layer prÃ¼fen** (~15min)
- [ ] **3. Build + Tests ausfÃ¼hren** (~10min)
- [ ] **4. JSON-Deserialisierung testen** (bestehende .mobaflow Dateien)

### JSON-KompatibilitÃ¤t

**Wichtig:** System.Text.Json behandelt fehlende Properties als `null`. Mit `[JsonPropertyName]` und Default-Werten sollte es funktionieren:

```csharp
// Funktioniert mit bestehendem JSON:
public string Manufacturer { get; set; } = string.Empty;
// Wenn "Manufacturer" fehlt im JSON â†’ bleibt string.Empty
// Wenn "Manufacturer": null im JSON â†’ wird zu "" (mit Konverter) oder Exception
```

**Option:** Custom JsonConverter fÃ¼r null â†’ "" Konvertierung:
```csharp
[JsonConverter(typeof(NullToEmptyStringConverter))]
public string Manufacturer { get; set; } = string.Empty;
```

---

## ğŸš¨ SECURITY: Vor GitHub-VerÃ¶ffentlichung (KRITISCH!)

> **Status:** âš ï¸ **BLOCKIEREND** - Muss vor Public Release erledigt werden!
> **PrioritÃ¤t:** ğŸ”´ğŸ”´ğŸ”´ HÃ–CHSTE PRIORITÃ„T
> **Datum:** 2026-01-18

### Gefundene Secrets im Code

| Datei | Zeile | Problem | Status |
|-------|-------|---------|--------|
| `WinUI/appsettings.json` | 21 | Azure Cognitive Services Key hardcoded | âš ï¸ OFFEN |
| `WinUI/appsettings.Development.json` | 10 | Placeholder `your-test-key-here` | âœ… OK |

### Konkrete Fundstelle

```json
// WinUI/appsettings.json - Zeile 21
"Speech": {
    "Key": "b29427debf254c88bef939dbab94f162",  // â† ECHTE API KEY!
    "Region": "germanywestcentral",
    ...
}
```

### Erforderliche Aktionen vor GitHub-Release

- [ ] **1. Azure Key rotieren** - Der aktuelle Key kÃ¶nnte bereits kompromittiert sein
- [ ] **2. Key aus appsettings.json entfernen** - Ersetzen durch Placeholder oder Umgebungsvariable
- [ ] **3. User Secrets oder Environment Variables nutzen**
  - Option A: `dotnet user-secrets` fÃ¼r lokale Entwicklung
  - Option B: Umgebungsvariable `MOBA_SPEECH_KEY`
  - Option C: Azure Key Vault fÃ¼r Production
- [ ] **4. .gitignore prÃ¼fen** - Sicherstellen dass keine Secrets committed werden
- [ ] **5. Git History bereinigen** - BFG Repo-Cleaner oder `git filter-branch`
- [ ] **6. appsettings.json.template erstellen** - Vorlage ohne echte Keys

### Empfohlene LÃ¶sung

**appsettings.json (Ã¶ffentlich):**
```json
"Speech": {
    "Key": "",  // Set via environment variable MOBA_SPEECH_KEY
    "Region": "germanywestcentral",
    ...
}
```

**Umgebungsvariable setzen:**
```powershell
$env:MOBA_SPEECH_KEY = "your-actual-key"
```

**Code-Anpassung (App.xaml.cs oder SpeechOptions):**
```csharp
var key = Environment.GetEnvironmentVariable("MOBA_SPEECH_KEY") 
       ?? configuration["Speech:Key"];
```

### Weitere Security-Checks

- [ ] **Keine anderen API Keys** - ÃœberprÃ¼ft âœ…
- [ ] **Keine PasswÃ¶rter** - ÃœberprÃ¼ft âœ…
- [ ] **Keine Connection Strings** - ÃœberprÃ¼ft âœ…
- [ ] **Z21 IP-Adresse** - Nur lokale Netzwerk-IP, kein Security-Issue

---

## ğŸ—ï¸ Architecture Decision: Auto-Save Pattern (2026-01-17)

> **Entscheidung:** PropertyChanged-basiertes Auto-Save fÃ¼r alle ViewModels
> **Status:** âœ… IMPLEMENTIERT - Konsistent Ã¼ber gesamte Codebase
> **Datum:** 2026-01-17

### Problem
UrsprÃ¼nglich wurde fÃ¼r `WorkflowViewModel` ein neues `DataChanged-Event` Pattern eingefÃ¼hrt, wÃ¤hrend andere ViewModels (`StationViewModel`, `TrainViewModel`) das Standard `PropertyChanged-Event` verwenden.

**Inkonsistenz:**
- âœ… **StationViewModel, TrainViewModel**: PropertyChanged â†’ `OnViewModelPropertyChanged` â†’ Auto-Save
- âŒ **WorkflowViewModel** (alt): DataChanged â†’ `OnWorkflowDataChanged` â†’ Auto-Save

### LÃ¶sung: Konsistentes PropertyChanged-Pattern

**Alle ViewModels verwenden jetzt:**

```csharp
// ViewModel Property Setter (CommunityToolkit.Mvvm Standard)
public string Name
{
    get => _model.Name;
    set => SetProperty(_model.Name, value, _model, (m, v) => m.Name = v);
}

// Nested ViewModels (z.B. WorkflowActionViewModel in WorkflowViewModel)
private void OnActionPropertyChanged(object? sender, PropertyChangedEventArgs e)
{
    // Propagiere als PropertyChanged(nameof(Actions)) fÃ¼r Auto-Save
    OnPropertyChanged(nameof(Actions));
}

// MainWindowViewModel
partial void OnSelectedProjectChanged(ProjectViewModel? value)
{
    if (value != null)
    {
        // Subscribe zu PropertyChanged fÃ¼r alle Workflows
        foreach (var workflow in value.Workflows)
        {
            workflow.PropertyChanged += OnViewModelPropertyChanged;
        }
    }
}

private void OnViewModelPropertyChanged(object? sender, PropertyChangedEventArgs e)
{
    // Ignoriere UI-only Properties
    var ignoredProperties = new[] { "IsSelected", "IsExpanded", "IsHighlighted" };
    if (!ignoredProperties.Contains(e.PropertyName))
    {
        _ = SaveSolutionInternalAsync(); // Auto-Save
    }
}
```

### Benefits

1. âœ… **Konsistenz**: Alle ViewModels verwenden identisches Pattern
2. âœ… **CommunityToolkit.Mvvm Standard**: Nutzt `ObservableObject.PropertyChanged`
3. âœ… **Weniger Code**: Kein separates DataChanged-Event nÃ¶tig
4. âœ… **Einfacher wartbar**: Ein Event-Handler fÃ¼r alle ViewModels
5. âœ… **Nested ViewModels**: Actions propagieren Changes als `PropertyChanged("Actions")`

### Implementierte Ã„nderungen (2026-01-17)

**WorkflowViewModel.cs:**
- âŒ Entfernt: `public event EventHandler? DataChanged;`
- âŒ Entfernt: `DataChanged?.Invoke(this, EventArgs.Empty);`
- âœ… HinzugefÃ¼gt: `OnPropertyChanged(nameof(Actions))` in `UpdateActionNumbers()`, `AddAction()`, `DeleteAction()`
- âœ… HinzugefÃ¼gt: `OnActionPropertyChanged` propagiert als `PropertyChanged("Actions")`

**MainWindowViewModel.Counter.cs:**
- âŒ Entfernt: `workflow.DataChanged += OnWorkflowDataChanged;`
- âœ… HinzugefÃ¼gt: `workflow.PropertyChanged += OnViewModelPropertyChanged;`

**MainWindowViewModel.Workflow.cs:**
- âŒ Entfernt: `OnWorkflowDataChanged` Handler
- âŒ Entfernt: `workflow.DataChanged += OnWorkflowDataChanged;` in `AddWorkflow()`
- âœ… HinzugefÃ¼gt: `workflow.PropertyChanged += OnViewModelPropertyChanged;` in `AddWorkflow()`

### Auto-Save Flow (Konsistent)

```
User Ã¤ndert Workflow-Property (Name, ExecutionMode, etc.)
  â†“
WorkflowViewModel.SetProperty() â†’ OnPropertyChanged("Name")
  â†“
MainWindowViewModel.OnViewModelPropertyChanged() â†’ SaveSolutionInternalAsync()
  â†“
ğŸ’¾ Solution gespeichert

User Ã¤ndert Action-Property (DelayAfterMs, Message, etc.)
  â†“
WorkflowActionViewModel.SetParameter() â†’ OnPropertyChanged("DelayAfterMs")
  â†“
WorkflowViewModel.OnActionPropertyChanged() â†’ OnPropertyChanged("Actions")
  â†“
MainWindowViewModel.OnViewModelPropertyChanged() â†’ SaveSolutionInternalAsync()
  â†“
ğŸ’¾ Solution gespeichert

User zieht Action per Drag & Drop
  â†“
WorkflowViewModel.UpdateActionNumbers() â†’ OnPropertyChanged("Actions")
  â†“
MainWindowViewModel.OnViewModelPropertyChanged() â†’ SaveSolutionInternalAsync()
  â†“
ğŸ’¾ Action-Reihenfolge gespeichert
```

### Lessons Learned

- âœ… Immer prÃ¼fen: Gibt es bereits ein etabliertes Pattern in der Codebase?
- âœ… **Konsistenz > Clever**: PropertyChanged ist gut genug, kein separates Event nÃ¶tig
- âœ… **CommunityToolkit.Mvvm nutzen**: `SetProperty()` triggert automatisch PropertyChanged
- âœ… Nested ViewModels propagieren Changes als `PropertyChanged(nameof(Collection))`

---

## App Shell Architektur (2026-01-15)

> **Ziel:** Zentrales App-Shell-Pattern mit DI-basierter Navigation
> **Status:** âœ… FUNKTIONSFAEHIG - App startet erfolgreich

### App Shell Interfaces (SharedUI/Shell/)

**Neue Interfaces implementiert:**

| Interface | Zweck | Status |
|-----------|-------|--------|
| `INavigationService` | Zentrale Navigation mit History | âœ… Implementiert |
| `IPageFactory` | DI-basierte Page-Erstellung | âœ… Implementiert |
| `ILifecycleHost` | App-weite Lifecycle-Events | âœ… Implementiert |
| `IShellService` | Shell-Regions (Main, Overlay, Sidebar, Footer) | âœ… Implementiert |
| `ShellRegion` (enum) | Regionen-Definition | âœ… Implementiert |
| `PageDescriptor` (record) | Page-Metadaten | âœ… Implementiert |

**WinUI Implementierungen (WinUI/Service/):**

| Service | Beschreibung | Status |
|---------|--------------|--------|
| `NavigationService` | Erweitert um INavigationService, Navigation History | âœ… Erweitert |
| `PageFactory` | DI-basierte Page-Erstellung | âœ… Neu |
| `LifecycleHost` | WinUI Lifecycle-Integration | âœ… Neu |
| `ShellService` | Shell-Region-Management | âœ… Neu |

---

## Responsive Layout - Entscheidung (2026-01-15)

### AdaptivePanel (ENTFERNT)

Das Custom Control `AdaptivePanel` wurde nach ausfuehrlichen Tests **entfernt**, da WinUI 3 zu viele Inkompatibilitaeten mit Custom Controls hat:

| Problem | Ursache |
|---------|---------|
| XAML-Parser Exception | ContentProperty mit ObservableCollection funktioniert nicht |
| DependencyObject nicht erlaubt | Items muessen von FrameworkElement erben |
| Implizite Styles crashen | Custom Controls in ResourceDictionary nicht unterstuetzt |
| GridLength TypeConverter fehlt | Manuelles Parsing erforderlich |

### Empfohlene Alternative: VisualStateManager

Fuer responsive Multi-Column-Layouts wird **VisualStateManager mit AdaptiveTrigger** empfohlen:

```xaml
<Grid>
    <VisualStateManager.VisualStateGroups>
        <VisualStateGroup>
            <VisualState x:Name="WideState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="1024" />
                </VisualState.StateTriggers>
            </VisualState>
            <VisualState x:Name="CompactState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="0" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                    <Setter Target="Panel2.Visibility" Value="Collapsed" />
                </VisualState.Setters>
            </VisualState>
        </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
</Grid>
```

### Noch verfuegbar: ResponsiveLayoutBehavior

`WinUI/Behavior/ResponsiveLayoutBehavior.cs` ist noch vorhanden und kann fuer VisualStateManager-Integration genutzt werden.

### Naechste Schritte (Optional/Backlog)

- [x] ~~Unit-Tests fuer GetGridLength() Parser~~ (entfernt - AdaptivePanel entfernt)
- [x] ~~VisualStateManager-basiertes Design fuer TrainControlPage~~ âœ… FERTIG (2026-01-17)
- [ ] Flyout-basierte Toolbox fuer TrackPlanEditorPage in Compact-Mode

---

## ğŸ¨ NEUE INITIATIVE: WinUI 3 Best Practices Implementation (2026-01-15)

> **Ziel:** Systematische Umsetzung aller WinUI 3 Best Practices mit Fokus auf Responsive Layouts (VisualStateManager)
> **Status:** AKTIV - Step 1-3.1 abgeschlossen, TrackPlanEditorPage hat bereits VSM, Step 3.2 nÃ¤chste (weitere VSM-Optimierung)
> **PrioritÃ¤t:** Stufe 1 (nach Security-Cleanup, vor ReSharper 0-Warnings)

### Hintergrund: Warum VisualStateManager?

WinUI 3 Apps mÃ¼ssen **responsive** sein - nicht hart-kodierte Layouts fÃ¼r feste FenstergrÃ¶ÃŸen. **VisualStateManager (VSM)** mit **AdaptiveTrigger** ist die Microsoft Best Practice fÃ¼r:

- âœ… Automatische Umschaltung zwischen Layouts basierend auf Fensterbreite
- âœ… Tablet/Touch-UnterstÃ¼tzung (Portrait â†” Landscape)
- âœ… Professionelle Smooth Transitions (keine jarring Layout-Shifts)
- âœ… Kein Code-Behind erforderlich (deklarativ, wartbar)
- âœ… Future-proof fÃ¼r beliebig kleine/groÃŸe Fenster

**MOBAflow Breakpoints definiert:**
- **Compact:** 0-640px (Mobile/kleine Fenster)
- **Medium:** 641-1199px (Tablet/Tablet Landscape)
- **Wide:** 1200px+ (Desktop/groÃŸer Monitor)

**Siehe auch:** Umfassende Dokumentation in `.github/instructions/winui.instructions.md` (neue Sektion "Responsive Layout with VisualStateManager")

### Step 1: VSM-Dokumentation (âœ… FERTIG - 2026-01-15)

**Umgesetzt:**
- âœ… Erweiterte `winui.instructions.md` mit umfassender VSM-ErklÃ¤rung (Conceptual Guide + Code Examples)
- âœ… MOBAflow-spezifische Breakpoints dokumentiert
- âœ… Komplettes TrainControlPage-Beispiel mit 3 States (Wide/Medium/Compact)
- âœ… HÃ¤ufige VSM-Patterns (Hide/Show, Column Width, Stacking)
- âœ… Window-Resize Testing Guide
- âœ… Architecture Decision Log (warum VSM, nicht Custom Controls)

**Ergebnis:** Entwickler verstehen jetzt VSM-Konzept vollstÃ¤ndig und kÃ¶nnen es sofort anwenden.

### Step 2: XAML-Audit aller Haupt-Pages (âœ… FERTIG - 2026-01-15)

**Audit-Ergebnisse:**

| Page | Layout | Status | Breakpoints | PrioritÃ¤t |
|------|--------|--------|------------|-----------|
| **TrainControlPage.xaml** | Grid (3 Spalten, hart-kodiert) | âœ… **VSM IMPLEMENTIERT (2026-01-17)** | Wide: 3 Spalten \| Medium: 2 Spalten \| Compact: Stack | âœ… FERTIG |
| **TrackPlanEditorPage.xaml** | Grid (3 Spalten: Toolbox \| Canvas \| Palette) | âœ… **VSM IMPLEMENTIERT + Pan-Feature (2026-01-18)** | Wide: 3 Spalten \| Medium: Canvas + Properties \| Compact: Canvas only | âœ… FERTIG |
| **SignalBoxPage.cs** | Programmatisch (Code-Behind XAML) | â³ **NÃ„CHSTE** | Wide: Grid \| Medium: Compact | ğŸŸ  MITTEL |
| **MainWindow.xaml** | NavigationView (Shell) | â³ Noch zu prÃ¼fen | Wide: Rail sichtbar \| Compact: Hamburger | ğŸŸ  MITTEL |
| **WorkflowsPage.xaml** | ListBox + Editor | â³ Noch zu prÃ¼fen | Wide: Split \| Compact: Modal | ğŸŸ  MITTEL |
| **MonitorPage.xaml** | Horizontal Logs | âœ… Wahrscheinlich OK | - | ğŸŸ¢ NIEDRIG |

**Erkenntnisse:**
- âŒ ~~Keine Page hat aktuell VSM implementiert~~ â†’ TrainControlPage âœ… VSM implementiert
- âœ… TrainControlPage als Vorbild-Implementierung
- âœ… Gute Grundstruktur (Grid-basiert, proper spacing, CardBackground, Fluent Design)
- âš ï¸ SignalBoxPage ist vollstÃ¤ndig Code-Behind generiert (sollte zu XAML migriert werden fÃ¼r Wartbarkeit)

### Step 3: VSM-Implementierung in Haupt-Pages

#### Step 3.1: TrainControlPage.xaml (âœ… FERTIG - 2026-01-17)

**Implementiert:**
- âœ… VSM mit Wide/Medium/Compact States
- âœ… Breakpoints: Wide (1200px+) | Medium (641-1199px) | Compact (0-640px)
- âœ… Wide: [Settings (260px) | Tachometer (*) | Functions (180px)]
- âœ… Medium: [Settings (250px) | Tachometer (*)] - Functions verborgen
- âœ… Compact: Single column, alle Panels gestackt
- âœ… All 21 function buttons (F0-F20) working with Command binding
- âœ… BacklightConverter for button colors
- âœ… Tested with resize from 1920px â†’ 1200px â†’ 640px â†’ 320px
- âœ… Build erfolgreich

**Testing Status:**
- âœ… UI Buttons responsive und klickbar (auch ohne Z21 connection zum Testen)
- âœ… Function button colors zeigen sich korrekt (Background binding)
- âœ… CanExecuteLocoCommand temporarily disabled (`=> true`) fÃ¼r Testing
- âœ… TODO: SpÃ¤ter wieder `_z21.IsConnected` check aktivieren

**UX-Fix (2026-01-17 Session):**
- ğŸš¨ **ISSUE GEFUNDEN:** VSM-Refactoring (2a22af7) ersetzte BacklightToggleButtonStyle mit inline Properties, verlor VisualStates (Hover, Press, Disabled)
- âœ… **GELÃ–ST:** Alle F0-F20 Buttons zurÃ¼ck zu BacklightToggleButtonStyle
- âœ… Inline Properties (Height, CornerRadius, FontSize, FontWeight) entfernt
- âœ… Grid layout und Background binding bleiben erhalten
- âœ… Alle VisualStates (PointerOver, Pressed, CheckedPointerOver, CheckedPressed, Disabled) wiederhergestellt
- âœ… Build erfolgreich validiert

#### Step 3.2: TrackPlanEditorPage.xaml (âœ… FERTIG - 2026-01-18)

**Implementiert:**
- âœ… VSM mit Wide/Medium/Compact States
- âœ… Breakpoints: Wide (1200px+) | Medium (641-1199px) | Compact (0-640px)
- âœ… Wide: [Toolbox (180px) | Canvas (*) | Properties (240px)]
- âœ… Medium: [Canvas (*) | Properties (240px)] - Toolbox verborgen
- âœ… Compact: Canvas full-screen only
- âœ… **Pan-Feature implementiert (Rechte Maustaste)**
- âœ… Build erfolgreich

**Pan-Feature Details (2026-01-18):**
- âœ… Rechte Maustaste gedrÃ¼ckt halten â†’ Canvas verschieben (Pan)
- âœ… Cursor wechselt zu `SizeAll` wÃ¤hrend Pan
- âœ… NatÃ¼rliches Scrolling (Mausbewegung = Canvas-Bewegung)
- âœ… Kurzer Rechtsklick (< 5px Bewegung) â†’ KontextmenÃ¼ wie gewohnt
- âœ… Dead Code (`_isPanning`, `_panStart`) reaktiviert und erweitert

**Code-Cleanup (2026-01-18):**
- âœ… Entfernt: Unbenutzte Felder `_isPanning`, `_panStart` â†’ Neu implementiert mit vollstÃ¤ndiger Pan-Logik
- âœ… Neue Felder: `_panScrollHorizontalStart`, `_panScrollVerticalStart` fÃ¼r ScrollViewer-Offset

---

## ğŸ›¤ï¸ TrackPlanEditorPage - Pan Feature (NEU - 2026-01-18)

> **Feature:** Canvas-Pan mit rechter Maustaste
> **Status:** âœ… IMPLEMENTIERT
> **Datum:** 2026-01-18

### Implementierung

**Felder hinzugefÃ¼gt:**
```csharp
// Pan state (right mouse button)
private bool _isPanning;
private Point _panStart;
private double _panScrollHorizontalStart;
private double _panScrollVerticalStart;
```

**Pointer-Handling:**
1. **PointerPressed (Rechte Maustaste):** Startet Pan, merkt sich Startposition + ScrollViewer-Offset
2. **PointerMoved (wÃ¤hrend Pan):** Berechnet Delta, scrollt Canvas via `CanvasScrollViewer.ChangeView()`
3. **PointerReleased:** Beendet Pan, zeigt KontextmenÃ¼ nur bei minimaler Bewegung (< 5px)

**BenutzerfÃ¼hrung:**
- Cursor wird zu `SizeAll` (Verschiebe-Pfeil) wÃ¤hrend Pan
- Cursor wird zurÃ¼ckgesetzt nach Pan-Ende

---

## ğŸ¨ VSM + UX Preservation Strategy (NEU - 2026-01-17)

> **Problem:** VisualStateManager soll responsive Layout bieten OHNE UI/UX-Polishing zu verlieren
> **Status:** âš ï¸ **KRITISCHER FUND** - TrainControlPage verlor BacklightToggleButtonStyle!
> **Datum:** 2026-01-17

### ğŸš¨ WARNUNG: TrainControlPage.xaml - Was VERLOREN ging (REAL ISSUE)

**VOR VSM-Implementation (d4025e0 - BacklightToggleButtonStyle):**
```xaml
<!-- âœ… GUTE UX: Style mit allen VisualStates -->
<ToggleButton
    Style="{StaticResource BacklightToggleButtonStyle}"
    Background="{x:Bind ViewModel.IsF0On, Converter={BacklightConverter}, ConverterParameter=#FFD700}"
    Command="{x:Bind ViewModel.ToggleF0Command}"
    Content="F0"
    IsChecked="{x:Bind ViewModel.IsF0On}" />
```

**NACH VSM-Implementation (2a22af7 - Inline Properties):**
```xaml
<!-- âŒ SCHLECHTE UX: Inline Properties, kein Style, verliert VisualStates -->
<ToggleButton
    Grid.Row="0"
    Grid.Column="0"
    Height="40"
    HorizontalAlignment="Stretch"
    Background="{x:Bind ViewModel.IsF0On, Mode=OneWay, Converter={StaticResource BacklightConverter}, ConverterParameter=#FFD700}"
    Command="{x:Bind ViewModel.ToggleF0Command}"
    Content="F0"
    CornerRadius="6"
    FontSize="12"
    FontWeight="SemiBold"
    IsChecked="{x:Bind ViewModel.IsF0On, Mode=OneWay}" />
```

### Was wurde verloren?

**BacklightToggleButtonStyle VisualStates (noch vorhanden in ControlStyles.xaml):**
- âŒ **PointerOver State**: Border und Highlight bei Hover weg
- âŒ **Pressed State**: Press-Feedback bei Click weg  
- âŒ **CheckedPointerOver State**: Fokus/Highlight auf aktivem Button weg
- âŒ **CheckedPressed State**: Press-Feedback auf aktivem Button weg
- âŒ **Disabled State**: Visuelles Disabled-Feedback weg
- âœ… **Normal State**: Basis-Design bleibt

### Warum passierte das?

Die Refactoring fÃ¼r VSM hatte folgende Probleme:
1. âŒ Buttons wurden aus dem Style herausgenommen
2. âŒ Inline Properties wurden hinzugefÃ¼gt (Height, CornerRadius, etc.)
3. âŒ Style-Reference wurde entfernt  
4. âœ… Background Binding blieb erhalten
5. âœ… Farben bleiben visuell, aber interaktive States verschwinden

### Die Lehre fÃ¼r die anderen Pages

**KRITISCHES RULE fÃ¼r VSM-Implementation:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NIEMALS Custom Styles durch inline Properties ersetzen!     â”‚
â”‚                                                              â”‚
â”‚ âœ… RICHTIG:                                                 â”‚
â”‚ <ToggleButton Style="{StaticResource CustomStyle}"          â”‚
â”‚              Background="..." />   â† Style + Binding        â”‚
â”‚                                                              â”‚
â”‚ âŒ FALSCH:                                                  â”‚
â”‚ <ToggleButton Height="40" CornerRadius="6"                 â”‚
â”‚              Background="..." />   â† Keine VisualStates     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¨ VSM-MIGRATION SAFETY GUIDELINES (2026-01-17)

> **KRITISCH:** Folgende Regeln MÃœSSEN eingehalten werden, um UI/UX nicht zu verlieren!
> **Kontext:** Commit 2a22af7 (-576, +409 Zeilen) war groÃŸes Refactoring mit collateral damage
> **Status:** ğŸ“‹ DOKUMENTIERT - FÃ¼r alle zukÃ¼nftigen Pages verbindlich

### Root Cause Analysis: Was passierte bei TrainControlPage?

**Commit 2a22af7 (14.01.2026) - "feat(winui): VisualStateManager responsive layout & docs"**
- ğŸ“Š -576 Zeilen entfernt, +409 Zeilen hinzugefÃ¼gt = groÃŸes Refactoring
- âŒ **Problem:** GroÃŸe Refactorings sind fehleranfÃ¤llig
- âŒ **Issue:** VSM-Implementation ersetzte Style-Referenzen durch inline Properties
- âœ… **Folge:** BacklightToggleButtonStyle verloren, aber ControlStyles.xaml nicht gelÃ¶scht
- ğŸ”§ **Fix:** 2026-01-17 Session restaurierte alle 21 Function Buttons mit Style-Referenzen

**Timeline:**
```
d4025e0 (Initial): BacklightToggleButtonStyle âœ… funktioniert
    â†“
2a22af7 (VSM Refactor): Inline Properties ersetzen Style âŒ VisualStates weg
    â†“
Heute (2026-01-17): Restauriere Styles, entferne inline Properties âœ… Alles wieder gut
```

### Kernproblem: "Flaches" VSM Design

**Symptome:**
- Layout passt sich an Fensterbreite an âœ…
- Aber Buttons/Controls sehen "trocken" aus âŒ
- Hover-States, Press-Feedback, Farb-ÃœbergÃ¤nge verschwinden âŒ
- Resultat: UX fÃ¼hlt sich "Beta" oder "unfertig" an âŒ

**Root Cause:** Versehentliche Entfernung von Custom Styles wÃ¤hrend VSM-Refactoring

### ğŸ¯ Goldene Regel fÃ¼r VSM-Migration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  VSM = LAYOUT NUR (Separation!)                  â”‚
â”‚                                                                  â”‚
â”‚  âœ… VSM Setters dÃ¼rfen Ã¤ndern:                                  â”‚
â”‚     â€¢ Control.Visibility (Show/Hide Panels)                     â”‚
â”‚     â€¢ Grid.ColumnDefinitions Width (Spalten-GrÃ¶ÃŸe)             â”‚
â”‚     â€¢ Margin/Padding (kleine Spacing-Anpassungen)              â”‚
â”‚                                                                  â”‚
â”‚  âŒ VSM Setters dÃ¼rfen NICHT Ã¤ndern:                            â”‚
â”‚     â€¢ Style (NIEMALS!)                                          â”‚
â”‚     â€¢ Height/Width inline (gehÃ¶rt in Style!)                   â”‚
â”‚     â€¢ CornerRadius inline (gehÃ¶rt in Style!)                   â”‚
â”‚     â€¢ FontSize/FontWeight inline (gehÃ¶rt in Style!)            â”‚
â”‚     â€¢ Background Binding (gehÃ¶rt in XAML Control!)             â”‚
â”‚     â€¢ Converter (gehÃ¶rt in Page.Resources!)                    â”‚
â”‚                                                                  â”‚
â”‚  â†’ UI/UX Polishing bleibt in Controls/Styles/Converter         â”‚
â”‚  â†’ VSM macht nur Responsive-Layout                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“‹ PRE-MIGRATION CHECKLIST (vor TrackPlanEditorPage / weiteren Pages)

**MUSS vor VSM-Refactoring durchgefÃ¼hrt werden:**

- [ ] **Code-Audit:** Welche Custom Styles werden verwendet?
  - [ ] Alle Styles identifizieren (z.B. `BacklightToggleButtonStyle`, `DangerButtonStyle`)
  - [ ] Wo werden sie verwendet? (z.B. "F0-F20 ToggleButtons in TrainControlPage")
  - [ ] Sind sie noch in ControlStyles.xaml vorhanden?

- [ ] **Converter-Audit:** Welche Data Converters gibt es?
  - [ ] Alle Converter dokumentieren (z.B. `BacklightConverter`, `IntToPresetCheckedConverter`)
  - [ ] Wo sind sie registriert? (Page.Resources oder App.xaml)
  - [ ] Welche Controls nutzen sie? (Background Binding, IsChecked Binding, etc.)

- [ ] **VisualStates-Audit:** Welche VisualStates existieren in Custom Styles?
  - [ ] Alle VisualStates dokumentieren (PointerOver, Pressed, Checked, Disabled, etc.)
  - [ ] Notieren welche States WICHTIG fÃ¼r UX sind

- [ ] **Layout-Planung fÃ¼r 3 Breakpoints:**
  - [ ] **Wide (1200px+):** Skizze zeichnen - wie sollen alle Panels sichtbar sein?
  - [ ] **Medium (641-1199px):** Welche Panels verstecken? Welche wachsen?
  - [ ] **Compact (0-640px):** Modal/Flyout fÃ¼r versteckte Panels planen?
  - [ ] Notieren: Grid.ColumnDefinitions fÃ¼r jeden State

- [ ] **Test-Plan erstellen:**
  - [ ] Welche Resize-Breakpoints testen? (1920 â†’ 1200 â†’ 800 â†’ 640 â†’ 320)
  - [ ] Hover/Press/Disabled States auf jeder GrÃ¶ÃŸe testen?
  - [ ] Touch-Test erforderlich?
  - [ ] Keyboard-Navigation noch funktional?

### ğŸ“‹ DURING-MIGRATION CHECKLIST (wÃ¤hrend VSM-Refactoring)

**MUSS wÃ¤hrend des Refactorings eingehalten werden:**

- [ ] **NIEMALS Styles entfernen/ersetzen**
  - [ ] Jeder ToggleButton: `Style="{StaticResource BacklightToggleButtonStyle}"`
  - [ ] Jeder Button: Behalte `Style="{StaticResource ...}"` bei
  - [ ] PrÃ¼fe: Werden Styles durch inline Properties ersetzt? â†’ STOPP!

- [ ] **NIEMALS Bindings/Converter entfernen**
  - [ ] Background-Bindings bleiben: `Background="{x:Bind IsOn, Converter={...}}"`
  - [ ] IsChecked-Bindings bleiben: `IsChecked="{x:Bind IsChecked}"`
  - [ ] Alle Converter-Parameter bleiben: `ConverterParameter=#FFD700`

- [ ] **Grid Layout Properties bewahren**
  - [ ] `Grid.Row` / `Grid.Column` nicht anfassen
  - [ ] `Grid.RowSpan` / `Grid.ColumnSpan` nicht anfassen
  - [ ] Nur `Grid.ColumnDefinitions` im VSM Setter Ã¤ndern!

- [ ] **VSM Setters minimal halten**
  - [ ] Nur Visibility Ã¤ndern: `<Setter Target="Panel.Visibility" Value="Collapsed" />`
  - [ ] Nur ColumnDefinitions: `<Setter Target="MainGrid.ColumnDefinitions" Value="*,*,*" />`
  - [ ] Nur kleine Spacing-Fixes wenn nÃ¶tig: `<Setter Target="Panel.Margin" Value="0,16,0,0" />`

- [ ] **BUILD IM ZWEITEN SCHRITT!**
  - [ ] Erst alle XAML-Ã„nderungen abgeschlossen
  - [ ] Dann `dotnet build` ausfÃ¼hren
  - [ ] Nur wenn Build erfolgreich: Weitermachen

### ğŸ“‹ POST-MIGRATION CHECKLIST (nach VSM-Implementation)

**MUSS nach dem Refactoring geprÃ¼ft werden:**

- [ ] **Build erfolgreich?**
  - [ ] `dotnet build` ohne Fehler
  - [ ] Keine XAML Parser Exceptions
  - [ ] Keine CS0103 "InitializeComponent does not exist" Fehler

- [ ] **Visual Regression Test auf allen 3 Breakpoints:**
  - [ ] **Wide (1920px):** Alle Panels sichtbar und gut angeordnet?
  - [ ] **Medium (800px):** Layout umgeschaltet, alle Controls sichtbar?
  - [ ] **Compact (320px):** Single-Column, readable auf kleinem Screen?

- [ ] **UI/UX Polishing noch vorhanden?**
  - [ ] âœ… Farben noch sichtbar? (BacklightConverter funktioniert)
  - [ ] âœ… Hover-States noch funktional? (PointerOver Effekt beim Hover)
  - [ ] âœ… Press-Feedback noch da? (Button wird dunkler beim DrÃ¼cken)
  - [ ] âœ… Disabled-State funktioniert? (grau, keine Interaktion)
  - [ ] âœ… Icons/Symbole noch sichtbar?

- [ ] **InteraktivitÃ¤t noch funktional?**
  - [ ] Alle Buttons klickbar?
  - [ ] Alle Slider/Inputs funktionieren?
  - [ ] Command Bindings noch aktiv?
  - [ ] Keyboard Navigation noch mÃ¶glich?

- [ ] **Kein visuelles Artefakten?**
  - [ ] Keine Cut-off Controls
  - [ ] Keine Clipping/Overflow
  - [ ] Keine jarring Layout-Shifts beim Resize
  - [ ] Smooth Transitions?

---

## ğŸ¯ VSM-MIGRATION BEST PRACTICES

### Best Practice #1: Style + Binding Pattern

**âœ… RICHTIG: Style-Reference + Background-Binding separate**

```xaml
<ToggleButton
    Grid.Row="0"
    Grid.Column="0"
    Style="{StaticResource BacklightToggleButtonStyle}"
    Background="{x:Bind ViewModel.IsF0On, Mode=OneWay, 
                 Converter={StaticResource BacklightConverter}, 
                 ConverterParameter=#FFD700}"
    Command="{x:Bind ViewModel.ToggleF0Command}"
    Content="F0"
    IsChecked="{x:Bind ViewModel.IsF0On, Mode=OneWay}" />
```

**âŒ FALSCH: Inline Properties statt Style**

```xaml
<!-- WÃ¼rde VisualStates verlieren! -->
<ToggleButton
    Grid.Row="0"
    Grid.Column="0"
    Height="40"
    CornerRadius="6"
    FontSize="12"
    FontWeight="SemiBold"
    Background="{x:Bind ViewModel.IsF0On, Mode=OneWay, 
                 Converter={StaticResource BacklightConverter}, 
                 ConverterParameter=#FFD700}"
    Command="{x:Bind ViewModel.ToggleF0Command}"
    Content="F0"
    IsChecked="{x:Bind ViewModel.IsF0On, Mode=OneWay}" />
```

### Best Practice #2: VSM Setters = Layout Only

**âœ… RICHTIG: Nur Visibility und Grid-Spalten Ã¤ndern**

```xaml
<VisualState x:Name="WideState">
    <VisualState.StateTriggers>
        <AdaptiveTrigger MinWindowWidth="1200" />
    </VisualState.StateTriggers>
    <VisualState.Setters>
        <!-- Panelsichtbarkeit -->
        <Setter Target="ToolboxPanel.Visibility" Value="Visible" />
        <Setter Target="PropertiesPanel.Visibility" Value="Visible" />
        
        <!-- Grid-Spalten -->
        <Setter Target="MainGrid.ColumnDefinitions" Value="180,*,240" />
    </VisualState.Setters>
</VisualState>
```

**âŒ FALSCH: UI-Styling in VSM Ã¤ndern**

```xaml
<!-- WÃ¼rde Style Ã¼berschreiben! -->
<VisualState x:Name="WideState">
    <VisualState.Setters>
        <Setter Target="Button.Height" Value="40" />
        <Setter Target="Button.Background" Value="Blue" />
        <Setter Target="Button.FontSize" Value="14" />
        <!-- â† Das gehÃ¶rt NICHT in VSM! -->
    </VisualState.Setters>
</VisualState>
```

### Best Practice #3: Breakpoint-Dokumentation

**FÃ¼r jede Page DOKUMENTIEREN:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PAGE: TrackPlanEditorPage.xaml - Responsive Breakpoints
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ Wide (1200px+) - Desktop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Toolbox 180px] | [Canvas *] | [Properties 240px]         â”‚
â”‚  âœ“ Alle 3 Panels nebeneinander                             â”‚
â”‚  âœ“ Maximale ProduktivitÃ¤t fÃ¼r Power User                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Medium (641-1199px) - Tablet Landscape â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Canvas full-width]                                        â”‚
â”‚  [Toolbox Tab] [Properties Tab]  â† Bottom Tabs             â”‚
â”‚  âœ“ Canvas grÃ¶ÃŸer fÃ¼r bessere Ansicht                       â”‚
â”‚  âœ“ Toolbox/Properties auf Demand zeigbar                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Compact (0-640px) - Mobile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Canvas full-screen]                                       â”‚
â”‚  Toolbox: FAB + Modal Flyout                                â”‚
â”‚  Properties: FAB + Modal Flyout                             â”‚
â”‚  âœ“ Fokus auf Canvas                                         â”‚
â”‚  âœ“ Tools nur wenn aktiv benÃ¶tigt                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Grid Definition:
  Wide:    ColumnDefinitions = "180,*,240"
  Medium:  ColumnDefinitions = "*" (Canvas nur, Tabs unten)
  Compact: ColumnDefinitions = "*" (Canvas nur, Modal FABs)
```

---

## â³ NÃ„CHSTE AUFGABEN (VSM-Migration fÃ¼r andere Pages)

### Step 3.3: SignalBoxPage.xaml (ğŸ”´ NÃ„CHSTE AUFGABE)

**Hindernis:** Komplett Code-Behind generierte XAML  
**Plan:** Zur XAML umschreiben, dann VSM hinzufÃ¼gen  
**Aufwand:** 2-3h | **PrioritÃ¤t:** ğŸ”´ HOCH (nÃ¤chste Page)

### Step 3.4: MainWindow.xaml Navigation Shell (ğŸŸ  MITTEL)

**Breakpoints:**
- Wide: NavigationView Rail (links)
- Compact: Hamburger Menu
**Aufwand:** 1-2h | **PrioritÃ¤t:** ğŸŸ  MITTEL

### Step 3.5: WorkflowsPage.xaml (ğŸŸ  MITTEL)

**Breakpoints:**
- Wide: List + Editor nebeneinander
- Compact: Workflow List nur, Editor als Modal
**Aufwand:** 1-2h | **PrioritÃ¤t:** ğŸŸ  MITTEL

---

## ğŸ¨ OPTIONAL UI ENHANCEMENTS

### ğŸŸ¢ Icons/Symbole in Function-Buttons (Optional)

> **Observation:** User merkte an "mir ist aufgefallen, dass die schÃ¶nen symbole noch fehlen in den funktionstasten"

**Idee:** Jeder F0-F20 Button mit kleinem Icon + Text

**Beispiel Icons (WinUI Segoe MDL2):**
```
F0  = ğŸ’¡ Light          (Glyph="&#xE7B7;")
F1  = ğŸ”Š Sound          (Glyph="&#xE7F1;")  
F2  = ğŸ“¯ Horn           (Glyph="&#xE7C0;")
F3  = ğŸšª Door Close     (Glyph="&#xE787;")
F4  = ğŸ”“ Door Open      (Glyph="&#xE8AC;")
F5  = âš¡ Shunt Light    (Glyph="&#xE7E8;")
F6  = ğŸ® Interior Light (Glyph="&#xEB9D;")
F7  = ğŸ’¨ Smoke          (Glyph="&#xE7E9;")
F8  = â¬†ï¸ Pantograph     (Glyph="&#xE7E7;")
F9  = ğŸ”— Coupler        (Glyph="&#xEA3B;")
```

**XAML Pattern:**
```xaml
<ToggleButton
    Style="{StaticResource BacklightToggleButtonStyle}"
    Background="{x:Bind ViewModel.IsF0On, Converter={BacklightConverter}, ConverterParameter=#FFD700}"
    Command="{x:Bind ViewModel.ToggleF0Command}"
    IsChecked="{x:Bind ViewModel.IsF0On, Mode=OneWay}">
    <StackPanel Orientation="Vertical" Spacing="4">
        <FontIcon FontSize="18" Glyph="&#xE7B7;" /> <!-- Lightbulb -->
        <TextBlock FontSize="10" Text="F0" HorizontalTextAlignment="Center" />
    </StackPanel>
</ToggleButton>
```

**Status:** â³ OPTIONAL (nice-to-have, nicht blocking)  
**Aufwand:** 1h fÃ¼r alle 21 Buttons | **Benefit:** Visual Appeal â­â­

### ğŸŸ¢ HelpPage.cs / InfoPage.cs â†’ XAML Migration (Optional)

> **Observation:** User fragte ob XAML-Dateien erstellt werden sollten
> **Datum:** 2026-01-18

**Analyse:**
- Beide Pages sind **Code-Behind only** (kein XAML)
- Grund: Dynamische Content-Generierung (Markdown-Parsing, TreeView-Nodes)
- **Empfehlung:** Kein Muss - Code-Behind ist gerechtfertigt fÃ¼r dynamischen Content

**Option Hybrid-Ansatz:**
- XAML fÃ¼r Grid-Shell (3-Spalten Layout)
- Code-Behind fÃ¼r dynamischen Inhalt
- WÃ¼rde VSM ermÃ¶glichen

**Status:** â³ OPTIONAL (niedrige PrioritÃ¤t)  
**Aufwand:** 1-2h pro Page | **Benefit:** VSM + Hot Reload â­

---

## ğŸ“‹ OFFENE AUFGABEN ÃœBERSICHT

### ğŸ”´ğŸ”´ğŸ”´ KRITISCH (vor GitHub-Release)

| Aufgabe | Status | Aufwand | Beschreibung |
|---------|--------|---------|--------------|
| **Azure Key entfernen** | âš ï¸ BLOCKIEREND | 30min | `WinUI/appsettings.json` Zeile 21 |
| **Key rotieren** | âš ï¸ BLOCKIEREND | 10min | Azure Portal - neuen Key generieren |
| **User Secrets einrichten** | âš ï¸ BLOCKIEREND | 30min | `dotnet user-secrets` oder Env-Variable |
| **Git History bereinigen** | âš ï¸ BLOCKIEREND | 1h | BFG Repo-Cleaner falls bereits gepusht |

### ğŸ”´ HOHE PRIORITÃ„T

| Aufgabe | Status | Aufwand | Beschreibung |
|---------|--------|---------|--------------|
| SignalBoxPage VSM | â³ NÃ„CHSTE | 2-3h | Code-Behind â†’ XAML + VSM |
| MainWindow.xaml Navigation | â³ Geplant | 1-2h | Hamburger Menu fÃ¼r Compact |
| WorkflowsPage.xaml VSM | â³ Geplant | 1-2h | List + Editor responsive |

### ğŸŸ  MITTLERE PRIORITÃ„T

| Aufgabe | Status | Aufwand | Beschreibung |
|---------|--------|---------|--------------|
| CanExecuteLocoCommand Check | â³ TODO | 15min | `_z21.IsConnected` wieder aktivieren |
| Flyout-Toolbox TrackPlanEditor | â³ Backlog | 1h | Compact-Mode Toolbox als Flyout |

### ğŸŸ¢ NIEDRIGE PRIORITÃ„T / OPTIONAL

| Aufgabe | Status | Aufwand | Beschreibung |
|---------|--------|---------|--------------|
| F0-F20 Icons | â³ Optional | 1h | Segoe MDL2 Icons in Buttons |
| HelpPage/InfoPage XAML | â³ Optional | 2-4h | Hybrid-Ansatz fÃ¼r VSM |

---

## âœ… ABGESCHLOSSEN (letzte 7 Tage)

| Datum | Aufgabe | Details |
|-------|---------|---------|
| 2026-01-19 | **Instruction Files Cleanup** | Projekt-Ãœbersicht in copilot-instructions.md |
| 2026-01-19 | **architecture.instructions.md** | Layers, Data Flow, Key Interfaces, Domain Models |
| 2026-01-19 | **mvvm-best-practices.instructions.md** | CommunityToolkit.Mvvm Patterns |
| 2026-01-19 | **fluent-design.instructions.md** | Materials, Spacing, Icons, Theming |
| 2026-01-19 | **MD-Dateien Cleanup** | ENCODING.md, TRADEMARK-GUIDE.md gelÃ¶scht, CLA.md verschoben |
| 2026-01-19 | **README.md Link Fix** | ARCHITECTURE.md Link korrigiert |
| 2026-01-18 | TrackPlanEditorPage Pan-Feature | Rechte Maustaste â†’ Canvas verschieben |
| 2026-01-18 | TrackPlanEditorPage VSM | Wide/Medium/Compact responsive |
| 2026-01-18 | Dead Code Cleanup | `_isPanning` reaktiviert fÃ¼r Pan |
| 2026-01-17 | TrainControlPage VSM | 3 Breakpoints implementiert |
| 2026-01-17 | BacklightToggleButtonStyle Fix | VisualStates restauriert |
| 2026-01-17 | Auto-Save Pattern | PropertyChanged konsistent |

---

## ğŸ“„ DOKUMENTATION & REPOSITORY (Wiederhergestellt 2026-01-18)

> **Hinweis:** Diese Sektion ging bei VSM-Refactoring verloren und wurde wiederhergestellt.

### Dokumentation Checkliste

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | README.md | Gut strukturiert mit Features, Getting Started |
| âœ… | LICENSE | MIT License |
| âœ… | THIRD-PARTY-NOTICES.md | Vorhanden |
| âœ… | docs/ARCHITECTURE.md | Vorhanden |
| âœ… | CONTRIBUTING.md | Erstellt (04.02.2025) |
| âœ… | docs/wiki/AZURE-SPEECH-SETUP.md | Azure Speech Wiki erstellt |
| â³ | **CODE_OF_CONDUCT.md erstellen** | FÃ¼r Open-Source-Projekte empfohlen |
| â³ | **SECURITY.md erstellen** | GitHub Security Policy |
| â³ | **CHANGELOG.md erstellen** | Versionshistorie dokumentieren |

### Repository-Konfiguration

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | .gitignore | Gut konfiguriert |
| âœ… | .gitattributes | CRLF-Normalisierung (05.02.2025) |
| â³ | **GitHub Issue Templates** | `.github/ISSUE_TEMPLATE/` erstellen |
| â³ | **GitHub Actions CI/CD** | Workflow fÃ¼r Build + Test |

---

## ğŸ§¹ CODE-BEREINIGUNG (Wiederhergestellt 2026-01-18)

### Potenzielle Duplikate

| Status | Problem | Empfehlung |
|--------|---------|------------|
| â³ | `WinUI\Configuration\AppSettings.cs` vs `Common\Configuration\AppSettings.cs` | Konsolidieren zu einer Klasse |
| â³ | `SpeakerEngineFactory` neben direkter DI-Registration | Entscheiden: Factory ODER DI |
| â³ | Unused Usings | IDE-Analyse durchfÃ¼hren |

### Code-Analyse

| Status | Aufgabe | Details |
|--------|---------|---------|
| â³ | **EnableNETAnalyzers** | `<EnableNETAnalyzers>true</EnableNETAnalyzers>` in allen .csproj |
| â³ | **Nullable Reference Types** | PrÃ¼fen ob durchgÃ¤ngig aktiviert |
| â³ | **ReSharper 0-Warnings** | Alle ReSharper-Warnungen beheben |

---

## ğŸ§ª TESTS (Wiederhergestellt 2026-01-18)

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | Test-Projekt vorhanden | `Test\Test.csproj` mit NUnit |
| â³ | **Test-Coverage prÃ¼fen** | Kritische Pfade (Z21, JourneyManager, WorkflowService) |
| â³ | **CI-Integration** | Tests in GitHub Actions integrieren |

---

## ğŸš€ FEATURE-BACKLOG (Wiederhergestellt 2026-01-18)

### MOBAflow (WinUI)

| Status | Feature | Details |
|--------|---------|---------|
| â³ | **Keyboard Shortcuts** | F5=Connect, Space=Track Power, R=Reset |
| â³ | **Play-Button in Audio-Action** | Sound-Vorschau im Workflow-Editor |
| â³ | **Drag & Drop Workflow Actions** | Actions per Drag & Drop neu anordnen |
| â³ | **Export Statistics** | Lap Counter Daten als CSV/Excel exportieren |

### MOBAsmart (MAUI)

| Status | Feature | Details |
|--------|---------|---------|
| â³ | **Landscape Mode** | Optimiertes 2-Spalten Layout fÃ¼r Querformat |
| â³ | **Widget fÃ¼r Homescreen** | Android Widget mit Lap Counter Status |

---

## ğŸ—ï¸ ARCHITEKTUR-ANALYSE (Wiederhergestellt 2026-01-18)

### âœ… Best Practices eingehalten

1. **Clean Architecture:** Domain â†’ Backend â†’ SharedUI â†’ Platform (WinUI/MAUI/Blazor)
2. **MVVM-Pattern:** CommunityToolkit.Mvvm konsistent verwendet
3. **DI-Container:** Microsoft.Extensions.DependencyInjection durchgÃ¤ngig
4. **Interface-Segregation:** IZ21, IActionExecutor, ISpeakerEngine, etc.
5. **NullObject-Pattern:** NullSoundPlayer, NullSpeakerEngine, NullCityService
6. **Async-Pattern:** Async/await durchgÃ¤ngig
7. **Logging:** Serilog mit strukturiertem Logging und In-Memory Sink
8. **Plugin-System:** Extensible Architecture mit IPlugin + PluginLoadContext

---

## ğŸ¤– FÃœR COPILOT: Session-Regeln (NEU 2026-01-18)

### NIEMALS in dieser Datei lÃ¶schen!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš¨ KRITISCHE REGEL FÃœR .copilot-todos.md                        â”‚
â”‚                                                                   â”‚
â”‚  âŒ NIEMALS Sektionen lÃ¶schen oder Ã¼berschreiben                 â”‚
â”‚  âŒ NIEMALS "altes durch neues ersetzen"                         â”‚
â”‚  âŒ NIEMALS Fortschritts-Tracking entfernen                      â”‚
â”‚                                                                   â”‚
â”‚  âœ… IMMER neue Sektionen HINZUFÃœGEN (append)                     â”‚
â”‚  âœ… IMMER erledigte Tasks als âœ… markieren (nicht lÃ¶schen!)      â”‚
â”‚  âœ… IMMER Datum bei Updates aktualisieren                        â”‚
â”‚  âœ… IMMER komplette Datei lesen vor Ã„nderungen                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session-Start Checkliste

Beim Start jeder neuen Session:
1. âœ… Diese Datei vollstÃ¤ndig lesen (`.github/instructions/.copilot-todos.md`)
2. âœ… PrÃ¼fen welche Aufgaben noch â³ offen sind
3. âœ… Keine bereits âœ… erledigten Empfehlungen wiederholen
4. âœ… Bei Umsetzung: Status von â³ auf âœ… Ã¤ndern mit Datum
5. âœ… **NIEMALS** Sektionen lÃ¶schen - nur hinzufÃ¼gen oder Status Ã¤ndern!

---

*Zuletzt aktualisiert: 2026-01-18 - Verlorene Sektionen wiederhergestellt*
