# MOBAflow - GitHub VerÃ¶ffentlichung Vorbereitung

> **Cross-Session Knowledge Bridge** fÃ¼r Copilot
> **Erstellt:** 2025-02-04 | **Letztes Update:** 2025-02-06

---

## ğŸš¨ KRITISCH - Vor VerÃ¶ffentlichung PFLICHT

### 1. ğŸ” Sicherheit & Secrets (HÃ–CHSTE PRIORITÃ„T!)

| Status | Aufgabe | Details |
|--------|---------|---------|
| â³ | **Azure Speech Key entfernen** | `WinUI\appsettings.json` enthÃ¤lt echten API-Key: `"Key": "b29427debf254c88bef939dbab94f162"` - MUSS entfernt werden! |
| â³ | **appsettings.json Template erstellen** | Erstelle `appsettings.template.json` ohne Secrets, dokumentiere in README |
| â³ | **.gitignore erweitern** | `appsettings.json` und `appsettings.Development.json` auf .gitignore setzen (nur Templates committen) |
| â³ | **Git History bereinigen** | Falls Key bereits committed: `git filter-branch` oder BFG Repo-Cleaner verwenden |
| â³ | **Azure Key rotieren** | Nach Bereinigung neuen Key generieren (alter Key ist kompromittiert) |
| â³ | **docs/SECURITY-SECRETS.md ausfÃ¼llen** | Datei existiert aber ist leer - Dokumentation fÃ¼r Secret-Management |

### 2. ğŸ“œ Copyright Header (Korrektur erforderlich)

**Erwarteter Header:**
```csharp
// Copyright (c) 2026 Andreas Huelsmann. Licensed under MIT. See LICENSE and README.md for details.
```

**Aktueller Header in allen Dateien:**
```csharp
// Copyright (c) 2025-2026 Andreas Huelsmann. Licensed under MIT. See LICENSE and README.md for details.
```

| Status | Aufgabe | Details |
|--------|---------|---------|
| â³ | **Copyright-Jahr klÃ¤ren** | User wÃ¼nscht "2026", aktuell ist "2025-2026" - Entscheidung treffen |
| â³ | **LICENSE-Datei aktualisieren** | Aktuell: "Copyright (c) 2025" - muss synchron zum Header sein |

**Dateien MIT Copyright-Header:**

| Datei | Status |
|-------|--------|
| `Common\Plugins\IPlugin.cs` | âœ… Erledigt (04.02.2025) |
| `Common\Plugins\PluginBase.cs` | âœ… Erledigt (04.02.2025) |
| `Common\Plugins\PluginDiscoveryService.cs` | âœ… Erledigt (04.02.2025) |
| `Common\Plugins\PluginValidator.cs` | âœ… Erledigt (04.02.2025) |
| `Common\Plugins\PluginLoadContext.cs` | âœ… Erledigt (05.02.2025) |
| `WinUI\Service\PluginLoader.cs` | âœ… Erledigt (04.02.2025) |
| `WinUI\Service\PluginRegistry.cs` | âœ… Erledigt (04.02.2025) |
| `Plugins\SamplePlugin\SamplePlugin.cs` | âœ… Erledigt (05.02.2025) |
| `Plugins\SamplePlugin\SamplePluginPage.cs` | âœ… Erledigt (06.02.2025) |
| `Plugins\SamplePlugin\SamplePluginViewModel.cs` | âœ… Erledigt (04.02.2025) |
| `WinUI\Utilities\PortChecker.cs` | âœ… Erledigt (06.02.2025) |
| `WinUI\Service\UdpDiscoveryResponder.cs` | âœ… Erledigt (06.02.2025) |

---

## âœ… Erledigte Aufgaben (06.02.2025)

### ğŸ“± MAUI Auto-Discovery fÃ¼r REST API

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | **UdpDiscoveryResponder fÃ¼r WinUI** | `WinUI\Service\UdpDiscoveryResponder.cs` - UDP Multicast Responder (06.02.2025) |
| âœ… | **Integration in REST API Startup** | Startet automatisch wenn REST API aktiviert ist (06.02.2025) |
| âœ… | **MAUI Discovery Service erweitert** | UDP Multicast Discovery mit Fallback auf manuelle IP (06.02.2025) |
| âœ… | **Automatische Server-Erkennung** | MAUI findet WinUI automatisch im lokalen Netzwerk (06.02.2025) |

**Funktionsweise:**
1. WinUI startet REST API â†’ UDP Discovery Responder wird gestartet
2. MAUI sendet UDP Multicast an `239.255.42.99:21106`
3. WinUI antwortet mit `MOBAFLOW_REST_API|192.168.x.x|5001`
4. MAUI verwendet automatisch die entdeckte IP

**Fallback:**
- Android Emulator â†’ verwendet automatisch `10.0.2.2`
- Keine Antwort â†’ verwendet manuell konfigurierte IP

### ğŸ”Œ Plugin System - XAML Entfernung

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | **SamplePlugin XAML entfernt** | XAML-Datei gelÃ¶scht, komplett C#-basierte UI implementiert (06.02.2025) |
| âœ… | **C#-basierte UI erstellt** | Programmatische UI-Konstruktion mit WinUI 3 Controls (06.02.2025) |
| âœ… | **SamplePlugin.csproj bereinigt** | Alle XAML-Referenzen entfernt (06.02.2025) |
| âœ… | **Dashboard-UI verbessert** | Z21 + REST API Status Cards, Project Statistics (06.02.2025) |
| âœ… | **Build erfolgreich** | Zero warnings, zero errors (06.02.2025) |

### ğŸ”Œ REST API Port Check

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | **PortChecker Utility erstellt** | `WinUI\Utilities\PortChecker.cs` fÃ¼r Port-VerfÃ¼gbarkeitsprÃ¼fung (06.02.2025) |
| âœ… | **Conditional Port Check** | PrÃ¼fung erfolgt nur wenn AutoStartWebApp aktiviert ist (06.02.2025) |
| âœ… | **User-Friendly Error Dialog** | Zeigt hilfreiche Fehlermeldung bei Port-Konflikt (06.02.2025) |
| âœ… | **FirewallHelper entfernt** | Keine Windows Firewall Dialoge mehr beim Start (06.02.2025) |

---

## âœ… Erledigte Aufgaben (05.02.2025)

### ğŸ”Œ Plugin System Verbesserungen

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | **MinimalPlugin â†’ SamplePlugin umbenennen** | Verzeichnis, Projekt und Klasse umbenannt (05.02.2025) |
| âœ… | **PluginLoadContext erstellen** | Microsoft Best Practice: Custom AssemblyLoadContext fÃ¼r Plugin-Isolation (05.02.2025) |
| âœ… | **PluginDiscoveryService aktualisieren** | Verwendet nun PluginLoadContext statt Assembly.LoadFrom() (05.02.2025) |
| âœ… | **SamplePlugin.csproj korrigieren** | ~~EmbeddedResource fÃ¼r XAML~~ â†’ C#-basierte UI (06.02.2025) |
| ~~âœ…~~ | ~~**XAML als EmbeddedResource**~~ | âš ï¸ ZurÃ¼ckgenommen (06.02.2025) - C#-basierte UI ist besser |

### ğŸ“ Datei-Codierungen & Zeilenenden

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | **.gitattributes erstellen** | Konsistente CRLF-Zeilenenden im Repository (05.02.2025) |
| âœ… | **Gemischte Zeilenenden korrigiert** | IPlugin.cs, PluginBase.cs, AppSettings.cs, PluginRegistry.cs (05.02.2025) |
| âœ… | **Instructions aktualisiert** | Abschnitt 7 (File Encoding) und 8 (PowerShell Optimization) hinzugefÃ¼gt (05.02.2025) |

---

## ğŸ“‹ Standard GitHub-VerÃ¶ffentlichung Checkliste

### 3. ğŸ“„ Dokumentation

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | README.md vorhanden | Gut strukturiert mit Badges, Features, Getting Started |
| âœ… | LICENSE vorhanden | MIT License |
| âœ… | THIRD-PARTY-NOTICES.md | Vorhanden |
| âœ… | docs/ARCHITECTURE.md | Vorhanden |
| âœ… | **CONTRIBUTING.md erstellen** | âœ… Erledigt (04.02.2025) |
| âœ… | **Azure Speech Wiki** | âœ… `docs/wiki/AZURE-SPEECH-SETUP.md` erstellt (04.02.2025) |
| â³ | **CODE_OF_CONDUCT.md erstellen** | FÃ¼r Open-Source-Projekte empfohlen |
| â³ | **SECURITY.md erstellen** | GitHub Security Policy |
| â³ | **CHANGELOG.md erstellen** | Versionshistorie dokumentieren |
| âœ… | **.copilot-todos.md verschieben** | âœ… Von Root nach `.github/instructions/` verschoben |

### 4. ğŸ”§ Repository-Konfiguration

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | .gitignore vorhanden | Gut konfiguriert |
| âœ… | **.gitattributes erstellen** | âœ… CRLF-Normalisierung fÃ¼r alle Textdateien (05.02.2025) |
| â³ | **GitHub Issue Templates** | `.github/ISSUE_TEMPLATE/` erstellen (bug_report.md, feature_request.md) |
| â³ | **Pull Request Template** | `.github/PULL_REQUEST_TEMPLATE.md` erstellen |
| â³ | **GitHub Actions Workflow** | CI/CD fÃ¼r Build/Test erstellen (`.github/workflows/`) |
| â³ | **Dependabot konfigurieren** | `.github/dependabot.yml` fÃ¼r NuGet-Updates |
| â³ | **Repository Topics** | Tags setzen: `model-railroad`, `z21`, `winui`, `maui`, `blazor`, `dotnet` |

### 5. ğŸ§¹ Code-Bereinigung

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | Architektur MVVM-konform | Gut strukturiert mit SharedUI/Backend/Domain-Trennung |
| âœ… | DI-Pattern konsistent | `AddMobaBackendServices()` Extension fÃ¼r alle Plattformen |
| âœ… | NullObject-Pattern | FÃ¼r optionale Services (NullCityService, NullSettingsService, etc.) |
| â³ | **WinUI\Configuration\AppSettings.cs** | Duplikat von `Common\Configuration\AppSettings.cs`? PrÃ¼fen und konsolidieren |
| â³ | **Backend\Interface\IAction.cs** | Wird diese Interface noch verwendet? `Actions` Property mit `IList<IAction>` scheint Legacy |
| â³ | **Sound\ISpeakerEngineFactory.cs** | Factory-Pattern prÃ¼fen - wird es noch verwendet oder ist DI-Registration ausreichend? |
| â³ | **Unused Usings entfernen** | IDE-Analyse durchfÃ¼hren |
| â³ | **Code-Analyse aktivieren** | `<EnableNETAnalyzers>true</EnableNETAnalyzers>` in allen .csproj |

### 6. ğŸ§ª Tests

| Status | Aufgabe | Details |
|--------|---------|---------|
| âœ… | Test-Projekt vorhanden | `Test\Test.csproj` mit NUnit |
| â³ | **Test-Coverage prÃ¼fen** | Kritische Pfade (Z21, JourneyManager, WorkflowService) abgedeckt? |
| â³ | **CI-Integration** | Tests in GitHub Actions integrieren |

---

## ğŸ” Architektur-Analyse Ergebnisse

### âœ… Best Practices eingehalten

1. **Clean Architecture:** Domain â†’ Backend â†’ SharedUI â†’ Platform (WinUI/MAUI/Blazor)
2. **MVVM-Pattern:** CommunityToolkit.Mvvm konsistent verwendet
3. **DI-Container:** Microsoft.Extensions.DependencyInjection durchgÃ¤ngig
4. **Interface-Segregation:** IZ21, IActionExecutor, ISpeakerEngine, etc.
5. **NullObject-Pattern:** NullSoundPlayer, NullSpeakerEngine, NullCityService
6. **Async-Pattern:** Async/await durchgÃ¤ngig (mit kleinen Ausnahmen)
7. **Logging:** Serilog mit strukturiertem Logging und In-Memory Sink
8. **Plugin-System:** Extensible Architecture mit IPlugin + PluginLoadContext (Microsoft Best Practice)
9. **File Standards:** UTF-8 encoding, CRLF line endings (enforced via .editorconfig + .gitattributes)

### âš ï¸ Potenzielle Verbesserungen

| Bereich | Problem | Empfehlung |
|---------|---------|------------|
| **Duplikate** | `WinUI\Configuration\AppSettings.cs` vs `Common\Configuration\AppSettings.cs` | Konsolidieren zu einer Klasse |
| **Legacy-Interface** | `IAction` mit `IList<IAction> Actions` Property | PrÃ¼fen ob noch verwendet, ggf. entfernen |
| **Factory vs DI** | `SpeakerEngineFactory` neben direkter DI-Registration | Entscheiden: Factory ODER DI, nicht beides |

---

## ğŸ“Š Fortschritt

- **Kritisch (Sicherheit):** 0/6 â³ (Azure Key muss noch entfernt werden!)
- **Copyright-Header:** 10/10 âœ… (inkl. neue Plugin-Dateien)
- **Plugin-System:** âœ… VollstÃ¤ndig (PluginLoadContext, SamplePlugin, Best Practices)
- **Dokumentation:** 7/9 (78%) - CONTRIBUTING.md + Azure Speech Wiki erstellt
- **Repository-Konfiguration:** 2/7 (29%) - .gitattributes hinzugefÃ¼gt
- **Code-Bereinigung:** 3/8 (38%)
- **Tests:** 1/3 (33%)

**Gesamtfortschritt:** ~55% abgeschlossen

---

## ğŸ“ NÃ¤chste Schritte (Priorisierte Reihenfolge)

1. **ğŸ” Azure Speech Key aus appsettings.json entfernen** (auf TODO-Liste fÃ¼r GitHub VerÃ¶ffentlichung)
2. **ğŸ” appsettings.template.json erstellen**
3. **ğŸ” .gitignore fÃ¼r Secrets erweitern**
4. ~~**ğŸ“œ Copyright-Header fÃ¼r Plugin-Dateien hinzufÃ¼gen**~~ âœ… Erledigt
5. **ğŸ“œ Copyright-Jahr entscheiden (2025-2026 vs 2026)**
6. ~~**ğŸ“„ CONTRIBUTING.md erstellen**~~ âœ… Erledigt
7. **ğŸ“„ SECURITY.md erstellen**
8. **ğŸ“„ CHANGELOG.md erstellen**
9. **ğŸ”§ GitHub Actions CI/CD Workflow erstellen**
10. **ğŸ§¹ Duplikate konsolidieren (AppSettings)**
11. ~~**ğŸ”Œ Plugin-System: PluginLoadContext implementieren**~~ âœ… Erledigt (05.02.2025)
12. ~~**ğŸ“ .gitattributes fÃ¼r Zeilenenden**~~ âœ… Erledigt (05.02.2025)

---

## ğŸš€ Feature-Ideen (Backlog)

### ğŸ–¥ï¸ MOBAflow (WinUI)

| Status | Feature | Details |
|--------|---------|---------|
| â³ | **Keyboard Shortcuts** | F5=Connect, Space=Track Power, R=Reset. Shortcuts in Button-Tooltips anzeigen! |
| â³ | **Play-Button in Audio-Action Editor** | Sound-Vorschau im Workflow-Editor - NICHT vorhanden, muss implementiert werden |
| â³ | **Drag & Drop Workflow Actions** | Actions per Drag & Drop neu anordnen |
| â³ | **Export Statistics** | Lap Counter Daten als CSV/Excel exportieren |

### ğŸ“± MOBAsmart (MAUI)

| Status | Feature | Details |
|--------|---------|---------|
| â³ | **Landscape Mode** | Optimiertes 2-Spalten Layout fÃ¼r Querformat |
| â³ | **Widget fÃ¼r Homescreen** | Android Widget mit Lap Counter Status |
| â³ | **Notification bei Zielrunden** | Push-Notification wenn Target Laps erreicht |
| â³ | **Vibration bei Feedback** | Haptic Feedback wenn Zug Feedback-Point passiert |
| â³ | **QR-Code Scanner** | Z21/REST IP per QR-Code einlesen |
| â³ | **History/Log View** | Letzte 50 Feedbacks anzeigen mit Timestamp |

### ğŸŒ MOBAdash (Blazor)

| Status | Feature | Details |
|--------|---------|---------|
| â³ | **Real-time Charts** | Live-Diagramme fÃ¼r Lap Times, Feedback-Frequenz |
| â³ | **Multi-User Session** | Mehrere Benutzer sehen gleiche Live-Daten (SignalR) |
| â³ | **Dark Mode** | Theme-Switch wie in MAUI |
| â³ | **PWA Installation** | "Add to Home Screen" Prompt |
| â³ | **Fullscreen Dashboard** | Kiosk-Modus fÃ¼r Always-On Display |
| â³ | **Audio Notifications** | Browser-Sound bei Events |

---

## âœ… Erledigte Features (05.02.2025)

### ğŸ“± MOBAsmart (MAUI)

| Status | Feature | Details |
|--------|---------|---------|
| âœ… | **Light/Dark Theme** | Dynamisch wechselbar, persistiert in Settings (05.02.2025) |
| âœ… | **Logo im Header** | Train-Icon zwischen Titel und Theme-Switch (05.02.2025) |
| âœ… | **Haptic Feedback** | Bei Theme/Connection/Track Power Toggle (05.02.2025) |
| âœ… | **Pulsing Connection LED** | Animiert wenn verbunden (05.02.2025) |
| âœ… | **GrÃ¶ÃŸerer Theme-Switch** | Scale 0.75 fÃ¼r bessere Usability (05.02.2025) |

---

## ğŸ¤– FÃ¼r Copilot: Session-Start Checkliste

Beim Start jeder neuen Session:
1. âœ… Diese Datei lesen (`.github/instructions/.copilot-todos.md`)
2. âœ… PrÃ¼fen welche Aufgaben noch â³ offen sind
3. âœ… Keine bereits âœ… erledigten Empfehlungen wiederholen
4. âœ… Bei Umsetzung: Status von â³ auf âœ… Ã¤ndern mit Datum

---

*Zuletzt aktualisiert: 2025-02-06 durch Copilot-Session*
